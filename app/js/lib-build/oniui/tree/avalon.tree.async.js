define(["avalon","./avalon.tree","./mmRequest"],function(){var e=void 0;avalon.ui.tree.leafIgnoreField.push("zAsync"),avalon.ui.tree.AddExtention(["async"],{data:{key:{zAsync:"zAsync"}},async:{enable:!1,url:"./avalon.tree.data.php",contentType:"application/x-www-form-urlencoded",dataType:"json",autoParam:[],dataFilter:e,otherParam:{},type:"post"}},function(t,n){avalon.mix(t,{reAsyncChildNodes:function(r,i,s,o,u){if(!r)return;t.asyncChildNodes(r,function(u){i==="refresh"&&r.children.clear(),s||(r.open=!0),o&&o({e:e,leaf:r,vm:t,vmodels:n})},u)},asyncChildNodes:function(e,r,i){if(!e)return;var s=t.async,i=i||s.dataFilter,o=t.callback.onAsyncSuccess,u=t.callback.onAsyncError,a=avalon.mix({},s.otherParam.$model||{});avalon.each(s.autoParam,function(t,n){var r=n.split("=");a[r[1]||r[0]]=e[r[0]]}),t.excute("async",{},e,function(){var f=avalon(g("treeIcon"+e.$id));f.addClass("ico_loading"),avalon.ajax(avalon.mix({data:a},s)).done(function(s){r&&r(s),t.addNodes(e,i?i(s):s),f.removeClass("ico_loading"),o&&o({leaf:e,e:s,vm:vmodel,vmodels:n})}).fail(function(t){f.removeClass("ico_loading"),u&&u({leaf:e,e:t,vm:vmodel,vmodels:n})})})}})},e,e,function(e,t){e.$watch("e:expand",function(t){if(!e.async.enable)return;var n=t.leaf;n&&!n.zAsync&&e.asyncChildNodes(n,function(){n.zAsync=!0})})})});