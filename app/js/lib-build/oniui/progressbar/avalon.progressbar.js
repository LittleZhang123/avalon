define(["avalon","text!./avalon.progressbar.html","css!./avalon.progressbar.css","css!../chameleon/oniui-common.css"],function(e,t){function n(e,t){var n=[],e=e-t,r,i,s,o;for(var u=0;u<=100;u++)r=Math.PI/2-Math.PI/50*u,i=Math.cos(r)*e+e*1+t*1,s=(1-Math.sin(r).toFixed(4))*e+t*1,o=(u?" L":"M")+i+" "+s+(u==100?"Z":""),n.push(o);return n}var r=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,i=e.ui.progressbar=function(s,o,u){var a=o.progressbarOptions;a.template=a.getTemplate(t,a);var f=e.define(o.progressbarId,function(t){e.mix(t,a),t.widgetElement=s;var o=s,l,c,h,p;t.$d=r&&t.circle&&n(a.circleRadius,a.circleBorderWidth)||[],t.$skipArray=["widgetElement","template","svgSupport"],t.svgSupport=r,t.ended=!1,t.circleCoordinates="",t.barCoordinates="",t.angel=a.value||0,t.successValue=t.countDown?0:100,t.value=t.countDown?100:t.value,t.angel=t.countDown?360:360*t.angel/100;var d;t.$init=function(t){if(d)return;d=!0,o.innerHTML=f.template,t?t():(e.log("avalon请尽快升到1.3.7+"),e.scan(s,[f].concat(u)),typeof a.onInit=="function"&&a.onInit.call(s,f,a,u));if(f.label){var i=o.getElementsByTagName("div");e.each(i,function(t,n){var r=e(n);f.circle?r.hasClass("oni-progressbar-circle-par")?p=r:r.hasClass("oni-progressbar-circle-bar")&&(c=r):r.hasClass("oni-progressbar-label")?h=n:r.hasClass("oni-progressbar-bar")&&(c=n,p=n.parentNode)})}f.$d=r&&f.circle&&n(f.circleRadius,f.circleBorderWidth)||[],f.circleBar(),f.circleCoordinates=f.$d.join(""),f._simulater(),typeof a.onInit=="function"&&a.onInit.call(s,f,a,u)},t.circleBar=function(e){if(f.circle||!r){var e=e||f.value||0;e=e>100?100:e>0?e:0,f.barCoordinates=e==100?f.circleCoordinates:f.$d.slice(0,e+1).join("")+(e<100&&e?"":"Z")}},t._getLeft=function(){if(f.circle||!h||f.inTwo)return;var e=c&&c.offsetWidth||0,t=h.offsetWidth||0,n=p&&p.offsetWidth||0,r=n-e>t+2?e-t/2+2:n-t;r=r>0?r:0,h.style.left=r+"px"},t._simulater=function(){f.simulate!==!1&&!f.indeterminate&&(clearTimeout(l),l=setTimeout(function(){if(f.success||f.ended||f.indeterminate)return clearTimeout(l);var e=f.simulater(f.value||0,f);if(f.success){e=f.successValue,f.value=e;return}if(f.ended)return;if(f.countDown){if(e<=0)return}else if(e>=100)return;f.value=e,l=setTimeout(arguments.callee,f.simulate)},f.simulate))},t.$remove=function(){s.innerHTML=s.textContent=""},t._cssMaker=function(e){return f.value===!1&&f.indeterminate||f.value==100?e?0:"100%":e?100-(f.value||0)+"%":(f.value||0)+"%"},t._indeterminate=function(){return f.indeterminate&&f.value==0&&!f.inTwo},t._showLabel=function(e,t){return e&&t},t._labelShower=function(e){return f.labelShower.call(f,arguments[0],arguments[1],f)},t.start=function(){f.indeterminate=!1,f.ended=!1,f._simulater()},t.end=function(e){clearTimeout(l),f.ended=!0,e!=void 0&&(f.value=e)},t.reset=function(t){var n={};e.mix(n,{value:t!=void 0?t:i.defaults.value,indeterminate:i.defaults.indeterminate,success:!1}),e.mix(f,n),f.ended=!1,f.successValue=f.countDown?0:100,f.value=f.countDown?100:f.value,f._simulater()},t.progress=function(e){f.value=e}});return f.$watch("success",function(e){e&&f.simulate&&(f.value=f.successValue),e&&f.onComplete.call(f)}),f.$watch("value",function(e){e==f.successValue&&(f.success=!0),f.circle&&f.circleBar(),f._getLeft(),f.angel=360*e/100,f.onChange&&f.onChange.call(f,e)}),f};i.defaults={toggle:!0,value:!1,label:!0,simulate:!1,indeterminate:!1,countDown:!1,inTwo:!1,circle:!1,circleColor:"#ffffff",circleBorderColor:"#dedede",circleBarColor:"#619FE8",circleRadius:38,circleBorderWidth:4,success:!1,onInit:e.noop,simulater:function(e,t){return t.countDown?e-5*Math.random()>>0:e+5*Math.random()>>0},getTemplate:function(e,t){return e},onChange:e.noop,onComplete:e.noop,labelShower:function(e,t,n){var e=t=="inTwo"?100-(e||0):e,r=n?n.successValue:100;return t=="l1"&&n.inTwo?"":e===!1?"loading…":e==="failed"?"failed!":e==r?"complete!":e+"%"},$author:"skipper@123"}});