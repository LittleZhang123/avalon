define(["avalon"],function(){var e,t=document.getElementsByTagName("SCRIPT");for(var n in t)if(t[n].outerHTML&&t[n].outerHTML.indexOf("avalon.lazyload.js")!==-1){var r=t[n].src;e=r.substring(0,r.lastIndexOf("/"))}var i=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,25)}}(),s={linear:function(e,t,n,r){return n*e/r+t},easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}},o=[],u,a=avalon.bindingHandlers.lazyload=function(t,n){var r=t.value.match(avalon.rword)||["$","lazyload"],i=r[0].trim(),s=r[1],l,c;if(i&&i!="$"){l=avalon.vmodels[i];if(!l)return}l||(l=n.length?n[0]:null),l&&typeof l[s]=="object"&&(c=l[s],c.$model&&(c=c.$model));var h=t.element;h.removeAttribute("ms-lazyload"),u=avalon.mix({},a.defaults,c||{},avalon.getWidgetData(h,"lazyload")),h.tagName==="IMG"&&(h.src=e+"/images/placeholder.png");var p=h.getAttribute("data-lazyload-preloadsrc")===null?u.preLoadSrc:h.getAttribute("data-lazyload-preloadsrc");if(u.preLoadType==="image")h.originalCssBackground=avalon.css(h,"background-image"),h.style.background="url("+p+") no-repeat center center",f(h,p,!1,!1),o.push(h);else if(u.preLoadType==="text"){var d=document.createElement("span");d.innerHTML=p,h.parentNode.insertBefore(d,h),d.style.cssText="display:inline-block;*display:inline;*zoom:1;width:"+h.width+"px;",avalon.css(d,"width",h.width<=1?"auto":h.width+"px;"),avalon.css(d,"height",h.height<=1?"auto":h.height+"px;"),h.originalSize={width:h.width<=1?-1:h.width,height:h.height<=1?-1:h.height},avalon.css(h,"width","0px"),avalon.css(h,"height","0px"),d.imgEle=h,o.push(d)}};avalon.bind(window,"load",function(){l(u)}),setInterval(function(){l(u)},100);var f=function(t,n,r,i,s){var o=new Image,a=t.getAttribute("data-lazyload-itemeffect")!==null?t.getAttribute("data-lazyload-itemeffect"):u.effect;if(t.tagName!=="IMG"&&r){var f=n;n=e+"/images/placeholder.png"}o.onload=function(){u.width=t.getAttribute("data-lazyload-width")||u.width,u.height=t.getAttribute("data-lazyload-height")||u.height;if(u.width!==""||u.height!=="")u.width!==""&&(avalon.css(t,"width",u.width),t.preLoadSetSize=!0),u.height!==""&&(avalon.css(t,"height",u.height),t.preLoadSetSize=!0),u.width="",u.height="";else if(t.width<=1||t.height<=1||typeof t.width=="undefined"||typeof t.height=="undefined"||i){t.tagName!=="IMG"&&i?(avalon.css(t,"width","auto"),avalon.css(t,"height","auto")):u.preLoadType==="text"?(avalon.css(t,"width",t.originalSize.width===-1?o.width:t.originalSize.width),avalon.css(t,"height",t.originalSize.height===-1?o.height:t.originalSize.height)):(avalon.css(t,"width",o.width),avalon.css(t,"height",o.height));if(i)try{delete t.preLoadSetSize}catch(e){}else t.preLoadSetSize=!0}if(r)if(t.tagName==="IMG")t.src=n;else{t.innerHTML=f;var l=t;do l=l.parentNode;while(l.getAttribute("avalonctrl")===null);l.setAttribute("ms-controller",l.getAttribute("avalonctrl")),l.removeAttribute("avalonctrl"),avalon.scan(l)}(a==="fadeIn"||a==="slideY"||a==="slideX")&&r&&c(t,a),u.preLoadType==="text"&&s.parentNode!==null&&s.parentNode.removeChild(s)},o.src=n},l=function(e){for(var t=0,n=o.length;t<n;t++){var r=e.preLoadType==="text"?o[t].imgEle:o[t],i=r.offsetTop,s=r.offsetHeight,u=document.compatMode==="BackCompat"?document.body.scrollTop:document.documentElement.scrollTop,a=document.compatMode==="BackCompat"?document.body.clientHeight:document.documentElement.clientHeight;u===0&&(u=document.body.scrollTop),i<u+a&&i+s>u&&!r.lazyloaded&&setTimeout(function(t,n,r){return function(){e.preLoadType==="image"?f(n,r,!0,n.preLoadSetSize):f(n,r,!0,n.preLoadSetSize,o[t]),n.lazyloaded=!0,n.removeAttribute("data-lazyload-original"),avalon.css(n,"background-image",n.originalCssBackground);try{delete n.originalCssBackground}catch(i){}}}(t,r,r.getAttribute("data-lazyload-original")),r.getAttribute("data-lazyload-itemdelay")||e.delay)}},c=function(e,t){if(e.animated)return;var n=0,r=e.getAttribute("data-lazyload-distance")||u.slideDistance,o=t==="fadeIn"?0:-r,a=t==="fadeIn"?1:r,f=20,l;t==="fadeIn"?l="opacity":l=t==="slideY"?"margin-top":"margin-left";var c=function(){cssValue=s[u.easing](n,o,a,f),n<f&&(avalon.css(e,l,cssValue),n+=1,i(c))};e.animated=!0,c()};return a.defaults={width:"",height:"",contentType:"image",preLoadType:"image",preLoadSrc:e+"/images/loading1.gif",delay:500,effect:"none",easing:"easeInOut",slideDistance:300,$author:"heiwu805@hotmail.com"},avalon.lazyload=a,avalon});