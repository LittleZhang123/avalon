define(["avalon"],function(e){function a(e,t,n,r){var i=null,s;return function(){var o=this,u=+(new Date);clearTimeout(i),s||(s=u),u-s>=n?(e.apply(o,r),s=u):i=setTimeout(function(){e.apply(o,r)},t)}}function f(){var e=s.scrollTop();e>200?o.toggle=!0:o.toggle=!1}var t={distanceToRight:50,distanceToBottom:120,title:"回到顶部",width:60,height:60,animate:!1,toggle:!1,backgroundUrl:"up.png"},n="<div ms-css-right='distanceToRight' ms-css-bottom='distanceToBottom' ms-title='title' ms-click='goTop' ms-css-width='width' ms-css-height='height' ms-visible='toggle' class='ui-icon'></div>",r=e.parseHTML(n).firstChild,i=e(r),s=e(document),o={};document.body.appendChild(r);var u=e.bindingHandlers.uptop=function(n,u){var a=n.value.match(e.rword)||["$","uptop"],f=a[0].trim(),l=a[1],c,h,p={},d={};if(f&&f!="$"){c=e.vmodels[f];if(!c)return}n.element.removeAttribute("ms-uptop"),c||(c=u.length?u[0]:{}),c&&typeof c[l]=="object"&&(h=c[l],h.$model&&(h=h.$model)),d=e.mix({},t,h||{},n[l]||{},e.getWidgetData(n.element,"uptop")),o=e.define("uptop",function(t){e.mix(t,d),t.$skipArray=["timeId"],t.timeId=0,t.goTop=function(){var e=s.scrollTop();d.animate?(o.timeId=setTimeout(function(){window.scrollBy(0,-100),o.goTop()},200),e==0&&clearTimeout(o.timeId)):window.scrollTo(0,0)}}),p={position:"fixed","background-image":"url("+o.backgroundUrl+")",cursor:"pointer"},i.css(p),e.scan(r,o)};return e(document).bind("scroll",a(f,100,200)),e});