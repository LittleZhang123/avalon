define(["../avalon.getModel","text!./avalon.notice.html","css!../chameleon/oniui-common.css","css!./avalon.notice.css"],function(e,t){function f(){var t=e(document).scrollTop();for(var n=0,r=i.length;n<r;n++){var a=i[n],f=a.style,l=e(a),c=a.vmodel;if(t>=s[n][2]){if(f.position!=="fixed"||o&&f.position!=="absolute"){var h=0,p=0;for(var d=1;d<=n;d++)h+=s[d-1][0];h=o?t+h:h,p=s[n][3],l.css({width:s[n][1]+"px",top:h+"px",left:p+"px",position:o?"absolute":"fixed","z-index":u}),c.affixPlaceholderDisplay="block"}}else l.css("position","static"),c.affixPlaceholderDisplay="none"}}function l(){var t=document.body.children,n=10,r;for(var i=0,s;s=t[i++];)s.nodeType===1&&(r=~~e(s).css("z-index"),r&&(n=Math.max(n,r)));return n+1}function c(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function h(e){var t=["","-webkit-","-o-","-moz-","-ms-"],n,r=document.documentElement.style;for(n in t){camelCase=c(t[n]+e);if(camelCase in r)return!0}return!1}function p(e,t){var n=t.elementHeight,r,i;if(h("transition"))r=e?n:0,e?t.height=r:setTimeout(function(){t.height=r},10),r&&setTimeout(function(){t.$fire("elementHeightOk")},600);else{r=e?0:n;function s(){r=e?r+1:r-1;if(r<0){t.height=0;return}if(r>n){t.height=n,setTimeout(function(){t.$fire("elementHeightOk")},600);return}t.height=r,setTimeout(s,0)}s()}}var n=t,r=[],i=[],s=[],o=(window.navigator.userAgent||"").toLowerCase().indexOf("msie 6")!==-1,u=0,a=e.ui.notice=function(t,o,a){function S(){if(!E.timer)return;window.clearTimeout(E.$closeTimer),E.$closeTimer=window.setTimeout(function(){E.toggle=!1},E.timer)}function x(){if(!E._isAffix)return;var t=e(v),n=t.offset(),r=v.offsetWidth,o=v.offsetHeight;E.noticeAffixWidth=r,E.noticeAffixHeight=o,v.vmodel=E,i.push(v),s.push([o,r,n.top,n.left]),f()}function T(){setTimeout(function(){var t=document.createElement("div"),n=v.cloneNode(!0),r,i=e(v).innerWidth(),s=v.parentNode;if(!i)while(s){s.nodeType===1&&(i=e(s).innerWidth());if(i)break;s=s.parentNode}t.style.position="absolute",t.style.height=0,document.body.appendChild(t),t.appendChild(n),r=e(n),r.css({visibility:"hidden",width:i,height:"auto"}),E.elementHeight=r.height(),document.body.removeChild(t)},10)}function N(){var t=[],n=E.container,i=!1;for(var s=0,o=r.length;s<o;s++){var u=r[s];if(u[2]===n){i=!0,n=E.isPlace?u[0]:u[1];if(!n){var a=document.createElement("div"),f=E.container.childNodes[0];f?E.container.insertBefore(a,f):E.container.appendChild(a),E.isPlace?(u[0]=n=a,e(a).addClass("oni-notice-flow")):(e(a).addClass("oni-notice-detach"),u[1]=n=a)}break}}if(!i){var a=document.createElement("div");if(E.isPlace){var f=n.childNodes[0];f?n.insertBefore(a,f):n.appendChild(a)}else n.appendChild(a);e(a).addClass(E.isPlace?"oni-notice-flow":"oni-notice-detach"),t[2]=n,E.isPlace?t[0]=n=a:t[1]=n=a,r.push(t)}return n}var c=o.noticeOptions,h=n;c.animate?(h=n.replace('ms-visible="toggle"',""),c.height=0):c.height="auto",c.template=c.getTemplate(h,c);var d=c.container;c.container=d?d.nodeType===1?d:document.getElementById(d.substr(1)):t;var v=null,m=t.innerHTML.trim(),g=c.onShow,y=null,b=c.onHide,w=null;typeof g=="string"&&(y=e.getModel(g,a),c.onShow=y&&y[1][y[0]]||e.noop),typeof b=="string"&&(w=e.getModel(b,a),c.onHide=w&&w[1][w[0]]||e.noop),t.innerHTML="",c.header!=="notice title"&&c.title==="notice title"&&(c.title=c.header);var E=e.define(o.noticeId,function(n){e.mix(n,c),n.$closeTimer=0,n.$skipArray=["template","widgetElement","_isAffix","container","elementHeight"],n.elementHeight=0,n.content=n.content||m,n._isAffix=n.isPlace&&n.isAffix,n.widgetElement=t,n.typeClass=n[n.type+"Class"],n.noticeAffixWidth=0,n.noticeAffixHeight=0,n.affixPlaceholderDisplay="none",n.isPlace?n.container:n.container=document.body,n._show=function(e){S(),x(),E.animate&&p(e,E),E.onShow.call(t,o,a)},n.$watch("elementHeightOk",function(){E.height="auto"}),n._close=function(){E.toggle=!1},n._hide=function(n){var r=i.indexOf(v),u=e(v);E.animate&&(E.elementHeight=u.innerHeight(),u.css("height",E.elementHeight),p(n,E));if(r!==-1){v.style.position="static",i.splice(r,1),s.splice(r,1);for(var l=0,c=i.length;l<c;l++)i[l].style.position="static";c&&f()}E.onHide.call(t,o,a)},n.setContent=function(e){E.content=e},n.$init=function(){var n=null,r=e.parseHTML(c.template),i=r.lastChild;u||(u=l()),v=r.firstChild,n=N(),n.appendChild(v);if(!E.isPlace){var s=e(c.container),o=e(s[0].parentNode);v.style.width=(s.width()||o.width())+"px",v.style.position="relative",v.style.left=s.offset().left+"px"}E._isAffix&&(n.appendChild(i),e.scan(i,[E])),e.scan(v,[E].concat(a)),typeof c.onInit=="function"&&c.onInit.call(t,E,c,a),E.animate&&T()},n.$remove=function(){var e=v.parentNode;for(var t=0,n=r.length;t<n;t++){var i=r[t];if(i[2]===c.container)break}if(E._isAffix){var s=v.nextSibling;e.removeChild(s)}v.innerHTML=v.textContent="",e.removeChild(v),e.children.length||(e.parentNode.removeChild(e),i[0]=void 0)}});return E.$watch("toggle",function(e){e?E._show(e):E._hide(e)}),E.$watch("type",function(e){E.typeClass=E[e+"Class"]}),E.$watch("header",function(e){E.title=e}),E.$watch("successClass",function(e){E.typeClass=e}),E.$watch("errorClass",function(e){E.typeClass=e}),E.$watch("infoClass",function(e){E.typeClass=e}),E.$watch("zIndex",function(e){u=e,f()}),E.$watch("content",function(){E.animate&&T()}),E};return e.bind(window,"scroll",function(){f()}),a.version=1,a.defaults={content:"",container:"",type:"info",header:"notice title",title:"notice title",timer:0,hasCloseBtn:!0,toggle:!1,isPlace:!0,isAffix:!1,onShow:e.noop,onHide:e.noop,successClass:"oni-notice-info",errorClass:"oni-notice-danger",infoClass:"",widgetElement:"",zIndex:"auto",animate:!0,getTemplate:function(e,t){return e}},e});