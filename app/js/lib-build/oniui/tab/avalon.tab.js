define(["avalon","text!./avalon.tab.html","text!./avalon.tab.panels.html","text!./avalon.tab.close.html","css!./avalon.tab.css","css!../chameleon/oniui-common.css"],function(e,t,n,r){function i(e,t){return e.replace(/\{\{MS_[A-Z_0-9]+\}\}/g,function(n){var n=(n.split("{{MS_OPTION_")[1]||"").replace(/\}\}/g,"").toLowerCase().replace(/_[^_]/g,function(e){return e.replace(/_/g,"").toUpperCase()});if(n=="event"&&t[n]){var i,s;if(i=e.match(new RegExp(" ms-"+t[n]+"[^'\\\"]","g"))){s=i.length,i=i.join(",");while(i.match(new RegExp(s,"g")))s++;return t[n]+"-"+s}}else if(n=="removable")return r;return t[n]||""})}function s(t,n,r){var i=[];for(var s=0,o;o=t&&t.children[s++];){if(o.tagName.toLowerCase()!=n)continue;var u=e(o).data(),a=n=="div"?{content:u.content||o.innerHTML,contentType:u.contentType||"content"}:{title:o.innerHTML,removable:u.removable,linkOnly:u.linkOnly,target:u.target||r||"_self",disabled:u.disabled==void 0?!1:u.disabled},f=u.href||o.getAttribute("href");f&&(a.href=f),i.push(a)}return i}var o=e.ui.tab=function(t,n,r){var o=n.tabOptions,u=[],a=[],f;e.each(o.tabs,function(e,t){t.disabled=!!t.disabled}),o.tabs==void 0&&(e.scan(t,r),f=o.tabContainerGetter(t),a=s(f,"li",o.target),o.distroyDom&&t.removeChild(f));if(o.tabpanels==void 0){panelsParent=o.panelContainerGetter(t),u=s(panelsParent,"div");if(o.distroyDom)try{t.removeChild(panelsParent)}catch(l){}}var c=e.define(n.tabId,function(n){n.$skipArray=["widgetElement","callInit"],n.tabs=[],n.tabpanels=[],e.mix(n,o),n.widgetElement=t;var s,f;n.$init=function(f){var l=f&&!e.isFunction(f);if(s||!l&&!n.callInit)return;s=!0,o.tabs||(n.tabs=a),n.tabpanels.length||(n.tabpanels=u),n.active=n.active>=n.tabs.length&&n.tabs.length-1||n.active<0&&0||parseInt(n.active)>>0,e(t).addClass("oni-tab oni-widget oni-widget-content"+(n.event=="click"?" oni-tab-click":"")+(n.dir=="v"?" oni-tab-vertical":"")+(n.dir!="v"&&n.uiSize=="small"?" oni-tab-small":""));var h=i(n._getTemplate(0,n),n),p=i(n._getTemplate("panel",n),n);t.innerHTML=c.bottom?p+h:h+p,f?f():(e.log("avalon请尽快升到1.3.7+"),e.scan(t,[c].concat(r)),typeof o.onInit=="function"&&o.onInit.call(t,c,o,r)),n.autoSwitch&&n._autoSwitch()},n._clearTimeout=function(){clearTimeout(f)},n.activate=function(e,t,r){if(n.tabs[t].disabled===!0||n.tabs[t].linkOnly)return;var i=this;if(n.event==="click"&&n.active===t){n.collapsible?(n.active=NaN,e.preventDefault()):o.onClickActive.call(i,e,c)||e.preventDefault();return}n.event==="click"&&e.preventDefault(),n.active!==t&&(n.active=t,o.onActivate.call(i,e,c))};if(n.event=="mouseenter"&&n.activeDelay){var l,h=n.activate;n.activate=function(t,r){clearTimeout(l);var i=this,s=arguments;l=setTimeout(function(){h.apply(i,[t,r,"fix event bug in ie"])},n.activeDelay),!i.getAttribute("leave-binded")&&0&&(i.setAttribute("leave-binded",1),e.bind(i,"mouseleave",function(){clearTimeout(l)}))}}return n._autoSwitch=function(){clearTimeout(f);if(n.tabs.length<2)return;f=setTimeout(function(){var e=n.active+1,t=0;while(e!=n.active&&t<n.tabs.length-1){e>=n.tabs.length&&(e=0);if(!n.tabs[e].disabled){n.active=e,n._autoSwitch();break}e++,t++}},n.autoSwitch)},n.$remove=function(){t.innerHTML=t.textContent=""},n.disable=function(t,r){r=r==void 0?!0:r,t instanceof Array||(t=[t]);var i=n.tabs.length;e.each(t,function(e,t){t>=0&&i>t&&(n.tabs[t].disabled=r)})},n.enable=function(e){n.disable(e,!1)},n.add=function(t){var r=t.title||"Tab Tile",i=t.content||"<div></div>",s=!1;n.tabpanels.forEach(function(e){e.contentType=="include"&&e.content==t.content&&(s=!0)});if(s===!0)return;n.tabpanels.push({content:i,contentType:t.contentType}),n.tabs.push({title:r,removable:t.removable,disabled:!1}),t.actived&&e.nextTick(function(){c.active=c.tabs.length-1})},n.remove=function(t,r){arguments.length==2?(t.preventDefault(),t.stopPropagation()):r=t;if(c.tabs[r].disabled===!0||c.tabs[r].removable===!1||c.tabs[r].removable==void 0&&!n.removable)return;c.tabs.removeAt(r),c.tabpanels.removeAt(r),r=r>1?r-1:0,e.nextTick(function(){c.active=r}),n.bottom=o.bottom},n._canRemove=function(e){return(e.removable==1||e.removable!==!1&&n.removable)&&!e.disabled&&n.dir!="v"},n._canActive=function(e,t){return n.active==t&&!e.disabled},n._isAjax=function(e){return n.contentType=="content"&&!e.contentType||e.contentType=="content"},n._cutCounter=function(){return(c.dir=="h"||c.forceCut)&&c.titleCutCount},n._shallPanelAlwaysShow=function(e){return c.shallPanelAlwaysShow||e===c.active},n.sliderIndex=0,n.sliderLength=0,n.nextEnable=0,n.prevEnable=0,n.slider=function(e,t){e.preventDefault();var r;t==="prev"?(r=n.sliderIndex-1,r=r>0?r:0):(r=n.sliderIndex+1,r=r<=n.sliderLength-1?r:n.sliderLength-1),n.sliderIndex=r,n.buttonEnable()},n.computeSlider=function(){if(n.dir==="v")return;var e=document.getElementById("tabs"+n.tabs.$id);if(e){var t=e.scrollWidth,r=e.parentNode.parentNode.clientWidth;t>r?n.sliderLength=t/r:n.sliderLength=0,n.buttonEnable()}},n.buttonEnable=function(){n.sliderIndex>=n.sliderLength-1?n.nextEnable=0:n.nextEnable=1,n.sliderIndex<=0?n.prevEnable=0:n.prevEnable=1},n});return c.autoSwitch&&(e.bind(t,"mouseenter",function(){c._clearTimeout()}),e.bind(t,"mouseleave",function(){c._clearTimeout(),c._autoSwitch()}),c.$watch("autoSwitch",function(e,t){c._clearTimeout(),e&&c._autoSwitch()})),c};o.defaults={target:"_blank",toggle:!0,autoSwitch:!1,active:0,shallPanelAlwaysShow:!1,event:"mouseenter",removable:!1,activeDelay:0,collapsible:!1,contentType:"content",bottom:!1,dir:"h",callInit:!0,titleCutCount:8,distroyDom:!0,cutEnd:"...",forceCut:!1,onInit:e.noop,tabContainerGetter:function(e){return e.getElementsByTagName("ul")[0]||e.getElementsByTagName("ol")[0]},panelContainerGetter:function(e){return e.getElementsByTagName("div")[0]||e},onActivate:e.noop,onClickActive:e.noop,onAjaxCallback:e.noop,_getTemplate:function(e,i){var s,o;return e=="panel"?s=n:e=="close"?s=r:s=t,o=i.getTemplate(s,i,e),o||o===""?o:s},getTemplate:function(e,t,n){return e},_tabTitle:function(t,n,r,i){var s;n.titleCutCount!=void 0?s=n.titleCutCount:r!=void 0&&(s=r);if(!s)return t;var o=t.split(/<[^>]+>/g),u=0,a=0,f;return e.each(o,function(e,n){if(f>=0)a="";else{var r=n.trim();u+r.length>s?(f=e,a=r.substr(0,s-u)+i):(u+=r.length,a=0)}if(a===0)return;t=t.replace(n,a)}),t},$author:"skipper@123"}});