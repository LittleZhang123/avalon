define(["avalon","text!./avalon.loading.html","text!./avalon.loading.bar.html","css!./avalon.loading.css","css!../chameleon/oniui-common.css"],function(e,t,n){function f(e,t,n,r){t.drawer=n,t.effect=r,a[e]=t}function l(e){return document.getElementById(e)}function c(e,t,n){var r=[],i=n||36,e=e-t,s,o,u,a;for(var f=0;f<=i;f++)s=Math.PI/2-Math.PI*2/i*f,o=Math.cos(s)*e+e*1+t*1,u=(1-Math.sin(s).toFixed(4))*e+t*1,a=(f?" L":"M")+o+" "+u+(f==100?"Z":""),r.push(a);return r}var r=0,i=navigator.userAgent.match(/msie/ig)||"ActiveXObject"in window,s=99999-Math.random()*1e4>>0,o={},u=n.split("{{MS_WIDGET_TYPE}}"),a={};e.each(u,function(e,t){var n,t=t.trim().replace(/^\{\{MS_WIDGET_[^\}]+\}\}/g,function(e){return n=e.replace(/\{\{MS_WIDGET_|\}\}/g,"").replace(/_/g,"-").toLowerCase(),""});n&&(n=n,t=t.split("{{MS_WIDGET_DIVIDER}}"),o[n]={svg:t[1]||t[0],vml:t[0]})}),f("ball",{width:32,widthInner:28,count:10,interval:120,circleMargin:1,svgDur:"1s"},function(e){var t=e.type,n=e.count,r=e.width,i=r/2,s=e.interval,o=(r-e.widthInner)/2;return t==="ball"&&(e.svgDur=s*n/1e3+"s"),function(t){var r=Math.PI*(.5-2*t/n);e.data.push({x:(i-o)*(Math.cos(r)+1),y:(o-i)*(Math.sin(r)-1),r:o,begin:[s*t/1e3,"s"].join("")}),e.opacities.push((t/n).toFixed(2))}},function(t,n,r,s){if(!i&&t.type!=="ticks"&&t.type!="spinning-spin")return;var r=Array.isArray(r)?r:["circle","oval"],o=t.svgSupport?r[0]:r[1],n=n.getElementsByTagName(o),u=n.length,a=u,f=[],l;return e.each(n,function(n,r){f.push(e(r)),n===u-1&&!t.svgSupport&&(r.style.display="none",r.style.display="block")}),t.type==="ticks"?(a=0,function(){for(var e=0;e<u;e++){var n=e>a?t.opacities[1]:t.opacities[0];f[e]&&f[e].css("visibility",n>=1?"visible":"hidden")}a++,a>=u&&(a=-1)}):function(){a--,a<0&&(a=u-1);for(var e=0;e<u;e++)if(s)s(f[e],e,a);else{var n=t.opacities[(e+a)%u]*100/100;f[e]&&f[e].css("opacity",n)}}}),f("ticks",e.mix({},a.ball,{count:3,height:20,interval:360}),function(e){var t=e.count,n=2+e.circleMargin,r=(e.width-e.widthInner)/2,i=(e.width-r*(3*t-1))/2;return function(t){e.data.push({x:i+t*n*r,y:e.height/2-r,r:r,begin:[e.interval*t/1e3,"s"].join("")}),e.opacities.push(t?0:1)}},a.ball.effect),o.ticks=o.ball,f("spin",{width:32,widthInner:26,angel:90,arc:"",circle:"",radius:"",opacity:.2,startangle:0,endangle:0,interval:36,$circleData:"",$partsData:"",spinPoint:"23 23",svgDur:"1s",data:[1]},function(e){e.radius=e.width/2-e.widthInner/2;if(e.svgSupport){e.svgDur=e.interval*36/1e3+"s",e.spinPoint=[e.width/2,e.width/2].join(" ");var t=e.$circleData=c(e.width/2,e.width/2-e.widthInner/2),n=e.$partsData=t.slice(0,Math.floor(e.angel/360*(t.length-1)));e.arc=n.join(""),e.circle=t.join("")}else e.startangle=0,e.endangle=e.angel},function(t,n){if(!i)return;var r=stepper=t.angel;if(t.svgSupport){var s=t.$circleData.length,n=e(n.getElementsByTagName("path")[0]);return r=stepper=Math.floor(t.angel/360*s),function(){stepper+=1,stepper>=s&&(stepper=0),n.attr("transform","rotate("+stepper*10+" "+t.spinPoint+")")}}return function(){stepper+=10;var e=stepper-r;stepper>360&&(stepper-=360,e-=360),t.startangle=e,t.endangle=stepper}}),f("spokes",{count:8,width:32,spokesWidth:4,spokesHeight:8,interval:125,svgPath:"M14 0 H18 V8 H14 z",svgDur:"1s"},function(e){var t=e.count,n=e.width,r=e.spokesWidth,i=e.spokesHeight,s=0,o=e.interval;if(e.svgSupport){e.svgPath=["M",(n-r)/2," 0 H",(n+r)/2," V",i," H",(n-r)/2," z"].join(""),e.svgDur=o*t/1e3+"s";var u=360/t;return function(r){e.data.push({begin:[o*r/1e3,"s"].join(""),rotate:["rotate(",r*u," ",[n/2,n/2].join(" ")+")"].join("")}),e.opacities.push((r/t).toFixed(2))}}var u=Math.PI*2/t,a,f=r/2;return function(i){a=Math.PI/2-u*i;var s=Math.sin(a),o=Math.cos(a),f=(i/t).toFixed(2);e.data.push({spokesRotation:360*i/t,spokesOpacity:f*50,spokesLeft:(n/2-r)*(1+o),spokesTop:(n/2-r)*(1-s)}),e.opacities.push(f)}},function(e,t){return a.ball.effect(e,t,["path","rect"])}),f("spinning-bubbles",e.mix({},a.ball,{width:64,widthInner:54,$zooms:[]}),function(e){var t=a.ball.drawer(e),n=e.count;n>=7?e.$zooms=[.2,.4,.8,1,.8,.4,.2]:n>=5?e.$zooms=[.2,.8,1,.8,.2]:e.$zooms=[1,.1,.1,.1];while(e.$zooms.length<e.count)e.$zooms.push(.1);return function(e){t(e)}},function(e,t){var n=(e.width-e.widthInner)/2,r=e.count;return e.svgSupport?a.ball.effect(e,t,["circle","oval"],function(t,i,s){t.attr("r",n*e.$zooms[(i+s)%r])}):a.ball.effect(e,t,["circle","oval"],function(t,n,r){t.css("zoom",e.$zooms[(n+r)%e.count])})}),f("bubbles",e.mix({},a["spinning-bubbles"],{height:30,widthInner:50,count:3,interval:360,circleMargin:.5}),function(e){return a["spinning-bubbles"].drawer(e),a.ticks.drawer(e)},a["spinning-bubbles"].effect),f("spinning-spin",e.mix({},a.spin,{opacities:[],data:[],radius:1,interval:a.ball.interval,count:8,width:46,widthInner:38,padding:5}),function(e){function u(t){var n=(t/i).toFixed(2);n=n>.6?n:.2,e.opacities.push(n)}var t=360/e.padding*3,n=e.width/2,r=c(n,n-e.widthInner/2,t),i=e.count,s=e.interval,o=360/i;return e.radius=e.width/2-e.widthInner/2,e.svgSupport?(e.svgDur=s*i/1e3+"s",e.arc=r.slice(0,Math.floor((1/i-e.padding/360)*r.length)).join(""),function(t){e.data.push({rotate:"rotate("+o*t+" "+n+" "+n+")",begin:[s*t/1e3,"s"].join("")}),u(t)}):function(t){e.data.push({startangle:t/i*360,endangle:(t+1)/i*360-10}),u(t)}},function(e,t){return a.ball.effect(e,t,["path","arc"])}),f("img",{src:"https://source.qunarzz.com/piao/images/loading_camel.gif",width:52,height:39,miao:0},void 0,void 0);var h=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,p=e.ui.loading=function(n,i,u){var f=i.loadingOptions;f.template=f.getTemplate(t,f),a[f.type]||(f.type="ball"),e.each(a[f.type],function(e,t){f[e]===void 0&&(f[e]=t)});var c=e.define(i.loadingId,function(t){t.height="",t.width="",t.data=[],t.opacities=[],e.mix(t,f),t.widgetElement=n,t.svgSupport=h,t.$loadingID=r+""+s,t.$timer="",t.$skipArray=["widgetElement","template","opacities","data"];var i;t.$init=function(t){if(i)return;i=!0;var r,s=f.container||c.widgetElement,a=(e.type(s)==="object"&&s.nodeType===1&&document.body.contains(s)?s:document.getElementById(s))||document.body,l=c.type,h=(o[l]||o.ball)[c.svgSupport?"svg":"vml"],p=0;c.width=c.width==0?c.height:c.width,c.height=c.height==0?c.width:c.height;if(c.drawer){var d=0,v=c.drawer(c);while(d<c.count&&v)v(d),d++}a.appendChild(e.parseHTML(c.template.replace("{{MS_WIDGET_HTML}}",h).replace("{{MS_WIDGET_ID}}",c.$loadingID))),e.log("avalon请尽快升到1.3.7+"),e.scan(a,[c].concat(u)),typeof f.onInit=="function"&&f.onInit.call(n,c,f,u),c._effect()},t._effect=function(){if(c.toggle){var e=document.getElementById("oni-loading-"+c.$loadingID);if(e){var t=c.effect&&c.effect(c,e);t&&(clearInterval(c.$timer),c.$timer=setInterval(t,c.interval))}}},t.$remove=function(){clearInterval(c.$timer),n.innerHTML=n.textContent=""},t.showLoading=function(){if(c.toggle)return;c.toggle=!0,c._effect()},t.hideLoading=function(){c.toggle=!1},t.destroyLoading=function(){c.toggle=!1,c.$remove()},t.appendTo=function(e){var n=e||t.widgetElement,r=l("modal"+t.$id),i=l("loading"+t.$id);r&&n.appendChild(r),i&&n.appendChild(i)}});return c.$watch("toggle",function(e){e?c._effect():clearInterval(c.$timer)}),r++,c};p.defaults={onInit:e.noop,color:"#619FE8",type:"ball",toggle:!0,modal:!0,modalOpacity:.1,modalBackground:"#fff",container:void 0,getTemplate:function(e,t,n){return e},$author:"skipper@123"}});