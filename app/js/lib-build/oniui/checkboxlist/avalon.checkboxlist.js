define(["../avalon.getModel","text!./avalon.checkboxlist.html","css!../chameleon/oniui-common.css","css!./avalon.checkboxlist.css"],function(e,t){function r(t,n){var r=[],i=!0;n=n&&n.$model,e.each(t.data,function(e,t){r.push(t.value||t.text)}),t.keys=r,e.each(r,function(e,t){n.indexOf(t)===-1&&(i=!1)}),t.all=i}var n=e.ui.checkboxlist=function(n,i,s){var o=i.checkboxlistOptions,u=typeof o.fetch=="string"?e.getModel(o.fetch,s):o.fetch,a=u&&e.type(u)==="array"&&u[1][u[0]]||o.fetch||null,f=typeof o.onSelect=="string"?e.getModel(o.onSelect,s):!1,l=f&&f[1][f[0]]||e.noop,c=e.type(a)==="function"?a:null,h=e.define(i.checkboxlistId,function(r){e.mix(r,o),r.$skipArray=["widgetElement","template","keys"],r.widgetElement=n,r.keys=[],r._clickAll=function(e){setTimeout(function(){var t=e.target.checked;t?p[1][p[0]]=h.keys.map(function(e){return e+""}):p[1][p[0]].clear(),l.apply(0,[r.data.$model,t,e.target])},20)},r._clickOne=function(e,t){l.apply(0,[r.data.$model,e.target.checked,e.target])},r.$init=function(r){var i=t.replace("MS_OPTIONS_DUPLEX",o.duplex);h.template=h.getTemplate(i,o),n.className+=" oni-checkboxlist oni-checkboxlist-list oni-helper-clearfix",n.innerHTML=h.template,r?r():(e.log("avalon请尽快升到1.3.7+"),e.scan(n,[h].concat(s)),typeof o.onInit=="function"&&o.onInit.call(n,h,o,s))},r.$remove=function(){n.innerHTML=""}}),p=e.getModel(o.duplex,[h].concat(s)),d=p&&p[1][p[0]];h.data.$watch("length",function(e){e&&r(h,d)});if(!d)throw new Error("未配置duplex");n.value=d.$model.join(","),d.$watch("length",function(e){e==0?n.value="":n.value=p[1][p[0]].join(","),h.all=e==h.data.length});if(h.data.length)return r(h,d),h;if(o.fetch)c.apply(0,[function(t){h.data=t;var t=[];e.each(h.data,function(e,n){t.push(n.value||n.text)}),h.keys=t}]);else{var v=document.createElement("div");while(n.firstChild)v.appendChild(n.firstChild);switch(o.type){case"week":var i=[{text:"周一",value:"MONDAY"},{text:"周二",value:"TUESDAY"},{text:"周三",value:"WEDNESDAY"},{text:"周四",value:"THURSDAY"},{text:"周五",value:"FRIDAY"},{text:"周六",value:"SATURDAY"},{text:"周日",value:"SUNDAY"}];break;default:var m=v.getElementsByTagName("input"),i=[];for(var g=0;g<m.length;g++){var y=m[g],b=y.parentNode,w="";while(b){if(b.tagName=="LI")break;b=b.parentNode}w=b.textContent||b.innerText,w.replace(/^\s+/,"").replace(/\s+$/,""),i.push({text:w,value:y.value||w})}}h.data=i}return e.ui.checkboxlist.defaults.data=[],h};return n.version=1,n.defaults={data:[],all:!1,alltext:"全部",type:"",fetch:"",template:"",onSelect:e.noop,getTemplate:function(e,t){return e},vertical:!0},e});