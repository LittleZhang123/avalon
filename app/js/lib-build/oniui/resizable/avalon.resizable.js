define(["../draggable/avalon.draggable"],function(e){function r(e,t,n){var r="",i=t.offset(),s=t[0].offsetWidth,o=t[0].offsetHeight,u=n.edge;e.pageY>i.top&&e.pageY<i.top+u?r+="n":e.pageY<i.top+o&&e.pageY>i.top+o-u&&(r+="s"),e.pageX>i.left&&e.pageX<i.left+u?r+="w":e.pageX<i.left+s&&e.pageX>i.left+s-u&&(r+="e");for(var a=0,f;f=n.handles[a++];)if(f==="all"||f===r)return r;return""}function i(e,t){var n=parseInt(e.css(t),10);return isNaN(n)?0:n}function s(e,t,n){var r=n;if(n._aspectRatio||e.shiftKey){var i=!0,s=r.minHeight*n.aspectRatio,o=r.minWidth/n.aspectRatio,u=r.maxHeight*n.aspectRatio,a=r.maxWidth/n.aspectRatio;s>r.minWidth&&(r.minWidth=s),o>r.minHeight&&(r.minHeight=o),u<r.maxWidth&&(r.maxWidth=u),a<r.maxHeight&&(r.maxHeight=a)}if(n.dir.indexOf("e")!==-1){var f=n.startResizeWidth+e.pageX-n.startPageX;f=Math.min(Math.max(f,r.minWidth),r.maxWidth),n.resizeWidth=f,i&&(n.resizeHeight=f/n.aspectRatio)}if(n.dir.indexOf("s")!==-1){var l=n.startResizeHeight+e.pageY-n.startPageY;l=Math.min(Math.max(l,r.minHeight),r.maxHeight),n.resizeHeight=l,i&&(n.resizeWidth=l*n.aspectRatio)}n.dir.indexOf("w")!==-1&&(n.resizeWidth=n.startResizeWidth-e.pageX+n.startPageX,n.resizeWidth>=r.minWidth&&n.resizeWidth<=r.maxWidth&&(n.resizeLeft=n.startResizeLeft+e.pageX-n.startPageX,i&&(n.resizeTop=n.startResizeTop+(e.pageX-n.startPageX)/n.aspectRatio))),n.dir.indexOf("n")!==-1&&(n.resizeHeight=n.startResizeHeight-e.pageY+n.startPageY,n.resizeHeight>=r.minHeight&&n.resizeHeight<=r.maxHeight&&(n.resizeTop=n.startResizeTop+e.pageY-n.startPageY,i&&(n.resizeLeft=n.startResizeLeft+(e.pageY-n.startPageY)*n.aspectRatio)));var c={left:n.resizeLeft,top:n.resizeTop,width:n.resizeWidth,height:n.resizeHeight};for(var h in c)t.css(h,c[h])}var t=e.bindingHandlers.draggable,n=e.bindingHandlers.resizable=function(o,u){var a=o.value.match(e.rword)||["$","resizable"],f=a[0].trim(),l=a[1],c,h;if(f&&f!="$"){c=e.vmodels[f];if(!c)return}c||(c=u.length?u[0]:null);var p=c||{};c&&typeof c[l]=="object"&&(h=c[l],h.$model&&(h=h.$model),p=h);var d=o.element;d.removeAttribute("ms-resizable");var v=e.mix({},n.defaults,h||{},e.getWidgetData(d,"resizable"));"stop,start,resize,drag".replace(e.rword,function(t){var n=v[t];typeof n=="string"&&(typeof p[n]=="function"?v[t]=p[n]:v[t]=e.noop)}),v.handles=v.handles.match(e.rword)||["all"],v._aspectRatio=typeof v.aspectRatio=="number";var m=e(d);m.bind("mousemove",function(e){if(v.started)return;var t=r(e,m,v);v._cursor=m.css("cursor"),t===""?m.css("cursor","default"):m.css("cursor",t+"-resize")}),m.bind("mouseleave",function(e){m.css("cursor",v._cursor),delete v._cursor});var g=v.drag||e.noop,y=document.body;v.beforeStart=function(t,n){var s=n.$element;n.dragX=n.dragY=!1;var o=r(t,s,n);if(o==="")return;e.mix(n,{dir:o,startResizeLeft:i(s,"left"),startResizeTop:i(s,"top"),startResizeWidth:s.width(),startResizeHeight:s.height()}),"startResizeLeft,startResizeTop,startResizeWidth,startResizeHeight".replace(e.rword,function(e){n[e.replace("startR","r")]=n[e]}),n.aspectRatio=n._aspectRatio?n.aspectRatio:n.startResizeWidth/n.startResizeHeight||1,t.type="resizestart",e(y).css("cursor",o+"-resize")},v.drag=function(e,t){t.dir?(s(e,t.$element,t),e.type="resize",t.resize.call(t.element,e,t)):"_cursor"in v&&g.call(t.element,e,t)},v.beforeStop=function(t,n){if(n.dir){var r=n.$element;s(t,r,n),delete n.dir,t.type="resizeend",e(y).css("cursor","default")}},o.value="",o.draggable=v,t(o,u)};return n.defaults={handles:"n,e,s,w,ne,se,sw,nw",maxHeight:1e4,maxWidth:1e4,minHeight:10,minWidth:10,cursor:!1,edge:5,start:e.noop,resize:e.noop,stop:e.noop},e});