define(["avalon"],function(e){var t=e.ui.preview=function(t,n,r){function l(e,t){e.style.width=t.width+"px",e.style.height=t.height+"px",e.className=t.className}function c(e,t,n){var r=new Image;e.appendChild(r),l(r,n),r.src=t}var i=n.previewOptions,s,o=i.fileInput;typeof o=="string"&&(o=document.getElementById(o));var u=!1;try{o.nodeType===1&&o.tagName==="INPUT"&&o.type==="file"&&(u=!0)}catch(a){}if(u===!1)throw new Error("fileInput必须是input[type=file]元素节点或其ID值");i.fileInput=o;var f=e.oneObject(["image/gif","image/png","image/jpeg"]),h=e.define(n.previewId,function(n){e.mix(n,i),n.$skipArray=["fileInput","widgetElement"],n.widgetElement=t,n.$init=function(){var u=[h].concat(r);s=e.bind(o,"change",function(){var e=[],r=o.files||[];for(var i=0,s;s=r[i++];)f[s.type]&&e.push(s);e.forEach(function(e){if(window.FileReader){var r=new FileReader;return r.onload=function(e){c(t,e.target.result,n)},r.readAsDataURL(e)}var i;window.createObjectURL!==void 0?i=window.createObjectURL(e):window.URL!==void 0?i=window.URL.createObjectURL(e):window.webkitURL!==void 0&&(i=window.webkitURL.createObjectURL(e));if(typeof i=="string")return c(t,i,n)});if(e.length===0&&document.selection){o.select();var u=document.selection.createRange().text;document.selection.empty();var a=document.createElement("div");t.appendChild(a),l(a,n),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)",a.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=u}}),e.scan(t,u),typeof i.onInit=="function"&&i.onInit.call(t,h,i,r)},n.$remove=function(){e.unbind(o,"change",s),e.log("at $remove")}});return h};return t.vertion=1,t.defaults={width:200,height:160,className:""},e});