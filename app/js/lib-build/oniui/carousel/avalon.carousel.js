define(["avalon","text!./avalon.carousel.html","css!./avalon.carousel.css","css!../chameleon/oniui-common.css"],function(e,t){var n,r=document.getElementsByTagName("SCRIPT");for(var i in r)if(r[i].outerHTML&&r[i].outerHTML.indexOf("avalon.carousel.js")!==-1){var s=r[i].src;n=s.substring(0,s.lastIndexOf("/"))}var o=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,10)}}(),u={linear:function(e,t,n,r){return n*e/r+t},easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}},a=e.ui.carousel=function(r,i,s){var a=i.carouselOptions;a.template=a.getTemplate(t,a);var f=e.define(i.carouselId,function(t){e.mix(t,a),t.widgetElement=r,t.picNum=t.pictures.length+1,t.pictureOpacity={},t.itemPosition="relative",t.panelPosition="absolute",t.selections=e.range(t.pictures.length),t.currentIndex=0,t.selectionWrapOffset=-t.pictures.length*20/2,t.panelOffsetX=0,t.arrowVisible=!1,t.arrowLeftBg=t.arrowLeftNormalSrc!==""?"url("+t.arrowLeftNormalSrc+")":"",t.arrowRightBg=t.arrowRightNormalSrc!==""?"url("+t.arrowRightNormalSrc+")":"",t.$skipArray=["widgetElement","template","selectionWrapOffset"];var i;t.$init=function(o){if(i)return;i=!0;var u=a.template;r.style.display="none",r.innerHTML=u,r.style.display="block";if(t.adaptiveWidth||t.pictureWidth==="100%")t.pictureWidth=r.offsetWidth;if(t.adaptiveHeight||t.pictureHeight==="100%"){r.style.height="100%";var l=r.children;for(var c=0,h=l.length;c<h;c++)l[c].getAttribute("class")==="oni-carousel"&&(l[c].style.height="100%")}var p=[],d=[];p.push(t.pictures);for(var c=0;c<p.length;c++){var v=new Image;v.src=p[c]}d.push("/images/arrows-left-hover-icon.png","/images/arrows-right-hover-icon.png");for(var c=0;c<d.length;c++){d[c]=n+d[c];var v=new Image;v.src=d[c]}o?o():(e.log("请尽快升到avalon1.3.7+"),e.scan(r,_vmodels),typeof a.onInit=="function"&&a.onInit.call(r,f,a,s))},t.$remove=function(){r.innerHTML=r.textContent=""},t.stopPlay=function(){t.arrowVisible=t.alwaysShowArrow?!0:!1,t.hoverStop&&t.autoSlide&&(clearTimeout(d),d=null)},t.restartPlay=function(e){e==="carousel"&&(t.arrowVisible=!1),t.autoPlay(t)},t.fadein=1,t.fadeout=0;var l=!1,c=t.during/10,h;t.animate=function(e,n){if(l)return;n=n||1;if(t.effect==="slide"){e===1&&t.panelOffsetX===-t.pictureWidth*(t.picNum-1)?t.panelOffsetX=0:e===-1&&t.panelOffsetX===0&&(t.panelOffsetX=-t.pictureWidth*(t.picNum-1));var r=t.panelOffsetX-t.pictureWidth*e*n,i=0,s=t.panelOffsetX,a=t.pictureWidth*-e*n,f=function(){l=!1,t.panelOffsetX<=-t.pictureWidth*(t.pictures.length-1)&&e>0?t.panelOffsetX=0:t.panelOffsetX>=0&&e<0?t.panelOffsetX=-t.pictureWidth*(t.picNum-1):(t.panelOffsetX=u[t.easing](i,s,a,c),i<c&&(i+=1,o(f),l=!0))}}else if(t.effect==="fade")var i=0,f=function(){l=!1,t.fadein=u[t.easing](i,0,1,c),t.fadeout=u[t.easing](i,1,-1,c),i<c&&(i+=1,o(f),l=!0)};else var f=function(){t.fadein=1,t.fadeout=0};f(),h=t.currentIndex,t.currentIndex+=1*e*n,t.currentIndex>t.selections.length-1?t.currentIndex=0:t.currentIndex<0&&(t.currentIndex=t.selections.length-1)},t.getOpacity=function(e){if(t.effect!=="slide"){var n=t.fadein+t.fadeout;return e===t.currentIndex?t.fadein:e===h?t.fadeout:0}return 1};var p=0;t.selectPic=function(e,n){p=e;if(n.type===t.eventType||t.eventType==="both"){var r=t.currentIndex-e,i=r>0?-1:1;n.type==="mouseenter"?setTimeout(function(){t.animate(i,Math.abs(r))},300):t.animate(i,Math.abs(r)),t.autoSlide&&(clearTimeout(d),d=null)}var s=setInterval(function(){if(t.currentIndex!==p){var e=t.currentIndex-p,n=e>0?-1:1;t.animate(n,Math.abs(e))}else clearInterval(s)},800)},t.arrowHover=function(e){e==="left"?t.arrowLeftBg=t.arrowLeftHoverSrc!==""?"url("+t.arrowLeftHoverSrc+")":"":t.arrowRightBg=t.arrowRightHoverSrc!==""?"url("+t.arrowRightHoverSrc+")":""},t.arrowBlur=function(e){e==="left"?t.arrowLeftBg=t.arrowLeftNormalSrc!==""?"url("+t.arrowLeftNormalSrc+")":"":t.arrowRightBg=t.arrowRightNormalSrc!==""?"url("+t.arrowRightNormalSrc+")":""};var d=null;t.autoPlay=function(){if(d===null&&t.autoSlide){function e(){d=setTimeout(function(){t.animate(1),e()},t.timeout)}e()}}});return f.effect!=="slide"&&(f.itemPosition="absolute",f.panelPosition="relative"),f.pictures.push(f.pictures[0]),f.autoPlay(f),f};a.vertion="1.0.1",a.defaults={pictures:[],pictureWidth:500,pictureHeight:200,effect:"slide",easing:"easeInOut",timeout:2500,during:300,alwaysShowArrow:!0,alwaysShowSelection:!0,autoSlide:!0,hoverStop:!0,adaptiveWidth:!1,adaptiveHeight:!1,eventType:"click",arrowLeftNormalSrc:"",arrowRightNormalSrc:"",arrowLeftHoverSrc:"",arrowRightHoverSrc:"",arrowLeftClass:"",arrowRightClass:"",onInit:e.noop,getTemplate:function(e,t,n){return e},$author:"heiwu805@hotmail.com"}});