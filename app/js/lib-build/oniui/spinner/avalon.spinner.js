define(["../avalon.getModel","text!./avalon.spinner.html","css!../chameleon/oniui-common.css","css!./avalon.spinner.css"],function(e,t){var n=e.ui.spinner=function(n,r,i){function m(){var e=Number(n.value),t=v.min,r=v.max;typeof t=="number"&&!isNaN(Number(t))&&e<t&&(e=t),typeof r=="number"&&!isNaN(Number(r))&&e>r&&(e=r),v.value=n.value=e}function g(){var t=e(n);t.addClass("oni-textbox-input"),t.attr("ms-css-width","width"),t.attr("ms-class","oni-state-disabled:disabled"),t.bind("blur",function(){value=n.value,v.value=n.value=value}),t.bind("keydown",function(e){switch(e.which){case 38:return v._add(e),!1;case 40:return v._sub(e),!1}})}function y(e){var t=Number(e)||0,n=v.min,r=v.max;return typeof n=="number"&&!isNaN(Number(n))&&t<n&&(t=n),typeof r=="number"&&!isNaN(Number(r))&&t>r&&(t=r),parseFloat(t)}var s=r.spinnerOptions,o=t,u=function(){var e,t;for(var n in e)if(n.indexOf("ms-duplex")===0)return e[n]}(),a=u&&e.getModel(u,i)||null,f=n.msData["ms-disabled"],l=f&&e.getModel(f,i)||null,c=Number(s.min),h=Number(s.max),p,d;a&&a[1].$watch(a[0],function(e){v.value=e}),l&&l[1].$watch(l[0],function(e){v.disabled=e}),isNaN(c)&&typeof s.min=="string"&&(p=e.getModel(s.min,i)||null,p?(p[1].$watch(p[0],function(e){v.min=e}),s.min=p[1][p[0]]):s.min=NaN),isNaN(h)&&typeof s.max=="string"&&(d=e.getModel(s.max,i)||null,d?(d[1].$watch(d[0],function(e){v.max=e}),s.max=d[1][d[0]]):s.max=NaN),s.template=s.getTemplate(o,s),s.value=s.value||n.value,s.disabled=f&&l&&l[1][l[0]]||n.disabled||!1;var v=e.define(r.spinnerId,function(t){e.mix(t,s),t.$skipArray=["widgetElement","step"],t.widgetElement=n;var r=null;t.$init=function(){r=e.parseHTML(s.template).firstChild;var t=r.getElementsByTagName("b")[0],o=t.parentNode,u=document.createElement("div"),a=n.parentNode;g(),a.insertBefore(u,n),o.appendChild(n),o.removeChild(t),a.replaceChild(r,u),e.scan(r,[v].concat(i)),typeof s.onInit=="function"&&s.onInit.call(n,v,s,i),setTimeout(function(){m()},400)},t.$remove=function(){r.innerHTML=r.textContent="",r.parentNode.removeChild(r)},t._add=function(e){var t=Number(n.value),r=0;r=t+(s.step||1),r=y(r),v.value=n.value=r,s.onIncrease.call(e.target,r)},t._sub=function(e){var t=Number(n.value),r=0;r=t-(s.step||1);if(isNaN(r))throw new Error("输入域的值非数值，或者step的设置为非数值，请检查");r=y(r),v.value=n.value=r,s.onDecrease.call(e.target,r)},t.$watch("value",function(e){n.value=e}),t.$watch("min",function(){m()}),t.$watch("max",function(){m()})});return v};return n.version=1,n.defaults={min:NaN,max:NaN,step:1,width:"auto",value:0,disabled:!1,widgetElement:"",getTemplate:function(e,t){return e},onDecrease:e.noop,onIncrease:e.noop},e});