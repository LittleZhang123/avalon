define(["avalon"],function(){function t(e){for(var t=1;t<arguments.length;t++)n(this,arguments[t]);this.duration=typeof this.duration=="number"?this.duration:400,this.queue=this.queue==null||!!this.queue,this.easing=avalon.easing[this.easing]?this.easing:"swing",this.update=!0,this.gotoEnd=!1}function n(e,t,r){if(t==="slow")e.duration=600;else if(t==="fast")e.duration=200;else switch(avalon.type(t)){case"object":for(var i in t)n(e,t[i],i);break;case"number":e.duration=t;break;case"string":e.easing=t;break;case"function":r=r||"complete",e.bind(r,t)}}function i(e,t){var n=[null,null],r=[null,null],i=[null,null],s=function(s,o){return i[o]=3*e[o],r[o]=3*(t[o]-e[o])-i[o],n[o]=1-i[o]-r[o],s*(i[o]+s*(r[o]+s*n[o]))},o=function(e){return i[0]+e*(2*r[0]+3*n[0]*e)},u=function(e){var t=e,n=0,r;while(++n<14){r=s(t,0)-e;if(Math.abs(r)<.001)break;t-=r/o(t)}return t};return function(e){return s(u(e),1)}}function o(t){if(t.queue){var n=1;for(var r=s.length,i;i=s[--r];)if(i.elem===t.elem){i.troops.push(t),n=0;break}n&&s.unshift(t)}else s.push(t);o.id===null&&(o.id=setInterval(u,1e3/e.fps))}function u(){var e=s.length;while(--e>=0)s[e].paused||(!s[e].elem||!a(s[e],e))&&s.splice(e,1);s.length||(clearInterval(o.id),o.id=null)}function a(e,t){var n=+(new Date);if(!e.startTime){e.fire("before");var r=e.elem;avalon.css(r,"display")==="none"&&!r.dataShow&&e.build(),e.createTweens(),e.build(),e.startTime=n}else{var i=(n-e.startTime)/e.duration,o=e.gotoEnd||i>=1;if(e.update){for(var u=0,a;a=e.tweens[u++];)a.run(i,o);e.fire("step")}if(o){e.fire("after"),e.fire("complete");if(e.revert)this.revertTweens(),delete this.startTime,this.gotoEnd=!1;else{var f=e.troops.shift();if(!f)return!1;s[t]=f,f.troops=e.troops}}}return!0}function f(e){this.$events={},this.elem=e,this.troops=[],this.tweens=[],this.orig=[],this.props={},this.dataShow={}}function h(e,t,n,r){var i=e.elem,s=i.dataShow||{},o=new p(t,e),u=s[t]||o.cur(),a;if(/color$/.test(t))parts=[b(u),b(n)];else{parts=c.exec(u);var f=parts&&parts[3]||(avalon.cssNumber[t]?"":"px");n==="toggle"&&(n=r?"show":"hide");if(n==="show")e.showState="show",avalon.css(i,t,0),parts=[0,parseFloat(u)];else if(n==="hide")e.showState="hide",e.orig[t]=u,parts=[parseFloat(u),0],n=0;else{parts=c.exec(n);if(parts){parts[2]=parseFloat(parts[2]);if(parts[3]&&parts[3]!==f){var l=i.cloneNode(!0);l.style.visibility="hidden",l.style.position="absolute",i.parentNode.appendChild(l),avalon.css(l,t,parts[2]+(parts[3]?parts[3]:0)),parts[2]=parseFloat(avalon.css(l,t)),i.parentNode.removeChild(l)}a=parts[2],u=parseFloat(u),parts[1]&&(a=u+(parts[1]+1)*parts[2]),parts=[u,a]}}}u=parts[0],a=parts[1],u+""!=a+""?(o.start=u,o.end=a,o.unit=f,e.tweens.push(o)):delete e.props[t]}function p(e,t){this.elem=t.elem,this.prop=e,this.easing=avalon.easing[t.easing],/color$/i.test(e)&&(this.update=this.updateColor)}function v(e,t){var n={};return d.concat.apply([],d.slice(0,t)).forEach(function(t){n[t]=e,~t.indexOf("margin")&&(p.propHooks[t]={get:p.propHooks._default.get,set:function(e){e.elem.style[e.name]=Math.max(e.now,0)+e.unit}})}),n}function b(e){var t=e.toLowerCase(),n=[];if(g[t])return g[t];if(t.indexOf("rgb")===0){var r=t.match(/(\d+%?)/g),i=r[0].indexOf("%")!==-1?2.55:1;return g[t]=[parseInt(r[0])*i,parseInt(r[1])*i,parseInt(r[2])*i]}return t.charAt(0)==="#"?(t.length===4&&(t=t.replace(/([^#])/g,"$1$1")),t.replace(/\w{2}/g,function(e){n.push(parseInt(e,16))}),g[t]=n):window.VBArray?g[t]=y(t):g.white}var e=avalon.fn.animate=function(e,n){var r=new f(this[0]);if(typeof e=="number")r.duration=e;else if(typeof e=="object"){for(var i in e){var s=avalon.cssName(i)||i;i!==s&&(e[s]=e[i],delete e[i])}r.props=e}return t.apply(r,arguments),o(r),this};avalon.mix(e,{fps:30});var r={linear:[.25,.25,.75,.75],ease:[.25,.1,.25,1],easeIn:[.42,0,1,1],easeOut:[0,0,.58,1],easeInOut:[.42,0,.58,1],easeInQuad:[.55,.085,.68,.53],easeInCubic:[.55,.055,.675,.19],easeInQuart:[.895,.03,.685,.22],easeInQuint:[.755,.05,.855,.06],easeInSine:[.47,0,.745,.715],easeInExpo:[.95,.05,.795,.035],easeInCirc:[.6,.04,.98,.335],easeInBack:[.6,-0.28,.735,.045],easeOutQuad:[.25,.46,.45,.94],easeOutCubic:[.215,.61,.355,1],easeOutQuart:[.165,.84,.44,1],easeOutQuint:[.23,1,.32,1],easeOutSine:[.39,.575,.565,1],easeOutExpo:[.19,1,.22,1],easeOutCirc:[.075,.82,.165,1],easeOutBack:[.175,.885,.32,1.275],easeInOutQuad:[.455,.03,.515,.955],easeInOutCubic:[.645,.045,.355,1],easeInOutQuart:[.77,0,.175,1],easeInOutQuint:[.86,0,.07,1],easeInOutSine:[.445,.05,.55,.95],easeInOutExpo:[1,0,0,1],easeInOutCirc:[.785,.135,.15,.86],easeInOutBack:[.68,-0.55,.265,1.55],custom:[0,.35,.5,1.3],random:[Math.random().toFixed(3),Math.random().toFixed(3),Math.random().toFixed(3),Math.random().toFixed(3)]};avalon.easing={linear:function(e){return e},swing:function(e){return-Math.cos(e*Math.PI)/2+.5}},avalon.each(r,function(e,t){avalon.easing[e]=i([t[0],t[1]],[t[2],t[3]])});var s=avalon.timeline=[];o.id=null;var l=document.documentElement;avalon.isHidden=function(e){return e.sourceIndex===0||avalon.css(e,"display")==="none"||!avalon.contains(l,e)},f.prototype={constructor:f,bind:function(e,t,n){var r=this.$events[e]||(this.$events[e]=[]),i=n?"unshift":"push";r[i](t)},fire:function(e){var t=Array.prototype.slice.call(arguments,1),n=this.$events[e]||[];for(var r=0,i;i=n[r++];)i.call(this.elem,t)},build:function(){var e=this,t=e.elem,n=e.props,r=t.style,i=!window.getComputedStyle;if(t.nodeType===1&&("height"in n||"width"in n)){e.overflow=[r.overflow,r.overflowX,r.overflowY];var s=r.display||avalon.css(t,"display"),o=t.getAttribute("olddisplay");o?s!=="none"?t.setAttribute("olddisplay",s):s=o:(s==="none"&&(r.display="",s=avalon.css(t,"display"),s==="none"&&(s=avalon.parseDisplay(t.nodeName))),t.setAttribute("olddisplay",s)),r.display=s,s==="inline"&&avalon.css(t,"float")==="none"&&(!i||avalon.parseDisplay(t.nodeName)==="inline"?r.display="inline-block":r.zoom=1)}e.overflow&&(r.overflow="hidden",e.bind("after",function(){r.overflow=e.overflow[0],r.overflowX=e.overflow[1],r.overflowY=e.overflow[2],e.overflow=null})),e.bind("after",function(){if(e.showState==="hide"){this.style.display="none",this.dataShow={};for(var t in e.orig)this.dataShow[t]=e.orig[t],avalon.css(this,t,e.orig[t])}}),this.build=avalon.noop},createTweens:function(){var e=avalon.isHidden(this.elem);for(var t in this.props)h(this,t,this.props[t],e)},revertTweens:function(){for(var e=0,t;t=this.tweens[e++];){var n=t.start,r=t.end;t.start=r,t.end=n,this.props[t.name]=Array.isArray(t.start)?"rgb("+t.start+")":t.unit?t.start+t.unit:t.start}this.revert=!this.revert}};var c=new RegExp("^(?:([+-])=|)("+/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source+")([a-z%]*)$","i");p.prototype={constructor:p,cur:function(){var e=p.propHooks[this.prop];return e&&e.get?e.get(this):p.propHooks._default.get(this)},run:function(e,t){this.update(e,t);var n=p.propHooks[this.prop];n&&n.set?n.set(this):p.propHooks._default.set(this)},updateColor:function(e,t){if(t)var n=this.end;else{var r=this.easing(e);n=this.start.map(function(e,t){return Math.max(Math.min(parseInt(e+(this.end[t]-e)*r,10),255),0)},this)}this.now="rgb("+n+")"},update:function(e,t){this.now=t?this.end:this.start+this.easing(e)*(this.end-this.start)}},p.propHooks={_default:{get:function(e){var t=avalon.css(e.elem,e.prop);return!t||t==="auto"?0:t},set:function(e){avalon.css(e.elem,e.prop,e.now+e.unit)}}},avalon.each(["scrollTop","scollLeft"],function(e){p.propHooks[e]={get:function(e){return e.elem[e.name]},set:function(e){e.elem[e.name]=e.now}}}),avalon.fn.mix({delay:function(e){return this.animate(e)},pause:function(){var e=this[0];for(var t=0,n;n=s[t];t++)n.elme===e&&(n.paused=new Date-0);return this},resume:function(){var e=new Date,t=this[0];for(var n=0,r;r=s[n];n++)r.elem===t&&(r.startTime+=e-r.paused,delete r.paused);return this},stop:function(e,t){e=e?"1":"",t=t?"1":"0";var n=parseInt(e+t,2),r=this[0];for(var i=0,o;o=s[i];i++)if(o.elem===r){o.gotoEnd=!0;switch(n){case 0:o.update=o.revert=!1;break;case 1:o.revert=!1;break;case 2:delete o.elem;break;case 3:o.troops.forEach(function(e){e.gotoEnd=!0})}}return this}});var d=[["height","marginTop","marginBottom","borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],["width","marginLeft","marginRight","borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],["opacity"]],m={slideDown:v("show",1),slideUp:v("hide",1),slideToggle:v("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}};avalon.each(m,function(e,t){avalon.fn[e]=function(){var e=[].concat.apply([t],arguments);return this.animate.apply(this,e)}}),String("toggle,show,hide").replace(avalon.rword,function(e){avalon.fn[e]=function(){var t=[].concat.apply([v(e,3)],arguments);return this.animate.apply(this,t)}});var g={black:[0,0,0],gray:[128,128,128],white:[255,255,255],orange:[255,165,0],red:[255,0,0],green:[0,128,0],yellow:[255,255,0],blue:[0,0,255]};if(window.VBArray)var y=new function(){var e;try{var t=new ActiveXObject("htmlfile");t.write("<body>"),t.close(),e=t.body}catch(n){e=createPopup().document.body}var r=e.createTextRange();return function(t){e.style.color=String(t).trim();var n=r.queryCommandValue("ForeColor");return[n&255,(n&65280)>>8,(n&16711680)>>16]}};return avalon.parseColor=b,avalon});