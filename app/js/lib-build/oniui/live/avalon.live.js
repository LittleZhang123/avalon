define(["avalon"],function(e){function i(e){var t=e.type;if(t==="select-multiple"){if(e.selectedIndex>-1){var n=[];for(var r=0,i;i=e.options[r++];)n.push(i.selected);return n.join("-")}return""}return e.nodeName.toLowerCase()==="select"?e.selectedIndex:e.value}function s(e){var t=u.fixChangechange,r=e.target;for(var s=t.length,a;a=t[--s];){var f=a.elem;if(n.contains(f)){if(f===r){var l=i(f);a.__change__!==l&&(e.type="change",a.fn.call(f,e),a.__change__=l)}}else o(t,a,s)}}function o(e,t,n){var r=t.elem.parentNode;(!r||r.nodeType==11)&&e.splice(n,1)}var t=document,n=t.documentElement,r={change:"click",focus:"focusin",blur:"focusout"},u=e.bindingHandlers.live=function(a,f){var l=a.param,c=a.element;a.type="on";var h="noFix";if(!t.createEvent)if(/focus|blur/.test(l))h="fixFocus";else if(l=="change"){var p=c.type;p=="radio"||p==="checkbox"?(h="fixFocus","_just_changed"in c||(c._just_changed=!1,c.attachEvent("onpropertychange",function(e){e.propertyName=="checked"&&(c._just_changed=!0)}))):h="fixChange"}else/submit|reset|select/.test(l)&&(h=!1);h&&(u[h+l]||(u[h+l]=[],h==="noFix"&&e.bind(t,l,function(e){var t=u[h+l],r=e.target;for(var i=t.length,s;s=t[--i];)n.contains(s.elem)?(s.elem===r||s.elem.contains(r))&&s.fn.call(s.elem,e):o(t,s,i)},!0),h==="fixFocus"&&e.bind(t,r[l],function(e){var t=u[h+l],r=e.target;for(var i=t.length,s;s=t[--i];){var a=s.elem;if(n.contains(a)){if(a===r||a.contains(r))l==="change"?a._just_changed===!0&&(e.type="change",s.fn.call(a,e),a._just_changed=!1):(e.type=l,s.fn.call(a,e))}else o(t,s,i)}}),h==="fixChange"&&(e.bind(t,"beforeactivate",s),e.bind(t,"beforedeactivate",s))),a.specialBind=function(t,n){var r={elem:t,fn:n};/focus|blur/.test(l)&&(t.tabIndex=t.tabIndex||-1),h==="fixChange"&&(r.__change__=i(t));var s=u[h+l];s.unshift(r),a.specialUnbind=function(){e.Array.remove(s,r),delete a.specialBind,delete a.specialUnbind}}),e.bindingHandlers.on(a,f)}});