define(["./iscroll.js"],function(e){function i(i,s){function m(e,t){var n="translate3d("+e*a.column.width+"px, "+t*a.row.height+"px, 0)";return{transform:n,"-webkit-transform":n}}function g(e,t,n,i){var s=0,f=a.column.num-1,c=0,h=a.row.num-1;e<0&&e>o.maxScrollX&&(s=parseInt(Math.abs(e)/a.column.width),f=s+a.column.num-1),t<0&&t>o.maxScrollY&&(c=parseInt(Math.abs(t)/a.row.height),h=c+a.row.num-1),u.column=s,u.row=c,l.forEach(function(e){var t=!1,o=e.column,u=e.row;n>0&&o<s&&o+a.column.num<a.column.total?(t=!0,o+=a.column.num):n<0&&o>f&&o-a.column.num>-1&&(t=!0,o-=a.column.num),i>0&&u<c&&u+a.row.num<a.row.total?(t=!0,u+=a.row.num):i<0&&u>h&&u-a.row.num>-1&&(t=!0,u-=a.row.num),t&&(a.dataFilter("remove",e.node,e.column,e.row),a.builderNodes&&r.css(e.node,m(o,u)),e.column=o,e.row=u,a.dataFilter("add",e.node,o,u))})}function y(e){var t=Math.abs(e),n=parseInt(t/a.column.width),r=-(t%a.column.width>a.column.width/2?n+1:n)*a.column.width;return{move:r!==e,x:r}}function b(e){var t=Math.abs(e),n=parseInt(t/a.row.height),r=-(t%a.row.height>a.row.height/2?n+1:n)*a.row.height;return{move:r!==e,y:r}}function w(){var e=y(o.x),t=b(o.y);if(e.move||t.move)c&&c.scrollTo(e.x,0,300,IScroll.utils.ease.circular),h&&h.scrollTo(0,t.y,300,IScroll.utils.ease.circular),o.scrollTo(e.x,t.y,300,IScroll.utils.ease.circular)}function E(e,t){return e>=u.column&&e<u.column+a.column.num-1&&t>=u.row&&t<u.row+a.row.num-1}function S(){for(p=0;p<a.column.num;p++)for(d=0;d<a.row.num;d++)a.builderNodes&&(v=r.builder(a.template).children[0],r.css(v,m(p,d)),f.appendChild(v)),l.push({column:p,row:d,node:v}),a.dataFilter("add",v||null,p,d)}var o=null,u={column:0,row:0},a=r.extend({},n,s),f=i&&i.children[0],l=[],c=a.bindScrolls.x,h=a.bindScrolls.y,p,d,v;a.scrollOpt=r.extend({},t,a.scrollOpt);if(!f)throw"Dom Structure Error!";if(!r.isFunction(a.dataFilter))throw'There must be a "dataFilter" Function!';if(a.scrollOpt.scrollX){if(!a.column)throw'Must configure "column", when you can scroll "x"!';a.column.num=a.column.num||parseInt(r.size(i).width/a.column.width)+2,r.css(f,"width",a.column.total*a.column.width+"px")}else a.column={num:1,total:1,width:1};if(a.scrollOpt.scrollY){if(!a.row)throw'Must configure "row", when you can scroll "y"!';a.row.num=a.row.num||parseInt(r.size(i).height/a.row.height)+2,r.css(f,"height",a.row.total*a.row.height+"px")}else a.row={num:1,total:1,height:1};return o=new e(i,a.scrollOpt),o.on("scroll",function(){g(o.x,o.y,o.directionX,o.directionY)}),o.on("scrollEnd",function(){c&&o.x<=0&&o.x>=o.maxScrollX&&c.scrollTo(o.x,0),h&&o.y<=0&&o.y>=o.maxScrollY&&h.scrollTo(0,o.y)}),c&&(o.on("scroll",function(){o.x<=0&&o.x>=o.maxScrollX&&c.scrollTo(o.x,0)}),c.on("scroll",function(){c.x<=0&&c.x>=c.maxScrollX&&c.x>=o.maxScrollX&&(o.scrollTo(c.x,o.y),g(c.x,o.y,c.directionX,0))})),h&&(o.on("scroll",function(){o.y<=0&&o.y>=o.maxScrollY&&h.scrollTo(0,o.y)}),h.on("scroll",function(){h.y<=0&&h.y>=h.maxScrollY&&h.y>=o.maxScrollY&&(o.scrollTo(o.x,h.y),g(o.x,h.y,0,h.directionY))})),r.delay(S),{scroll:o,scrollTo:function(){o.scrollTo.apply(o,r.makeArray(arguments))},fixPosition:function(){r.delay(w)},appendNode:function(e,t,n){r.css(e,m(t,n)),r.contains(f,e)||f.appendChild(e)},checkShow:function(e){return e.some(function(e){return E(e[0],e[1])})},resetTotal:function(e,t,n,i){a.column.total=e,a.row.total=t,a.scrollOpt.scrollX&&r.css(f,"width",a.column.total*a.column.width+"px"),a.scrollOpt.scrollY&&r.css(f,"height",a.row.total*a.row.height+"px"),o.refresh(),g(o.x,o.y,n||0,i||0)},refresh:function(){o&&o.refresh()}}}var t={scrollX:!1,scrollY:!0,freeScroll:!1,mouseWheel:!1,probeType:3},n={builderNodes:!0,template:'<div class="item"></div>',bindScrolls:{},scrollOpt:{}},r={extend:avalon.mix,delay:function(e,t){setTimeout(e,t||0)},makeArray:function(e){return[].slice(e)},size:function(e){var t=avalon(e);return{width:t.css("width"),height:t.css("height")}},builder:function(e){return r.makeArray(avalon.parseHTML(e))},css:function(e,t,n){var r=t,i=avalon(e);arguments.length>2&&(r={},r[t]=n);for(var s in r)i.css(s,r[s])},isFunction:avalon.isFunction,contains:avalon.contains};return i.iScroll=e,i});