define(["avalon","text!./avalon.flipswitch.html","../draggable/avalon.draggable","css!./avalon.flipswitch.css","css!../chameleon/oniui-common.css"],function(e,t){function i(e){return e.replace(/MS_OPTION_[^\}]+/g,function(e){return e.split("MS_OPTION_")[1].toLowerCase().replace(/_[^_]/g,function(e){return e.split("_")[1].toUpperCase()})})}function s(e,t){var e=e.nextSibling,n=e.parentNode;e?n.insertBefore(t,e):n.appendChild(t)}var n=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,r=typeof e.cssName("border-radius")=="string",o=typeof e.cssName("transition")=="string",u=e.ui.flipswitch=function(u,a,f){var l=a.flipswitchOptions;l.template=l.getTemplate(t,l);var c,h=e.define(a.flipswitchId,function(t){e.mix(t,l),t.widgetElement=u,t.$css3support=o&&t.animated,t.$skipArray=["widgetElement","template"],t.$svgSupport=n,t.size=="large"?(t.draggerRadius=19,t.height=38,t.width=76):t.size=="mini"?(t.draggerRadius=7,t.height=12,t.width=28):t.size=="small"&&(t.draggerRadius=9,t.height=18,t.width=36);var a,p,d,v,m={},g={draxis:"x",drStop:function(e,n){if(e.x==m.x)h._toggle();else{var r=m.x-e.x,i=h._getDir();Math.abs(r)>=v.offsetWidth*2/5&&(r>0&&!i||r<0&&i)&&(h.checked=!h.checked);var s=h._getDir()?-50:0;o?d.style[h.dir]=s?s+"%":0:t._animate(-s)}},drStart:function(e,t){m=e},drDrag:function(e){},drHandle:function(e,t){if(h.disabled)return;if((e.target||e.srcElement)!=v&&(e.target||e.srcElement).parentNode!=v&&(e.target||e.srcElement).parentNode.parentNode!=v){h._toggle();return}return v},drBeforeStart:function(t,n){var r=d.parentNode.clientWidth,i=d.parentNode.offsetWidth,s=(i-r)/2,o=e(d.parentNode).position();h.drContainment=n.containment=[-r*.5+s+o.left,0,o.left+s,0]},drBeforeStop:function(e,t){},drContainment:[0,0,0,0]};e.mix(t,g);var y;return t.$init=function(t){if(y)return;y=!0;var n=e.parseHTML(i(h.template));a=n.childNodes[0],s(u,a),n=null,p=u,p.msRetain=!0,p.parentNode.removeChild(p),p.style.display="none",p.checked&&(h.checked=!0),p.setAttribute("ms-checked","checked"),a.appendChild(p),p.msRetain=!1,t?t():(e.log("avalon请尽快升到1.3.7+"),typeof l.onInit=="function"&&l.onInit.call(u,h,l,f)),e.scan(a,[h].concat(f)),d=a.firstChild;while(d){if(d.className&&d.className.indexOf("oni-flipswitch-bar")!=-1)break;d=d.nextSibling}d.style[h.dir]=h._addthisCss();if(h.draggable){v=d.firstChild;while(v){if(v.className&&v.className.indexOf("oni-flipswitch-dragger")!=-1)break;v=v.nextSibling}if(v){d.setAttribute("ms-draggable","");var r=e(d);e.each(g,function(e,t){var n=e.replace(/^dr/,"").replace(/[A-Z]/,function(e){return"-"+e.toLowerCase()});r.data("draggable"+n,typeof t!="function"?t:e)})}e.scan(d,[h].concat(f))}},t.$remove=function(){a.parentNode.insertBefore(p,a),a.parentNode.removeChild(a),p.style.display="inline",u.innerHTML&&(u.innerHTML=u.textContent="")},t._addThisClass=function(){return!h.checked&&h.hdir||h.checked&&!h.hdir?!0:!1},t._addthisCss=function(){return h.checked&&!h.hdir||!h.checked&&h.hdir?"-50%":"0"},t.toggleStatus=function(){if(h.disabled||h.draggable)return;h._toggle()},t._toggle=function(){h.checked=!h.checked,h._animate()},t._getDir=function(){return h.checked&&!h.hdir||!h.checked&&h.hdir},t._animate=function(e,t){var n=h._getDir(),r=d.style[h.dir];if(!o&&h.animated){clearTimeout(c),/px/.test(r)?r=-parseInt((parseInt(r)>>0)/d.parentNode.clientWidth*100):r=-parseInt(r)>>0;var i;n?i=h._animateArrMaker(r,e==void 0?50:e):i=h._animateArrMaker(r,e==void 0?0:e),d.style[h.dir]=-i[0]+"%",i.splice(0,1),c=setInterval(function(){if(!i.length){t&&t();return}d.style[h.dir]=-i[0]+"%",i.splice(0,1)},100)}else h.animated&&(d.style[h.dir]=n?"-50%":"0")},t.disable=function(){h.disabled=!0},t.enable=function(){h.disabled=!1},t._getFillColor=function(){return h.disabled?h.disabledColor:h.checked?h.onColor:h.offColor},t._shallDrawSvg=function(){return h.$svgSupport&&!r},t._shallDrawVML=function(){return!h.$svgSupport&&!r},t});return h.$watch("checked",function(e,t){h.onChange&&h.onChange(e,h)}),h};u.defaults={toggle:!0,onText:'<b class="oni-flipswitch-on"></b>',offText:"",size:"normal",theme:"normal",draggable:!1,disabled:!1,checked:!1,animated:!0,hdir:!0,dir:"left",getStyleFromSkin:!0,draggerColor:"#ffffff",onColor:"#45A846",offColor:"#D5D5D5",disabledColor:"#DEDEDE",draggerRadius:7,height:24,width:48,css3support:!1,onInit:e.noop,_animateArrMaker:function(e,t){var n=[],r=t-e;while(e!=t)e+=parseInt(r/1.5),r=parseInt(r-r/1.5),Math.abs(r)<=1&&(e=t),n.push(e);return n.length||(n=[t]),n},onChange:e.noop,getTemplate:function(e,t){return e},_author:"skipper@123"}});