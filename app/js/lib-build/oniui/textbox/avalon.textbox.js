define(["./avalon.suggest","text!./avalon.textbox.html","css!../chameleon/oniui-common.css","css!./avalon.textbox.css"],function(e,t){var n=t.split("MS_OPTION_SUGGEST"),r=n[1],i="placeholder"in document.createElement("input"),s=e.ui.textbox=function(n,s,o){var u=n.parentNode,a=e(n),f=s.textboxOptions,l="",c="",h="",p="",d=f.placeholder;t=t.replace(/MS_OPTION_DISABLEDCLASS/gm,f.disabledClass),t=f.getTemplate(t),c=e.parseHTML(t).firstChild,h=c.getElementsByTagName("div")[0],p=c.getElementsByTagName("span")[0];if(f.suggest){var v={inputElement:n,strategy:f.suggest,textboxContainer:c,focus:f.suggestFocus||!1,onChange:f.suggestOnChange||"",type:"textbox",limit:f.limit||8};$suggestopts=e.mix(v,f.suggestion),f.$suggestopts=$suggestopts}d=e(n).attr("placeholder")||d||"";var m=e.define(s.textboxId,function(t){e.mix(t,f),t.$skipArray=["widgetElement","disabledClass","autoTrim","suggest"],t.widgetElement=n,t.elementDisabled="",t.toggle=!0,t.placehold=d,t.focusClass=!1,t.placeholderOrigin=i,t.placeWidth=0,t.hidePlaceholder=function(){t.toggle=!1,n.focus()},t.blur=function(){m.focusClass=!1,m.elementDisabled=n.disabled,f.autoTrim&&(n.value=n.value.trim()),m.placeholderOrigin||(n.value!=""||!m.placehold.length?m.toggle=!1:m.toggle=!0)},t.$remove=function(){var e=c.parentNode;e.removeChild(c),c.innerHTML=c.textContent=""},t.$init=function(i){e.bind(n,"blur",t.blur),f.autoFocus&&e.bind(n,"mouseover",function(){n.focus()}),a.addClass("oni-textbox-input");var s=document.createElement("div");u.insertBefore(s,n),n.msRetain=!0,h.appendChild(n),~f.width&&a.width(f.width),~f.height&&a.height(f.height),~f.tabIndex&&(n.tabIndex=f.tabIndex),u.replaceChild(c,s),n.msRetain=!1;if(f.suggest){var l=e.parseHTML(r).firstChild;c.appendChild(l)}e.bind(n,"focus",function(){m.focusClass=!0,m.placeholderOrigin||(m.toggle=!1)}),e.scan(c,[m].concat(o));if(!m.placeholderOrigin){if(!m.placehold.length||n.value!="")m.toggle=!1;m.placeWidth=e(h).innerWidth()}else m.placehold.length&&a.attr("placeholder",m.placehold);i?i():(e.log("avalon请尽快升到1.3.7+"),e.scan(n,[m].concat(o)),typeof f.onInit=="function"&&f.onInit.call(n,m,f,o)),t.elementDisabled=n.disabled}}),g,y;for(var b in n.msData)if(b.indexOf("ms-duplex")===0){g=n.msData[b];break}return g&&(l=e.getModel(g,o),l&&l[1].$watch(l[0],function(){m.elementDisabled=n.disabled,m.placeholderOrigin||(n.value!=""||!m.placehold.length?m.toggle=!1:m.toggle=!0)})),y=n.msData["ms-disabled"]||n.msData["ms-enabled"],y&&(l=e.getModel(y,o),l&&l[1].$watch(l[0],function(){m.elementDisabled=n.disabled,m.placeholderOrigin||(n.value!=""||!m.placehold.length?m.toggle=!1:m.toggle=!0)})),m};return s.defaults={suggest:!1,suggestion:{},autoTrim:!0,widgetElement:"",tabIndex:-1,width:-1,autoFocus:!1,disabledClass:"oni-textbox-disabled",getTemplate:function(e){return e.replace(/MS_OPTION_ICON/,"")},stateClass:"",suggestOnChange:"",suggestFocus:!1},e});