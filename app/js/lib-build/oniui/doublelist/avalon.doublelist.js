define(["avalon","text!./avalon.doublelist.html","text!./avalon.doublelist.data.html","../scrollbar/avalon.scrollbar","css!./avalon.doublelist.css","css!../chameleon/oniui-common.css"],function(e,t,n){var r=e.ui.doublelist=function(r,i,s){var o=i.doublelistOptions;o.template=o.getTemplate(t,o);var u=e.define(i.doublelistId,function(i){i.data=[],i.select=[],i._selectData=[],i.dataTmpSelect=[],i.selectTmpSelect=[],i.$changeCBS=[],e.mix(i,o),i.change!=e.noop&&i.onChange==e.noop&&(i.onChange=i.change),i.widgetElement=r,i.$skipArray=["widgetElement","template"];var a,f=+(new Date);i.$uid=f,i.$init=function(t){if(a)return;a=!0;var n=u._getTemplate("data"),i=u._getTemplate("select");u.template=u.template.replace(/\{\{MS_OPTION_SELECT\}\}/g,i).replace(/\{\{MS_OPTION_DATA\}\}/g,n).replace(/\{\{MS_OPTION_ID\}\}/g,f),r.innerHTML=u.template,u._getSelect(),t?t():(e.log("请尽快升到avalon1.3.7+"),e.scan(r,[u].concat(s)),typeof o.onInit=="function"&&o.onInit.call(r,u,o,s))},i.$remove=function(){r.innerHTML=r.textContent=""},i._getTemplate=function(e){var r=t;return e==="data"?r=n.replace(/\{\{MS_OPTION_TYPE\}\}/g,"data"):e==="select"&&(r=n.replace(/\{\{MS_OPTION_TYPE\}\}/g,"select")),u.getTemplate(r,o,e)},i._itemSelected=function(e,t){for(var n=0,r=u.select;n<r;n++)if(u.select[n]==e.value)return t=="data";return!1},i._itemShow=function(e,t){return u.hideSelect&&u._itemSelected(e,t)},i._getSelect=function(){u._selectData=[],e.each(u.select,function(t,n){e.each(u.data,function(e,t){n==t.value&&u._selectData.push(t)});var r=e(document.getElementById("data"+n+u.$uid));r.removeClass("oni-state-active").addClass("oni-state-disabled"),u.hideSelect&&r.addClass("oni-helper-hidden")})},i.updateScrollbar=function(){e.vmodels["$left"+u.$uid]&&e.vmodels["$left"+u.$uid].update(),e.vmodels["$right"+u.$uid]&&e.vmodels["$right"+u.$uid].update()},i._removeFrom=function(e,t){var n=t?u.selectTmpSelect:u.dataTmpSelect;for(var r=0,i=n.length;r<i;r++)if(e==n[r]){n.splice(r,1);break}},i._select=function(t,n,r,i){var s=e(this),o=s.data();t.preventDefault();if(s.hasClass("oni-state-disabled"))return;if(r=="select"){if(s.hasClass("oni-state-active"))s.removeClass("oni-state-active"),u._removeFrom(o.value,"fromSelected");else if(!s.hasClass("oni-state-disabled")){for(var a=0,f=u.selectTmpSelect.length;a<f;a++)if(u.selectTmpSelect[a]==o.value)return;s.addClass("oni-state-active"),u.selectTmpSelect.push(o.value)}if(i){if(!u.countLimit(u.select,"delete",1))return;for(var a=0,f=u.select.length;a<f;a++)if(u.select[a]==o.value){u.select.removeAt(a),u._removeFrom(o.value,"fromSelected"),u.selectTmpSelect.clear(),u._getSelect();return}}}else{if(s.hasClass("oni-state-active"))s.removeClass("oni-state-active"),u._removeFrom(o.value);else if(!s.hasClass("oni-state-disabled")){for(var a=0,f=u.dataTmpSelect.length;a<f;a++)if(u.dataTmpSelect[a]==o.value)return;s.addClass("oni-state-active"),u.dataTmpSelect.push(o.value)}if(i){if(!u.countLimit(u.select,"add",1))return;for(var a=0,f=u.select.length;a<f;a++)if(u.select[a]==o.value)return;u.select.push(o.value),u._removeFrom(o.value),u.selectTmpSelect.clear(),u._getSelect()}}},i._update=function(e,t){var n=t==="delete"?u.selectTmpSelect:u.dataTmpSelect;if(n.length==0)return;if(!u.countLimit(u.select,t,n.length))return;if(t==="delete"){for(var r=0,i=n.length;r<i;r++)for(var s=0,o=u.select.length;s<o;s++)if(u.select[s]==n[r]){u.select.splice(s,1);break}}else for(var r=0,i=n.length;r<i;r++)u.select.push(n[r]);u.selectTmpSelect.clear(),u.dataTmpSelect.clear(),u._getSelect()},i._activeClass=function(e,t){var n=t==="data"?u.dataTemplate:u.selectTmpSelect;for(var r=0,i=n.length;r<i;r++)if(e.value==n[r])return!0},i.reset=function(e,t){e&&(e.length==u.data.length&&e!=u.data&&(u.data.clear(),u.data=e),u.data=e),t&&(t.length==u.select.length&&t!=u.select&&i.select.clear(),i.select=t),u.selectTmpSelect.clear(),u.dataTmpSelect.clear(),u._getSelect()}});return u.select.$watch("length",function(t,n){u.onChange&&u.onChange(t,n,u),e.each(u.$changeCBS,function(e,r){r(t,n,u)})}),u};r.defaults={toggle:!0,hideSelect:!1,onInit:e.noop,getTemplate:function(e,t,n){return e},countLimit:function(e){return!0},change:e.noop,onChange:e.noop,$author:"skipper@123"}});