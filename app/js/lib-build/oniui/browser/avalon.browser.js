define(["avalon"],function(e){function i(e,t){return e=(""+e).replace(/_/g,"."),t=t||1,e=String(e).split("."),e=e[0]+"."+(e[1]||"0"),e=Number(e).toFixed(t),e}function s(t,n,r){t=e[t],t.name=n,t.version=r,t[n]=r}var t=(navigator.platform||"").toLowerCase(),n=navigator.userAgent.toLowerCase(),r,o=e.platform={name:window.orientation!=undefined?"iPod":(t.match(/mac|win|linux/i)||["unknown"])[0],version:0,iPod:0,iPad:0,iPhone:0,android:0,win:0,linux:0,mac:0};(r=n.match(/windows ([\d.]+)/))?s("platform","win",i(r[1])):(r=n.match(/windows nt ([\d.]+)/))?s("platform","win",i(r[1])):(r=n.match(/linux ([\d.]+)/))?s("platform","linux",i(r[1])):(r=n.match(/mac ([\d.]+)/))?s("platform","mac",i(r[1])):(r=n.match(/ipod ([\d.]+)/))?s("platform","iPod",i(r[1])):(r=n.match(/ipad[\D]*os ([\d_]+)/))?s("platform","iPad",i(r[1])):(r=n.match(/iphone ([\d.]+)/))?s("platform","iPhone",i(r[1])):(r=n.match(/android ([\d.]+)/))?s("platform","android",i(r[1])):0;var u=e.browser={name:"unknown",version:0,ie:0,firefox:0,chrome:0,opera:0,safari:0,mobileSafari:0,adobeAir:0};return(r=n.match(/trident.*; rv\:([\d.]+)/))?s("browser","ie",i(r[1])):(r=n.match(/msie ([\d.]+)/))?s("browser","ie",i(r[1])):(r=n.match(/firefox\/([\d.]+)/))?s("browser","firefox",i(r[1])):(r=n.match(/chrome\/([\d.]+)/))?s("browser","chrome",i(r[1])):(r=n.match(/opera.([\d.]+)/))?s("browser","opera",i(r[1])):(r=n.match(/adobeair\/([\d.]+)/))?s("browser","adobeAir",i(r[1])):(r=n.match(/version\/([\d.]+).*safari/))?s("browser","safari",i(r[1])):0,(r=n.match(/version\/([\d.]+).*mobile.*safari/))?s("browser","mobileSafari",i(r[1])):0,o.iPad&&s("browser","mobileSafari","0.0"),u.ie&&(document.documentMode?document.documentMode!==Math.floor(u.ie)&&s("browser","ie",i(document.documentMode)):document.documentMode=Math.floor(u.ie)),e.engine={name:"unknown",version:0,trident:0,gecko:0,webkit:0,presto:0},(r=n.match(/trident\/([\d.]+)/))?s("engine","trident",i(r[1])):(r=n.match(/gecko\/([\d.]+)/))?s("engine","gecko",i(r[1])):(r=n.match(/applewebkit\/([\d.]+)/))?s("engine","webkit",i(r[1])):(r=n.match(/presto\/([\d.]+)/))?s("engine","presto",i(r[1])):0,e.browser.ie&&(e.browser.ie==6?s("engine","trident",i("4")):(u.ie==7||u.ie==8)&&s("engine","trident",i("5"))),e});