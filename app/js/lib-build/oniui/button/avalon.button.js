define(["avalon","css!../chameleon/oniui-common.css","css!./avalon.button.css"],function(e){function i(n,r){var i,s=t.concat(),o=!1,u=r.icon||"",a=r.corner;r.label=r.label||"";if(a){s.push("oni-corner-all");if(a=parseInt(a))n.style.borderRadius=a+"px"}r.size&&s.push("oni-button-"+r.size),r.color&&s.push("oni-button-"+r.color),r.disabled&&s.push("oni-state-disabled"),e(n).addClass(s.join(" "));if(r.elementType==="input"&&r.label){e(n).val(r.label);return}switch(r.type){case"text":i="<span class='oni-button-text'>"+r.label+"</span>";break;case"labeledIcon":o=!0;case"icon":switch(r.iconPosition){case"left":i="<i class='oni-icon oni-icon-left'>"+u.replace(/\\/g,"")+"</i>"+"<span class='oni-button-text oni-button-text-right"+(o?"":" oni-button-text-hidden")+"'>"+r.label+"</span>";break;case"right":i="<span class='oni-button-text oni-button-text-left"+(o?"":" oni-button-text-hidden")+"'>"+r.label+"</span>"+"<i class='oni-icon oni-icon-right'>"+u.replace(/\\/g,"")+"</i>";break;case"left-right":var f=u&&u.split("-")||["",""],l=f[0],c=f[1];i="<i class='oni-icon oni-icon-left'>"+l.replace(/\\/g,"")+"&nbsp;</i>"+"<span class='oni-button-text oni-button-text-middle"+(o?"":" oni-button-text-hidden")+"'>"+r.label+"</span>"+"<i class='oni-icon oni-icon-right'>&nbsp;"+c.replace(/\\/g,"")+"</i>"}}n.innerHTML=i}var t=["oni-button","oni-widget","oni-state-default"],n="oni-button-icons-only oni-button-icon-only oni-button-text-icons oni-button-text-icon-primary oni-button-text-icon-secondary oni-button-text-only",r=e.ui.button=function(t,n,r){function a(e){s.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}var s=n.buttonOptions,o,u=e(t);o={$init:function(){var n=s.data,o="",f=s.label,l=0,c=t.tagName.toLowerCase();if(s.groups&&n.length>1){var h="";n.forEach(function(e,t){var n="<span ms-widget='button'";e.type!==void 0&&(n+=" data-button-type='"+e.type+"'"),e.iconPosition!==void 0&&(n+=" data-button-icon-position='"+e.iconPosition+"'"),e.icon!==void 0&&(n+=" data-button-icon='"+e.icon+"'"),e.color!==void 0&&(n+=" data-button-color='"+e.color+"'"),e.size!==void 0&&(n+=" data-button-size='"+e.size+"'"),e.disabled!==void 0&&(n+=" data-button-disabled='"+e.disabled+"'"),e.label!==void 0&&(n+=" data-button-label='"+e.label+"'"),n+=">"+(e.text||"")+"</span>",h+=n}),t.innerHTML=h,t.setAttribute("ms-widget","buttonset"),s.direction=="vertical"&&t.setAttribute("data-buttonset-direction","vertical"),s.corner||t.setAttribute("data-buttonset-corner",s.corner),s.width&&t.setAttribute("data-buttonset-width",parseInt(s.width)),e.scan(t,r);return}typeof s.disabled!="boolean"?s.disabled=!!t.disabled:t.disabled=s.disabled,c==="input"&&(o="input");if(l=parseInt(s.width))t.style.width=l+"px";u.bind("mousedown",function(e){a(e),u.addClass("oni-state-active")}),u.bind("mouseup",function(e){a(e),u.removeClass("oni-state-active")}),u.bind("blur",function(){u.removeClass("oni-state-active"),u.removeClass("oni-state-focus")}),u.bind("focus",function(){u.addClass("oni-state-focus")}),s.label||(f=o==="input"?t.value:t.innerHTML),s.elementType=o,s.label=f,i(t,s),e.scan(t,r)}},o.$init()};return e.ui.buttonset=function(t,n,r){var i=n.buttonsetOptions,s=i.corner,o=i.direction,u=e(t);s=s!==void 0?s:!0;var a={$init:function(){var a=[];a.push("oni-buttonset"),firstButtonClass="oni-corner-left",lastButtonClass="oni-corner-right",children=t.childNodes,buttons=[],buttonWidth=i.width,firstElement=!0;for(var f=0,l;l=children[f++];)l.nodeType===1&&(l.setAttribute("data-button-corner","false"),buttons.push(l),firstElement&&(e(l).addClass("oni-button-first"),firstElement=!1));var c=buttons.length;c&&s&&(o==="vertical"&&(firstButtonClass="oni-corner-top",lastButtonClass="oni-corner-bottom"),e(buttons[0]).addClass(firstButtonClass),e(buttons[c-1]).addClass(lastButtonClass)),o==="vertical"&&a.push("oni-buttonset-vertical"),u.addClass(a.join(" ")),n.buttons=buttons,e.scan(t,r);if(buttonWidth=parseInt(buttonWidth)){(function(t){var n=[].concat(buttons);setTimeout(function(){for(var r=0;button=n[r++];){var i=e(button),s=button.tagName.toLowerCase();s==="input"||s==="button"?button.style.width=t+"px":button.style.width=t-parseInt(i.css("border-left-width"))-parseInt(i.css("border-right-width"))-parseInt(i.css("padding-left"))*2+"px"}},10)})(buttonWidth);return}(function(t){var n=0,r=0;t=t.concat(),n=setInterval(function(){var i=0,s=0,o;for(var u=0,a;a=t[u++];)i=Math.max(i,e(a).outerWidth());if(i===r){r+=1;for(var u=0,a;a=t[u++];){var f=a.tagName.toLowerCase(),o=e(a);f==="input"||f==="button"?a.style.width=r+"px":a.style.width=r-parseInt(o.css("border-left-width"))-parseInt(o.css("border-right-width"))-parseInt(o.css("padding-left"))*2+"px"}clearInterval(n);return}r=i},100)})(buttons)}};a.$init()},r.version=1,r.defaults={groups:!1,direction:"",data:[],type:"text",iconPosition:"left",icon:"",size:"",color:"",corner:!0,style:"",disabled:!1,label:"",width:""},e});