define(["avalon","text!./avalon.pager.html","css!../chameleon/oniui-common.css","css!./avalon.pager.css"],function(e,t){function r(e,t){var n={};for(var r=0,i=e.length;r<i;r++){var s=e[r];n[s]={action:"del",el:s}}for(var r=0,o=t.length;r<o;r++){var s=t[r];n[s]?n[s]={action:"retain",el:s}:n[s]={action:"add",el:s}}var u=[];for(var r in n)u.push({action:n[r].action,el:n[r].el});u.sort(function(e,t){return e.el-t.el}),u.forEach(function(e,t){e.index=t});var a=[];for(var r=0,s;s=u[r++];)switch(s.action){case"add":e.splice(s.index,0,s.el);break;case"del":a.unshift(s)}for(var r=0,s;s=a[r++];)e.splice(s.index,1)}function i(e){var t=e.currentPage,n=Math.ceil(e.totalItems/e.perPages),r=[],i=e.showPages,s=t,o=t;e.totalPages=n;if(n<=i)for(var u=1;u<=n;u++)r.push(u);else{r.push(t);for(;;){if(r.length>=i)break;s>1&&r.unshift(--s);if(r.length>=i)break;o<n&&r.push(++o)}}return e.firstPage=r[0]||1,e.lastPage=r[r.length-1]||1,e.showFirstOmit=e.firstPage>2,e.showLastOmit=e.lastPage<n-1,r}var n=e.ui.pager=function(n,s,o){var u=s.pagerOptions,a=u.options;Array.isArray(a)?u.options=a.map(function(e){var t={};switch(typeof e){case"number":case"string":return t.value=e,t.text=e,t;case"object":return e}}):u.options=[],o.cb&&(t=t.replace(/ms-title/g,"ms-attr-title")),u.template=u.getTemplate(t,u),u._currentPage=u.currentPage;var f=e.define(s.pagerId,function(t){e.mix(t,u),t.widgetElement=n,t.$skipArray=["showPages","widgetElement","template","ellipseText","alwaysShowPrev","alwaysShowNext"],t.$init=function(t){var r=u.template;n.style.display="none",setTimeout(function(){n.innerHTML=r,n.style.display="block",t?t():(e.log("avalon请尽快升到1.3.7+"),e.scan(n,[f].concat(o)),typeof u.onInit=="function"&&u.onInit.call(n,f,u,o))},100)},t.$remove=function(){n.innerHTML=n.textContent=""},t.jumpPage=function(e,s){e.preventDefault();if(s!==t.currentPage){switch(s){case"first":t.currentPage=1;break;case"last":t.currentPage=t.totalPages;break;case"next":t.currentPage++,t.currentPage>t.totalPages&&(t.currentPage=t.totalPages);break;case"prev":t.currentPage--,t.currentPage<1&&(t.currentPage=1);break;default:t.currentPage=s}this.className.indexOf("state-disabled")===-1&&(t.onJump.call(n,e,t),r(t.pages,i(t)))}},t.$watch("totalItems",function(){r(t.pages,i(t))}),t.$watch("perPages",function(e){t.currentPage=1,r(t.pages,i(t))}),t.$watch("currentPage",function(e){f._currentPage=e,r(t.pages,i(t))}),t.isShowPrev=function(){var e=t.alwaysShowPrev,n=t.firstPage;return e||n!==1},t.isShowNext=function(){var e=t.alwaysShowNext,n=t.lastPage,r=t.totalPages;return e||n!==r},t.changeCurrentPage=function(e,r){if(e.type==="keyup"){r=this.value;if(e.keyCode!==13)return}else r=f._currentPage;r=parseInt(r,10)||1;if(r>f.totalPages||r<1)return;f.currentPage=r,f.pages=i(f),f.onJump.call(n,e,t)},t.pages=[],t.getPages=i});return f.pages=i(f),f};return n.defaults={perPages:10,showPages:10,currentPage:1,_currentPage:1,totalItems:200,totalPages:0,pages:[],nextText:">",prevText:"<",ellipseText:"…",firstPage:0,lastPage:0,alwaysShowNext:!1,alwaysShowPrev:!1,showFirstOmit:!1,showLastOmit:!1,showJumper:!1,getTemplate:function(e,t){return e},options:[],onJump:function(e,t){},getTitle:function(e,t,n){switch(e){case"first":if(t==1)return"当前页";return"跳转到第一页";case"prev":return"跳转到上一页";case"next":return"跳转到下一页";case"last":if(t==n)return"当前页";return"跳转到最后一页";default:if(e===t)return"当前页";return"跳转到第"+e+"页"}}},e});