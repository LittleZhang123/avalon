/*==================================================
 Copyright 2013-2014 司徒正美 and other contributors
 http://www.cnblogs.com/rubylouvre/
 https://github.com/RubyLouvre
 http://weibo.com/jslouvre/
 
 Released under the MIT license
 avalon 1.3.6 2014.10.10
 ==================================================*/

(function(DOC){function noop(){}function log(){window.console&&avalon.config.debug&&Function.apply.call(console.log,console,arguments)}function oneObject(e,t){typeof e=="string"&&(e=e.match(rword)||[]);var n={},r=t!==void 0?t:1;for(var i=0,s=e.length;i<s;i++)n[e[i]]=r;return n}function generateID(){return"avalon"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function isWindow(e){return rwindow.test(serialize.call(e))}function _number(e,t){return e=Math.floor(e)||0,e<0?Math.max(t+e,0):Math.min(e,t)}function isArrayLike(e){if(e&&typeof e=="object"&&!avalon.isWindow(e)){var t=e.length;if(+t===t&&!(t%1)&&t>=0)try{return{}.propertyIsEnumerable.call(e,"length")===!1?Array.isArray(e)||/^\s?function/.test(e.item||e.callee):!0}catch(n){return!0}}return!1}function isObservable(e,t,n){if(isFunction(t)||t&&t.nodeType)return!1;if(n.indexOf(e)!==-1)return!1;if($$skipArray.indexOf(e)!==-1)return!1;var r=n.$special;return e&&e.charAt(0)==="$"&&!r[e]?!1:!0}function modelFactory(e,t){if(Array.isArray(e)){var n=e.concat();e.length=0;var r=Collection(e);return r.pushArray(n),r}if(typeof e.nodeType=="number")return e;if(e.$id&&e.$model&&e.$events)return e;Array.isArray(e.$skipArray)||(e.$skipArray=[]),e.$skipArray.$special=t||{};var i={},s={},o={},u={},a=[];for(var f in e)(function(t,n){s[t]=n;if(!isObservable(t,n,e.$skipArray))return;var r,f=avalon.type(n);o[t]=[];if(f==="object"&&isFunction(n.get)&&Object.keys(n).length<=2){var l=n.set,c=n.get;r=function(e){var n=i.$events,r=s[t];if(arguments.length){if(stopRepeatAssign)return;if(isFunction(l)){var o=n[t];n[t]=[],l.call(i,e),n[t]=o}}else avalon.openComputedCollect&&collectSubscribers(n[t]);return e=s[t]=c.call(i),isEqual(r,e)||(withProxyCount&&updateWithProxy(i.$id,t,e),notifySubscribers(n[t]),safeFire(i,t,e,r)),e},a.push(function(){Registry[expose]={evaluator:r,element:head,type:"computed::"+t,handler:noop,args:[]},r(),collectSubscribers(o[t]),delete Registry[expose]})}else if(rcomplexType.test(f)){r=function(e){var n=r.child,u=s[t];if(!arguments.length)return collectSubscribers(o[t]),n;if(stopRepeatAssign)return;if(!isEqual(u,e)){n=r.child=updateChild(i,t,e,f),e=s[t]=n.$model;var a=rebindings[n.$id];a&&a(),safeFire(i,t,e,u)}};var h=r.child=modelFactory(n);h.$events[subscribers]=o[t],s[t]=h.$model}else r=function(e){var n=s[t];if(!arguments.length)return collectSubscribers(o[t]),n;isEqual(n,e)||(s[t]=e,withProxyCount&&updateWithProxy(i.$id,t,e),notifySubscribers(o[t]),safeFire(i,t,e,n))};u[t]=r})(f,e[f]);$$skipArray.forEach(function(t){e[t]=!0,delete s[t]}),i=defineProperties(i,descriptorFactory(u),e);for(var l in e)u[l]||(i[l]=e[l]);i.$id=generateID(),i.$model=s,i.$events=o;for(var f in EventManager){var c=EventManager[f];W3C||(c=c.bind(i)),i[f]=c}return i.hasOwnProperty=function(e){return e in i.$model},a.forEach(function(e){e()}),i}function safeFire(e,t,n,r){e.$events&&EventManager.$fire.call(e,t,n,r)}function updateWithProxy(e,t,n){var r=withProxyPool[e];r&&r[t]&&(r[t].$val=n)}function updateChild(e,t,n,r){var i=e[t];if(r==="array")return Array.isArray(n)?(i.clear(),i.pushArray(n.concat()),i):e;var s=e.$events[t];withProxyPool[i.$id]&&(withProxyCount--,delete withProxyPool[i.$id]);var o=modelFactory(n);return rebindings[o.$id]=function(e){while(e=s.shift())(function(e){e.type&&avalon.nextTick(function(){e.rollback&&e.rollback(),bindingHandlers[e.type](e,e.vmodels)})})(e);delete rebindings[o.$id]},o}function iterator(e,t,n){var r="for(var "+e+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+n;return Function("fn,scope",r)}function fixContains(e,t){try{while(t=t.parentNode)if(t===e)return!0;return!1}catch(n){return!1}}function outerHTML(){return(new XMLSerializer).serializeToString(this)}function kernel(e){for(var t in e){if(!ohasOwn.call(e,t))continue;var n=e[t];typeof kernel.plugins[t]=="function"?kernel.plugins[t](n):typeof kernel[t]=="object"?avalon.mix(kernel[t],n):kernel[t]=n}return this}function escapeRegExp(e){return(e+"").replace(rregexp,"\\$&")}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function ClassList(e){if(!("classList"in e)){e.classList={node:e};for(var t in ClassListMethods)e.classList[t.slice(1)]=ClassListMethods[t]}return e.classList}function parseData(e){try{e=e==="true"?!0:e==="false"?!1:e==="null"?null:+e+""===e?+e:rbrace.test(e)?avalon.parseJSON(e):e}catch(t){}return e}function getWindow(e){return e.window&&e.document?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}function showHidden(e,t){if(e.offsetWidth<=0){if(rdisplayswap.test(cssHooks["@:get"](e,"display"))){var n={node:e};for(var r in cssShow)n[r]=e.style[r],e.style[r]=cssShow[r];t.push(n)}var i=e.parentNode;i&&i.nodeType===1&&showHidden(i,t)}}function getValType(e){var t=e.tagName.toLowerCase();return t==="input"&&/checkbox|radio/.test(e.type)?"checked":t}function isVML(e){var t=e.nodeName;return t.toLowerCase()===t&&e.scopeName&&e.outerText===""}function fixVML(e){e.currentStyle.behavior!=="url(#default#VML)"&&(e.style.behavior="url(#default#VML)",e.style.display="inline-block",e.style.zoom=1)}function registerSubscriber(e){Registry[expose]=e,avalon.openComputedCollect=!0;var t=e.evaluator;if(t)try{var n=ronduplex.test(e.type)?e:t.apply(0,e.args);e.handler(n,e.element,e)}catch(r){log("warning:exception throwed in [registerSubscriber] "+r),delete e.evaluator;var i=e.element;if(i.nodeType===3){var s=i.parentNode;kernel.commentInterpolate?s.replaceChild(DOC.createComment(e.value),i):i.data=openTag+e.value+closeTag}}avalon.openComputedCollect=!1,delete Registry[expose]}function collectSubscribers(e){var t=Registry[expose];e&&t&&avalon.Array.ensure(e,t)&&t.element&&$$subscribers.push({data:t,list:e})}function removeSubscribers(){for(var e=$startIndex,t=$startIndex+$maxIndex;e<t;e++){var n=$$subscribers[e];if(!n)break;var r=n.data,i=r.element,s=i===null?1:i.nodeType===1?typeof i.sourceIndex=="number"?i.sourceIndex===0:!root.contains(i):!avalon.contains(root,i);if(s){$$subscribers.splice(e,1),avalon.Array.remove(n.list,r),r.type==="if"&&r.template&&r.template.parentNode===head&&head.removeChild(r.template);for(var o in r)r[o]=null;n.data=n.list=null,e--,t--}}n=$$subscribers[e],n?$startIndex=t:$startIndex=0}function notifySubscribers(e){var t=new Date;clearTimeout(removeID),t-beginTime>333?(removeSubscribers(),beginTime=new Date):removeID=setTimeout(removeSubscribers,333);if(e&&e.length){var n=aslice.call(arguments,1);for(var r=e.length,i;i=e[--r];){var s=i.element;if(i.$repeat)i.handler.apply(i,n);else if(i.element&&i.type!=="on"){var o=i.evaluator||noop;i.handler(o.apply(0,i.args||[]),s,i)}}}}function checkScan(e,t){var n=NaN,r=setInterval(function(){var i=e.innerHTML;i===n?(clearInterval(r),t()):n=i},interval)}function scanTag(e,t,n){var r=e.getAttribute("ms-skip");if(!e.getAttributeNode)return log("warning "+e.tagName+" no getAttributeNode method");var i=e.getAttributeNode("ms-important"),s=e.getAttributeNode("ms-controller");if(typeof r=="string")return;if(n=i||s){var o=VMODELS[n.value];if(!o)return;t=n===i?[o]:[o].concat(t);var u=n.name;e.removeAttribute(u),e.setAttribute("avalonctrl",n.value),o.$events.expr=e.tagName+'[avalonctrl="'+n.value+'"]',avalon(e).removeClass(u)}scanAttr(e,t)}function scanNodeList(e,t){var n=e.firstChild;while(n){var r=n.nextSibling;scanNode(n,n.nodeType,t),n=r}}function scanNodeArray(e,t){for(var n=0,r;r=e[n++];)scanNode(r,r.nodeType,t)}function scanNode(e,t,n){t===1?scanTag(e,n):t===3&&rexpr.test(e.data)?scanText(e,n):kernel.commentInterpolate&&t===8&&!rexpr.test(e.nodeValue)&&scanText(e,n)}function scanText(e,t){var n=[];if(e.nodeType===8){var r=[],i=trimFilter(e.nodeValue,r),s={expr:!0,value:i};r.length&&(s.filters=r);var o=[s]}else o=scanExpr(e.data);if(o.length){for(var u=0,s;s=o[u++];){var a=DOC.createTextNode(s.value);if(s.expr){var f=s.filters,l={type:"text",element:a,value:s.value,filters:f};f&&f.indexOf("html")!==-1&&(avalon.Array.remove(f,"html"),l.type="html",l.group=1,f.length||delete n.filters),n.push(l)}hyperspace.appendChild(a)}e.parentNode.replaceChild(hyperspace,e),n.length&&executeBindings(n,t)}}function bindingSorter(e,t){return e.priority-t.priority}function scanAttr(e,t){var n=getAttributes?getAttributes(e):avalon.slice(e.attributes),r=[],i={},s;for(var o=0,u;u=n[o++];)if(u.specified)if(s=u.name.match(rmsAttr)){var a=s[1],f=s[2]||"",l=u.value,c=u.name;i[c]=l,events[a]?(f=a,a="on"):a==="enabled"&&(a="disabled",l="!("+l+")");if(a==="checked"||a==="selected"||a==="disabled"||a==="readonly")f=a,a="attr",e.removeAttribute(c),c="ms-attr-"+f,e.setAttribute(c,l),s=[c],i[c]=l;if(typeof bindingHandlers[a]=="function"){var h={type:a,param:f,element:e,name:s[0],value:l,priority:a in priorityMap?priorityMap[a]:a.charCodeAt(0)*10+(Number(f)||0)};a==="if"&&f.indexOf("loop")>-1&&(h.priority+=100),t.length&&(r.push(h),a==="widget"&&(e.msData=e.msData||i))}}r.sort(bindingSorter),i["ms-checked"]&&i["ms-duplex"]&&log("warning!一个元素上不能同时定义ms-checked与ms-duplex");var p=r[0]||{};switch(p.type){case"if":case"repeat":case"widget":executeBindings([p],t);break;default:executeBindings(r,t),!stopScan[e.tagName]&&rbind.test(e.innerHTML.replace(rlt,"<").replace(rgt,">"))&&scanNodeList(e,t)}}function executeBindings(e,t){for(var n=0,r;r=e[n++];)r.vmodels=t,bindingHandlers[r.type](r,t),r.evaluator&&r.element&&r.element.nodeType===1&&r.element.removeAttribute(r.name);e.length=0}function trimFilter(e,t){return e.indexOf("|")>0&&(e=e.replace(r11a,"U2hvcnRDaXJjdWl0"),e=e.replace(rfilters,function(e,n,r){return t.push(n+(r||"")),""}),e=e.replace(r11b,"||")),e}function scanExpr(e){var t=[],n,r=0,i;do{i=e.indexOf(openTag,r);if(i===-1)break;n=e.slice(r,i),n&&t.push({value:n,expr:!1}),r=i+openTag.length,i=e.indexOf(closeTag,r);if(i===-1)break;n=e.slice(r,i);if(n){var s=[];n=trimFilter(n,s),t.push({value:n,expr:!0,filters:s.length?s:void 0})}r=i+closeTag.length}while(1);return n=e.slice(r),n&&t.push({value:n,expr:!1}),t}function addAssign(e,t,n,r){var i=[],s=" = "+n+".";for(var o=e.length,u;u=e[--o];)t.hasOwnProperty(u)&&(i.push(u+s+u),r.type==="duplex"&&(e.get=n+"."+u),e.splice(o,1));return i}function uniqSet(e){var t=[],n={};for(var r=0;r<e.length;r++){var i=e[r],s=i&&typeof i.$id=="string"?i.$id:i;n[s]||(n[s]=t.push(i))}return t}function createCache(e){function n(r,i){return t.push(r)>e&&delete n[t.shift()],n[r]=i}var t=[];return n}function parseExpr(e,t,n){var r=n.type,i=n.filters?n.filters.join(""):"",s=t.map(function(e){return e.$id.replace(rproxy,"$1")})+e+r+i,o=getVariables(e).concat(),u=[],a=[],f=[],l="";t=uniqSet(t);for(var c=0,h=t.length;c<h;c++)if(o.length){var p="vm"+expose+"_"+c;a.push(p),f.push(t[c]),u.push.apply(u,addAssign(o,t[c],p,n))}if(!u.length&&r==="duplex")return;i&&f.push(avalon.filters),n.args=f;var d=cacheExprs[s];if(d){n.evaluator=d;return}var l=u.join(", ");l&&(l="var "+l);if(i){e="\nvar ret"+expose+" = "+e;var v=[],m;v.push(e,"\r\n");for(var c=0,g;g=n.filters[c++];){var y=g.indexOf("(");y!==-1?(m=g.slice(y+1,g.lastIndexOf(")")).trim(),m=","+m,g=g.slice(0,y).trim()):m="",v.push(" if(filters",expose,".",g,"){\n	try{\nret",expose," = filters",expose,".",g,"(ret",expose,m,")\n	}catch(e){} \n}\n")}e=v.join(""),e+="\nreturn ret"+expose,a.push("filters"+expose)}else{if(r==="duplex"){var b="'use strict';\nreturn function(vvv){\n	"+l+";\n	if(!arguments.length){\n		return "+e+"\n	}\n	"+(rduplex.test(e)?e:o.get)+"= vvv;\n} ";try{d=Function.apply(noop,a.concat(b)),n.evaluator=cacheExprs(s,d)}catch(w){log("debug: parse error,"+w.message)}return}if(r==="on"){e.indexOf("(")===-1?e+=".call(this, $event)":e=e.replace("(",".call(this,"),a.push("$event"),e="\nreturn "+e+";";var E=e.lastIndexOf("\nreturn"),S=e.slice(0,E),x=e.slice(E);e=S+"\n"+x}else e="\nreturn "+e+";"}try{d=Function.apply(noop,a.concat("'use strict';\n"+l+e)),n.evaluator=cacheExprs(s,d)}catch(w){log("debug: parse error,"+w.message)}finally{o=v=a=null}}function parseExprProxy(e,t,n,r){Array.isArray(r)&&(e=r.map(function(e){return e.expr?"("+e.value+")":quote(e.value)}).join(" + ")),parseExpr(e,t,n),n.evaluator&&(n.handler=bindingExecutors[n.handlerName||n.type],n.evaluator.toString=function(){return n.type+" binding to eval("+e+")"},registerSubscriber(n))}function parseDisplay(e,t){var n="_"+e;if(!parseDisplay[n]){var r=DOC.createElement(e);root.appendChild(r),W3C?t=getComputedStyle(r,null).display:t=r.currentStyle.display,root.removeChild(r),parseDisplay[n]=t}return parseDisplay[n]}function getTypedValue(e,t){switch(e.msType){case"boolean":return t==="true";case"number":return isFinite(t)||t===""?parseFloat(t)||0:t;default:return t}}function W3CFire(e,t,n){var r=DOC.createEvent("Events");r.initEvent(t,!0,!0),n&&(r.detail=n),e.dispatchEvent(r)}function onTree(){!this.disabled&&this.oldValue!==this.value&&(W3C?W3CFire(this,"input"):this.fireEvent("onchange"))}function ticker(){for(var e=ribbon.length-1;e>=0;e--){var t=ribbon[e];t()===!1&&ribbon.splice(e,1)}ribbon.length||clearInterval(TimerID)}function newSetter(e){oldSetter.call(this,e),e!==this.oldValue&&W3CFire(this,"input")}function fixEvent(e){var t={};for(var n in e)t[n]=e[n];var r=t.target=e.srcElement;if(e.type.indexOf("key")===0)t.which=e.charCode!=null?e.charCode:e.keyCode;else if(/mouse|click/.test(e.type)){var i=r.ownerDocument||DOC,s=i.compatMode==="BackCompat"?i.body:i.documentElement;t.pageX=e.clientX+(s.scrollLeft>>0)-(s.clientLeft>>0),t.pageY=e.clientY+(s.scrollTop>>0)-(s.clientTop>>0),t.wheelDeltaY=t.wheelDelta,t.wheelDeltaX=0}return t.timeStamp=new Date-0,t.originalEvent=e,t.preventDefault=function(){e.returnValue=!1},t.stopPropagation=function(){e.cancelBubble=!0},t}function Collection(e){var t=[];t.$id=generateID(),t.$model=e,t.$events={},t.$events[subscribers]=[],t._=modelFactory({length:e.length}),t._.$watch("length",function(e,n){t.$fire("length",e,n)});for(var n in EventManager)t[n]=EventManager[n];return avalon.mix(t,CollectionPrototype),t}function convert(e){return rcomplexType.test(avalon.type(e))&&(e=e.$id?e:modelFactory(e)),e}function shimController(e,t,n,r){var i=avalon.parseHTML(e.template),s=avalon.slice(i.childNodes);t.appendChild(i),n.$outer=e.$outer;var o={nodes:s,vmodels:[n].concat(e.vmodels)};r.push(o)}function locateFragment(e,t){var n=e.element;if(e.type=="repeat"){var r=n.nextSibling;for(var i=0,s=t;i<s;i++){if(!r)break;r=r.nextSibling}}else{var o=avalon.slice(n.parentNode.childNodes,1),u=e.group||o.length/e.proxies.length;r=o[u*t]}return r||null}function removeFragment(e,t,n){var r=t*(n||1),i=[e],s=1,o=hyperspace;while(s<r)e=e.nextSibling,e&&(i[s++]=e);for(var s=0;e=i[s++];)o.appendChild(e);return o}function calculateFragmentGroup(e){if(!isFinite(e.group)){var t=avalon.slice(e.element.parentNode.childNodes,1),n="proxySize"in e?e.proxySize:e.proxies.length;e.group=t.length/n}}function createWithProxy(e,t,n){var r=modelFactory({$key:e,$outer:n,$val:t},{$val:1,$key:1});return r.$id=("$proxy$with"+Math.random()).replace(/0\./,""),r}function getEachProxy(e,t,n,r){var i=n.param||"el",s,o={$remove:function(){return n.$repeat.removeAt(s.$index)},$itemName:i,$index:e,$outer:n.$outer,$first:e===0,$last:e===r};o[i]=t;for(var u=0,a=eachProxyPool.length;u<a;u++){var s=eachProxyPool[u];if(s.hasOwnProperty(i)){for(var f in o)s[f]=o[f];return eachProxyPool.splice(u,1),s}}return rcomplexType.test(avalon.type(t))&&(o.$skipArray=[i]),s=modelFactory(o,watchEachOne),s.$watch(i,function(e){n.$repeat.set(s.$index,e)}),s.$id=("$proxy$"+n.type+Math.random()).replace(/0\./,""),s}function recycleEachProxies(e){for(var t=0,n;n=e[t++];)recycleEachProxy(n);e.length=0}function recycleEachProxy(e){for(var t in e.$events)Array.isArray(e.$events[t])&&(e.$events[t].length=0);eachProxyPool.unshift(e)>kernel.maxRepeatSize&&eachProxyPool.pop()}function fireReady(){DOC.body&&(innerRequire?(modules["ready!"].state=2,innerRequire.checkDeps()):readyList.forEach(function(e){e(avalon)}),fireReady=noop)}function doScrollCheck(){try{root.doScroll("left"),fireReady()}catch(e){setTimeout(doScrollCheck)}}var expose=new Date-0,subscribers="$"+expose,window=this||(0,eval)("this"),otherRequire=window.require,otherDefine=window.define,stopRepeatAssign=!1,rword=/[^, ]+/g,rnative=/\[native code\]/,rcomplexType=/^(?:object|array)$/,rsvg=/^\[object SVG\w*Element\]$/,rwindow=/^\[object (?:Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,Registry={},W3C=window.dispatchEvent,root=DOC.documentElement,head=DOC.getElementsByTagName("head")[0],hyperspace=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(e){class2type["[object "+e+"]"]=e.toLowerCase()}),avalon=function(e){return new avalon.init(e)},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[serialize.call(e)]||"object":typeof e};var isFunction=typeof alert=="object"?function(e){try{return/^\s*\bfunction\b/.test(e+"")}catch(t){return!1}}:function(e){return serialize.call(e)=="[object Function]"};avalon.isFunction=isFunction,avalon.isWindow=function(e){return e?e==e.document&&e.document!=e:!1},isWindow(window)&&(avalon.isWindow=isWindow),avalon.isPlainObject=function(e,t){if(!e||avalon.type(e)!=="object"||e.nodeType||avalon.isWindow(e))return!1;try{if(e.constructor&&!ohasOwn.call(e,"constructor")&&!ohasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}for(t in e);return t===undefined||ohasOwn.call(e,t)},rnative.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(e){return!!e&&typeof e=="object"&&Object.getPrototypeOf(e)===oproto}),avalon.mix=avalon.fn.mix=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u++),typeof o!="object"&&avalon.type(o)!=="function"&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(avalon.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,s=n&&Array.isArray(n)?n:[]):s=n&&avalon.isPlainObject(n)?n:{},o[t]=avalon.mix(f,s,r)):r!==void 0&&(o[t]=r)}return o},avalon.mix({rword:rword,subscribers:subscribers,version:1.36,ui:{},log:log,slice:W3C?function(e,t,n){return aslice.call(e,t,n)}:function(e,t,n){var r=[],i=e.length;n===void 0&&(n=i);if(typeof n=="number"&&isFinite(n)){t=_number(t,i),n=_number(n,i);for(var s=t;s<n;++s)r[s-t]=e[s]}return r},noop:noop,error:function(e,t){throw new(t||Error)(e)},oneObject:oneObject,range:function(e,t,n){n||(n=1),t==null&&(t=e||0,e=0);var r=-1,i=Math.max(0,Math.ceil((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s},eventHooks:{},bind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t];typeof s=="object"&&(t=s.type,s.deel&&(n=s.deel(e,n)));var o=W3C?n:function(t){n.call(e,fixEvent(t))};return W3C?e.addEventListener(t,o,!!r):e.attachEvent("on"+t,o),o},unbind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t],o=n||noop;typeof s=="object"&&(t=s.type),W3C?e.removeEventListener(t,o,!!r):e.detachEvent("on"+t,o)},css:function(e,t,n){e instanceof avalon&&(e=e[0]);var r=/[_-]/.test(t)?camelize(t):t;t=avalon.cssName(r)||r;if(n===void 0||typeof n=="boolean"){var i=cssHooks[r+":get"]||cssHooks["@:get"],s=i(e,t);return n===!0?parseFloat(s)||0:s}if(n==="")e.style[t]="";else{if(n==null||n!==n)return;isFinite(n)&&!avalon.cssNumber[r]&&(n+="px"),i=cssHooks[r+":set"]||cssHooks["@:set"],i(e,t,n)}},each:function(e,t){if(e){var n=0;if(isArrayLike(e))for(var r=e.length;n<r;n++)t(n,e[n]);else for(n in e)e.hasOwnProperty(n)&&t(n,e[n])}},getWidgetData:function(e,t){var n=avalon(e).data(),r={};for(var i in n)i.indexOf(t)===0&&(r[i.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=n[i]);return r},Array:{ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return~n?avalon.Array.removeAt(e,n):!1}}}),avalon.nextTick=window.setImmediate?setImmediate.bind(window):function(e){setTimeout(e,0)};var VMODELS=avalon.vmodels={};avalon.define=function(e,t){var n=e.$id||e;n||log("warning: vm必须指定$id"),VMODELS[e]&&log("warning: "+n+" 已经存在于avalon.vmodels中");if(typeof e=="object")var r=modelFactory(e);else{var i={$watch:noop};t(i),r=modelFactory(i),stopRepeatAssign=!0,t(r),stopRepeatAssign=!1}return r.$id=n,VMODELS[n]=r};var $$skipArray=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray").match(rword),isEqual=Object.is||function(e,t){return e===0&&t===0?1/e===1/t:e!==e?t!==t:e===t},descriptorFactory=W3C?function(e){var t={};for(var n in e)t[n]={get:e[n],set:e[n],enumerable:!0,configurable:!0};return t}:function(e){return e},withProxyPool={},withProxyCount=0,rebindings={},defineProperty=Object.defineProperty;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){"__defineGetter__"in avalon&&(defineProperty=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},defineProperties=function(e,t){for(var n in t)t.hasOwnProperty(n)&&defineProperty(e,n,t[n]);return e})}if(!defineProperties&&window.VBArray){window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function","Dim VBClassBodies",'Set VBClassBodies=CreateObject("Scripting.Dictionary")',"Function findOrDefineVBClass(name,body)","	Dim found",'	found=""',"	For Each key in VBClassBodies","		If body=VBClassBodies.Item(key) Then","			found=key","			Exit For","		End If","	next",'	If found="" Then','		parseVB("Class " + name + body)',"		VBClassBodies.Add name, body","		found=name","	End If","	findOrDefineVBClass=found","End Function"].join("\n"),"VBScript");function VBMediator(e,t,n){var r=e[t];if(typeof r=="function"){if(arguments.length!==3)return r();r(n)}}defineProperties=function(e,t,n){var r="VBClass"+setTimeout("1"),i=[];i.push("\r\n	Private [__data__], [__proxy__]","	Public Default Function [__const__](d, p)","		Set [__data__] = d: set [__proxy__] = p","		Set [__const__] = Me","	End Function");for(e in n)t.hasOwnProperty(e)||i.push("	Public ["+e+"]");i.push("	Public [hasOwnProperty]");for(e in t)i.push("	Public Property Let ["+e+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Set ["+e+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Get ["+e+"]","	On Error Resume Next","		Set["+e+'] = [__proxy__]([__data__],"'+e+'")',"	If Err.Number <> 0 Then","		["+e+'] = [__proxy__]([__data__],"'+e+'")',"	End If","	On Error Goto 0","	End Property");i.push("End Class");var s=i.join("\r\n"),o=window.findOrDefineVBClass(r,s);o===r&&window.parseVB(["Function "+r+"Factory(a, b)","	Dim o","	Set o = (New "+r+")(a, b)","	Set "+r+"Factory = o","End Function"].join("\r\n"));var u=window[o+"Factory"](t,VBMediator);return u}}if(!"司徒正美".trim){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}}var hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;Object.keys||(Object.keys=function(e){var t=[],n=hasProtoEnumBug&&typeof e=="function";if(typeof e=="string"||e&&e.callee)for(var r=0;r<e.length;++r)t.push(String(r));else for(var i in e)(!n||i!=="prototype")&&ohasOwn.call(e,i)&&t.push(String(i));if(hasDontEnumBug){var s=e.constructor,o=s&&s.prototype===e;for(var u=0;u<dontEnumsLength;u++){var a=dontEnums[u];(!o||a!=="constructor")&&ohasOwn.call(e,a)&&t.push(a)}}return t}),Array.isArray||(Array.isArray=function(e){return serialize.call(e)==="[object Array]"}),noop.bind||(Function.prototype.bind=function(e){if(arguments.length<2&&e===void 0)return this;var t=this,n=arguments;return function(){var r=[],i;for(i=1;i<n.length;i++)r.push(n[i]);for(i=0;i<arguments.length;i++)r.push(arguments[i]);return t.apply(e,r)}}),rnative.test([].map)||avalon.mix(ap,{indexOf:function(e,t){var n=this.length,r=~~t;r<0&&(r+=n);for(;r<n;r++)if(this[r]===e)return r;return-1},lastIndexOf:function(e,t){var n=this.length,r=t==null?n-1:t;r<0&&(r=Math.max(0,n+r));for(;r>=0;r--)if(this[r]===e)return r;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),root.contains||(Node.prototype.contains=function(e){return!!(this.compareDocumentPosition(e)&16)}),DOC.contains||(DOC.contains=function(e){return fixContains(DOC,e)});if(window.SVGElement){var svgns="http://www.w3.org/2000/svg",svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />';if(!rsvg.test(svg.firstChild)){function enumerateNode(e,t){if(e&&e.childNodes){var n=e.childNodes;for(var r=0,i;i=n[r++];)if(i.tagName){var s=DOC.createElementNS(svgns,i.tagName.toLowerCase());ap.forEach.call(i.attributes,function(e){s.setAttribute(e.name,e.value)}),enumerateNode(i,s),t.appendChild(s)}}}Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:outerHTML,set:function(e){var t=this.tagName.toLowerCase(),n=this.parentNode,r=avalon.parseHTML(e);if(t==="svg")n.insertBefore(r,this);else{var i=DOC.createDocumentFragment();enumerateNode(r,i),n.insertBefore(i,this)}n.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){if(avalon.clearHTM){avalon.clearHTML(this);var t=avalon.parseHTML(e);enumerateNode(t,this)}}}})}}!root.outerHTML&&window.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML);var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={loader:function(e){window.define=e?innerRequire.define:otherDefine,window.require=e?innerRequire:otherRequire},interpolate:function(e){openTag=e[0],closeTag=e[1];if(openTag===closeTag)throw new SyntaxError("openTag!==closeTag");if(e+""=="<!--,-->")kernel.commentInterpolate=!0;else{var t=openTag+"test"+closeTag;cinerator.innerHTML=t;if(cinerator.innerHTML!==t&&cinerator.innerHTML.indexOf("&lt;")>=0)throw new SyntaxError("此定界符不合法");cinerator.innerHTML=""}var n=escapeRegExp(openTag),r=escapeRegExp(closeTag);rexpr=new RegExp(n+"(.*?)"+r),rexprg=new RegExp(n+"(.*?)"+r,"g"),rbind=new RegExp(n+".*?"+r+"|\\sms-")}};kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var ClassListMethods={_toString:function(){var e=this.node,t=e.className,n=typeof t=="string"?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," ").trim())},__set:function(e){var t=this.node;typeof t.className=="string"?t.className=e:t.setAttribute("class",e)}};"add,remove".replace(rword,function(e){avalon.fn[e+"Class"]=function(t){var n=this[0];return t&&typeof t=="string"&&n&&n.nodeType===1&&t.replace(/\S+/g,function(t){ClassList(n)[e](t)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return t.nodeType===1&&ClassList(t).contains(e)},toggleClass:function(e,t){var n,r=0,i=e.split(/\s+/),s=typeof t=="boolean";while(n=i[r++]){var o=s?t:!this.hasClass(n);this[o?"addClass":"removeClass"](n)}return this},attr:function(e,t){return arguments.length===2?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){e="data-"+hyphen(e||"");switch(arguments.length){case 2:return this.attr(e,t),this;case 1:var n=this.attr(e);return parseData(n);case 0:var r={};return ap.forEach.call(this[0].attributes,function(t){t&&(e=t.name,e.indexOf("data-")||(e=camelize(e.slice(5)),r[e]=parseData(t.value)))}),r}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var r=avalon.css(this,e,t);return r!==void 0?r:this},position:function(){var e,t,n=this[0],r={top:0,left:0};if(!n)return;return this.css("position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),e[0].tagName!=="HTML"&&(r=e.offset()),r.top+=avalon.css(e[0],"borderTopWidth",!0),r.left+=avalon.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-avalon.css(n,"marginTop",!0),left:t.left-r.left-avalon.css(n,"marginLeft",!0)}},offsetParent:function(){var e=this[0].offsetParent||root;while(e&&e.tagName!=="HTML"&&avalon.css(e,"position")==="static")e=e.offsetParent;return avalon(e||root)},bind:function(e,t,n){if(this[0])return avalon.bind(this[0],e,t,n)},unbind:function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},val:function(e){var t=this[0];if(t&&t.nodeType===1){var n=arguments.length===0,r=n?":get":":set",i=valHooks[getValType(t)+r];if(i)var s=i(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?s:this}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=window.JSON?JSON.parse:function(e){if(typeof e=="string"){e=e.trim();if(e&&rvalidchars.test(e.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return(new Function("return "+e))();avalon.error("Invalid JSON: "+e)}},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(n){var r=this[0]||{},i=getWindow(r),s=e==="scrollTop";if(!arguments.length)return i?t in i?i[t]:root[e]:r[e];i?i.scrollTo(s?avalon(i).scrollLeft():n,s?n:avalon(i).scrollTop()):r[e]=n}});var cssHooks=avalon.cssHooks={},prefixes=["","-webkit-","-o-","-moz-","-ms-"],cssMap={"float":"cssFloat",background:"backgroundColor"};avalon.cssNumber=oneObject("columnCount,order,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,n){if(cssMap[e])return cssMap[e];t=t||root.style;for(var r=0,i=prefixes.length;r<i;r++){n=camelize(prefixes[r]+e);if(n in t)return cssMap[e]=n}return null},cssHooks["@:set"]=function(e,t,n){try{e.style[t]=n}catch(r){}};if(window.getComputedStyle)cssHooks["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e,null);return r&&(n=t==="filter"?r.getPropertyValue(t):r[t],n===""&&(n=e.style[t])),n},cssHooks["opacity:get"]=function(e){var t=cssHooks["@:get"](e,"opacity");return t===""?"1":t};else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rposition=/^(top|right|bottom|left)$/,ralpha=/alpha\([^)]*\)/i,ie8=!!window.XDomainRequest,salpha="DXImageTransform.Microsoft.Alpha",border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(e,t){var n=e.currentStyle,r=n[t];if(rnumnonpx.test(r)&&!rposition.test(r)){var i=e.style,s=i.left,o=e.runtimeStyle.left;e.runtimeStyle.left=n.left,i.left=t==="fontSize"?"1em":r||0,r=i.pixelLeft+"px",i.left=s,e.runtimeStyle.left=o}return r==="medium"&&(t=t.replace("Width","Style"),n[t]==="none"&&(r="0px")),r===""?"auto":border[r]||r},cssHooks["opacity:set"]=function(e,t,n){var r=e.style,i=isFinite(n)&&n<=1?"alpha(opacity="+n*100+")":"",s=r.filter||"";r.zoom=1,r.filter=(ralpha.test(s)?s.replace(ralpha,i):s+" "+i).trim(),r.filter||r.removeAttribute("filter")},cssHooks["opacity:get"]=function(e){var t=e.filters.alpha||e.filters[salpha],n=t&&t.enabled?t.opacity:100;return n/100+""}}"top,left".replace(rword,function(e){cssHooks[e+":get"]=function(t){var n=cssHooks["@:get"](t,e);return/px$/.test(n)?n:avalon(t).position()[e]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(e){var t=e.toLowerCase(),n="client"+e,r="scroll"+e,i="offset"+e;cssHooks[t+":get"]=function(t,n,r){var s=-4;typeof r=="number"&&(s=r),n=e==="Width"?["Left","Right"]:["Top","Bottom"];var o=t[i];return s===2?o+avalon.css(t,"margin"+n[0],!0)+avalon.css(t,"margin"+n[1],!0):(s<0&&(o=o-avalon.css(t,"border"+n[0]+"Width",!0)-avalon.css(t,"border"+n[1]+"Width",!0)),s===-4&&(o=o-avalon.css(t,"padding"+n[0],!0)-avalon.css(t,"padding"+n[1],!0)),o)},cssHooks[t+"&get"]=function(e){var n=[];showHidden(e,n);var r=cssHooks[t+":get"](e);for(var i=0,s;s=n[i++];){e=s.node;for(var o in s)typeof s[o]=="string"&&(e.style[o]=s[o])}return r},avalon.fn[t]=function(s){var o=this[0];if(arguments.length===0){if(o.setTimeout)return o["inner"+e]||o.document.documentElement[n];if(o.nodeType===9){var u=o.documentElement;return Math.max(o.body[r],u[r],o.body[i],u[i],u[n])}return cssHooks[t+"&get"](o)}return this.css(t,s)},avalon.fn["inner"+e]=function(){return cssHooks[t+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return cssHooks[t+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0],t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,r=n.body,i=n.documentElement,s=n.defaultView||n.parentWindow;if(!avalon.contains(i,e))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var o=i.clientTop||r.clientTop,u=i.clientLeft||r.clientLeft,a=Math.max(s.pageYOffset||0,i.scrollTop,r.scrollTop),f=Math.max(s.pageXOffset||0,i.scrollLeft,r.scrollLeft);return{top:t.top+a-o,left:t.left+f-u}};var roption=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,valHooks={"option:get":function(e){return e.hasAttribute?e.hasAttribute("value")?e.value:e.text.trim():roption.test(e.outerHTML)?e.value:e.text},"select:get":function(e,t){var n,r=e.options,i=e.selectedIndex,s=valHooks["option:get"],o=e.type==="select-one"||i<0,u=o?null:[],a=o?i+1:r.length,f=i<0?a:o?i:0;for(;f<a;f++){n=r[f];if((n.selected||f===i)&&!n.disabled){t=s(n);if(o)return t;u.push(t)}}return u},"select:set":function(e,t,n){t=[].concat(t);var r=valHooks["option:get"];for(var i=0,s;s=e.options[i++];)if(s.selected=t.indexOf(r(s))>=0)n=!0;n||(e.selectedIndex=-1)}},rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/ig,scriptTypes=oneObject("text/javascript","text/ecmascript","application/ecmascript","application/javascript","text/vbscript"),rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,tagHooks={area:[1,"<map>"],param:[1,"<object>"],col:[2,"<table><tbody></tbody><colgroup>","</table>"],legend:[1,"<fieldset>"],option:[1,"<select multiple='multiple'>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>"],td:[3,"<table><tbody><tr>"],text:[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"],_default:W3C?[0,""]:[1,"X<div>"]};tagHooks.optgroup=tagHooks.option,tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead,tagHooks.th=tagHooks.td,tagHooks.circle=tagHooks.ellipse=tagHooks.line=tagHooks.path=tagHooks.polygon=tagHooks.polyline=tagHooks.rect=tagHooks.text;var script=DOC.createElement("script");avalon.parseHTML=function(e){typeof e!="string"&&(e+=""),e=e.replace(rxhtml,"<$1></$2>").trim();var t=(rtagName.exec(e)||["",""])[1].toLowerCase(),n=tagHooks[t]||tagHooks._default,r=hyperspace.cloneNode(!1),i=cinerator,s,o;W3C||(e=e.replace(rcreate,"<br class=msNoScope>$1")),i.innerHTML=n[1]+e+(n[2]||"");var u=i.getElementsByTagName("script");if(u.length)for(var a=0,f;f=u[a++];)if(!f.type||scriptTypes[f.type])o=script.cloneNode(!1),ap.forEach.call(f.attributes,function(e){e&&e.specified&&(o[e.name]=e.value)}),o.text=f.text,f.parentNode.replaceChild(o,f);for(a=n[0];a--;i=i.lastChild);if(!W3C){for(u=i.getElementsByTagName("br"),a=0;f=u[a++];)f.className&&f.className==="msNoScope"&&f.parentNode.removeChild(f);for(u=i.all,a=0;f=u[a++];)isVML(f)&&fixVML(f)}while(s=i.firstChild)r.appendChild(s);return r},avalon.innerHTML=function(e,t){if(!W3C&&!rcreate.test(t)&&!rnest.test(t))try{e.innerHTML=t;return}catch(n){}var r=this.parseHTML(t);this.clearHTML(e).appendChild(r)},avalon.clearHTML=function(e){e.textContent="";while(e.firstChild)e.removeChild(e.firstChild);return e};var EventManager={$watch:function(e,t){if(typeof t=="function"){var n=this.$events[e];n?n.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var n=arguments.length;if(n===0)this.$watch.backup=this.$events,this.$events={};else if(n===1)this.$events[e]=[];else{var r=this.$events[e]||[],i=r.length;while(~--i<0)if(r[i]===t)return r.splice(i,1)}return this},$fire:function(e){var t;/^(\w+)!(\S+)$/.test(e)&&(t=RegExp.$1,e=RegExp.$2);var n=this.$events,r=n[e]||[],i=n.$all||[],s=aslice.call(arguments,1);for(var o=0,u;u=r[o++];)isFunction(u)&&u.apply(this,s);for(var o=0,u;u=i[o++];)isFunction(u)&&u.apply(this,arguments);var a=n.expr&&findNode(n.expr);if(a){var f=[e].concat(s);if(t==="up"||t==="down"||t==="all"){for(var o in avalon.vmodels){var l=avalon.vmodels[o];if(l&&l.$events&&l.$events.expr&&l!==this){var c=findNode(l.$events.expr);if(!c)continue;var h=t==="all"?1:t==="down"?a.contains(c):c.contains(a);h&&(c._avalon=l)}}var p=DOC.getElementsByTagName("*"),d=[];Array.prototype.forEach.call(p,function(e){e._avalon&&(d.push(e._avalon),e._avalon="",e.removeAttribute("_avalon"))}),t==="up"&&d.reverse(),d.forEach(function(e){e.$fire.apply(e,f)})}}}},ravalon=/(\w+)\[(avalonctrl)="(\S+)"\]/,findNode=DOC.querySelector?function(e){return DOC.querySelector(e)}:function(e){var t=e.match(ravalon),n=DOC.getElementsByTagName(t[1]);for(var r=0,i;i=n[r++];)if(i.getAttribute(t[2])===t[3])return i},ronduplex=/^(duplex|on)$/,$$subscribers=[],$startIndex=0,$maxIndex=200,beginTime=new Date,removeID;avalon.scan=function(e,t){e=e||root;var n=t?[].concat(t):[];scanTag(e,n)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),interval=W3C?15:50,rmsAttr=/ms-(\w+)-?(.*)/,priorityMap={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit");if(!"1"[0])var cacheAttrs=createCache(512),rattrs=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,rquote=/^['"]/,rtag=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,ramp=/&amp;/g,getAttributes=function(e){var t=e.outerHTML;if(t.slice(0,2)==="</"||!t.trim())return[];var n=t.match(rtag)[0],r=[],i,s,o;if(cacheAttrs[n])return cacheAttrs[n];while(s=rattrs.exec(n)){o=s[2],o&&(o=(rquote.test(o)?o.slice(1,-1):o).replace(ramp,"&"));var u=s[1].toLowerCase();i=u.match(rmsAttr);var a={name:u,specified:!0,value:o||""};r.push(a)}return cacheAttrs(n,r)};var rfilters=/\|\s*(\w+)\s*(\([^)]*\))?/g,r11a=/\|\|/g,r11b=/U2hvcnRDaXJjdWl0/g,rlt=/&lt;/g,rgt=/&gt;/g,keywords="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,cacheVars=createCache(512),getVariables=function(e){var t=","+e.trim();if(cacheVars[t])return cacheVars[t];var n=e.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/);return cacheVars(t,uniqSet(n))},cacheExprs=createCache(128),rduplex=/\w\[.*\]|\w\.\w/,rproxy=/(\$proxy\$[a-z]+)\d+$/,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},quote=window.JSON&&JSON.stringify||function(e){return'"'+e.replace(/[\\\"\x00-\x1f]/g,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'};avalon.parseExprProxy=parseExprProxy;var propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly="accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan,dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign";anomaly.replace(rword,function(e){propMap[e.toLowerCase()]=e});var cssText="<style id='avalonStyle'>.avalonHide{ display: none!important }</style>";head.insertBefore(avalon.parseHTML(cssText),head.firstChild);var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},getBindingCallback=function(e,t,n){var r=e.getAttribute(t);if(r)for(var i=0,s;s=n[i++];)if(s.hasOwnProperty(r)&&typeof s[r]=="function")return s[r]},cacheTmpls=avalon.templateCache={};avalon.contains=fixContains;var bools="autofocus,autoplay,async,allowTransparency,checked,controls,declare,disabled,defer,defaultChecked,defaultSelectedcontentEditable,isMap,loop,multiple,noHref,noResize,noShade,open,readOnly,selected",boolMap={};bools.replace(rword,function(e){boolMap[e.toLowerCase()]=e});var bindingExecutors=avalon.bindingExecutors={attr:function(e,t,n){var r=n.type,i=n.param;if(r==="css")avalon(t).css(i,e);else if(r==="attr"){if(boolMap[i]){var s=boolMap[i];if(typeof t[s]=="boolean")return t[s]=!!e}var o=e===!1||e===null||e===void 0;if(!W3C&&propMap[i]){i=propMap[i];var u=!0}if(o)return t.removeAttribute(i);if(window.VBArray&&!u)if(isVML(t))u=!0;else if(!rsvg.test(t)){var a=t.attributes||{},f=a[i];u=f?f.expando===!1:f===null}u?t[i]=e:t.setAttribute(i,e)}else if(r==="include"&&e){var l=n.vmodels,c=getBindingCallback(t,"data-include-rendered",l),h=getBindingCallback(t,"data-include-loaded",l);function p(e){h&&(e=h.apply(t,[e].concat(l))),avalon.innerHTML(t,e),scanNodeList(t,l),c&&checkScan(t,function(){c.call(t)})}if(n.param==="src")if(cacheTmpls[e])avalon.nextTick(function(){p(cacheTmpls[e])});else{var d=getXHR();d.onreadystatechange=function(){if(d.readyState===4){var t=d.status;(t>=200&&t<300||t===304||t===1223)&&p(cacheTmpls[e]=d.responseText)}},d.open("GET",e,!0),"withCredentials"in d&&(d.withCredentials=!0),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.send(null)}else{var v=e&&e.nodeType===1?e:DOC.getElementById(e);if(v){if(v.tagName==="NOSCRIPT"&&!v.innerHTML&&!v.fixIE78){var d=getXHR();d.open("GET",location,!1),d.send(null);var m=DOC.getElementsByTagName("noscript"),g=(d.responseText||"").match(rnoscripts)||[],y=g.length;for(var b=0;b<y;b++){var w=m[b];w&&(w.style.display="none",w.fixIE78=(g[b].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){p(v.fixIE78||v.value||v.innerText||v.innerHTML)})}}}else!root.hasAttribute&&typeof e=="string"&&(r==="src"||r==="href")&&(e=e.replace(/&amp;/g,"&")),t[r]=e},"class":function(e,t,n){var r=avalon(t),i=n.type;if(i==="class"&&n.oldStyle)r.toggleClass(n.oldStyle,!!e);else{n.toggleClass=n._evaluator?!!n._evaluator.apply(t,n._args):!0,n.newClass=n.immobileClass||e,n.oldClass&&n.newClass!==n.oldClass&&r.removeClass(n.oldClass),n.oldClass=n.newClass;switch(i){case"class":r.toggleClass(n.newClass,n.toggleClass);break;case"hover":case"active":if(!n.hasBindEvent){var s="mouseenter",o="mouseleave";i==="active"&&(t.tabIndex=t.tabIndex||-1,s="mousedown",o="mouseup",r.bind("mouseleave",function(){n.toggleClass&&r.removeClass(n.newClass)})),r.bind(s,function(){n.toggleClass&&r.addClass(n.newClass)}),r.bind(o,function(){n.toggleClass&&r.removeClass(n.newClass)}),n.hasBindEvent=!0}}}},data:function(e,t,n){var r="data-"+n.param;e&&typeof e=="object"?t[r]=e:t.setAttribute(r,String(e))},repeat:function(e,t,n){if(e){var r=this,i=r.element.parentNode,s=r.proxies,o=hyperspace.cloneNode(!1);if(e==="del"||e==="move")var u=locateFragment(r,t);var a=r.group;switch(e){case"add":var f=n,l=r.$repeat.length-1,c=[];for(var h=0,p=f.length;h<p;h++){var d=h+t,v=getEachProxy(d,f[h],r,l);s.splice(d,0,v),shimController(r,o,v,c)}u=locateFragment(r,t),i.insertBefore(o,u);for(var h=0,m;m=c[h++];)scanNodeArray(m.nodes,m.vmodels),m.nodes=m.vmodels=null;calculateFragmentGroup(r);break;case"del":var g=s.splice(t,n),o=removeFragment(u,a,n);avalon.clearHTML(o),recycleEachProxies(g);break;case"index":var l=s.length-1;for(;n=s[t];t++)n.$index=t,n.$first=t===0,n.$last=t===l;break;case"clear":var y="proxySize"in r?r.proxySize:s.length;if(y){var p=y*a,b=0;for(;;){var w=r.element.nextSibling;if(!(w&&b<p))break;i.removeChild(w),b++}recycleEachProxies(s)}break;case"move":var E=s.splice(t,1)[0];E&&(s.splice(n,0,E),o=removeFragment(u,a),u=locateFragment(r,n),i.insertBefore(o,u));break;case"set":var v=s[t];v&&(v[v.$itemName]=n);break;case"append":var S=n,x=[],c=[];for(var T in t)t.hasOwnProperty(T)&&T!=="hasOwnProperty"&&x.push(T);if(r.sortedCallback){var N=r.sortedCallback.call(i,x);N&&Array.isArray(N)&&N.length&&(x=N)}for(var h=0,T;T=x[h++];)T!=="hasOwnProperty"&&shimController(r,o,S[T],c);r.proxySize=x.length,i.insertBefore(o,r.element.nextSibling);for(var h=0,m;m=c[h++];)scanNodeArray(m.nodes,m.vmodels),m.nodes=m.vmodels=null;calculateFragmentGroup(r)}var C=r.renderedCallback||noop,k=arguments;checkScan(i,function(){C.apply(i,k),i.oldValue&&i.tagName==="SELECT"&&e==="index"&&avalon(i).val(i.oldValue.split(","))})}},html:function(e,t,n){e=e==null?"":e;var r="group"in n?t.parentNode:t;if("group"in n){var i,s;if(e.nodeType===11)i=e;else if(e.nodeType===1||e.item){s=e.nodeType===1?e.childNodes:e.item?e:[],i=hyperspace.cloneNode(!0);while(s[0])i.appendChild(s[0])}else i=avalon.parseHTML(e);s=avalon.slice(i.childNodes);if(s.length===0){var o=DOC.createComment("ms-html");i.appendChild(o),s=[o]}r.insertBefore(i,t);var u=n.group;while(t){var a=t.nextSibling;r.removeChild(t),u--;if(u===0||a===null)break;t=a}n.element=s[0],n.group=s.length}else avalon.innerHTML(r,e);avalon.nextTick(function(){scanNodeList(r,n.vmodels)})},"if":function(e,t,n){if(e)t.nodeType===8&&(t.parentNode.replaceChild(n.template,t),t=n.element=n.template),t.getAttribute(n.name)&&(t.removeAttribute(n.name),scanAttr(t,n.vmodels));else if(t.nodeType===1){var r=n.element=DOC.createComment("ms-if");t.parentNode.replaceChild(r,t),n.template=t,head.appendChild(t)}},on:function(e,t,n){n.type="on",e=function(e){var t=n.evaluator||noop;return t.apply(this,n.args.concat(e))};var r=n.param.replace(/-\d+$/,"");if(r==="scan")e.call(t,{type:r});else if(typeof n.specialBind=="function")n.specialBind(t,e);else var i=avalon.bind(t,r,e);n.rollback=function(){typeof n.specialUnbind=="function"?n.specialUnbind():avalon.unbind(t,r,i)}},text:function(e,t){e=e==null?"":e;if(t.nodeType===3)try{t.data=e}catch(n){}else"textContent"in t?t.textContent=e:t.innerText=e},visible:function(e,t,n){t.style.display=e?n.display:"none"},widget:noop},rdash=/\(([^)]*)\)/;avalon.parseDisplay=parseDisplay;var bindingHandlers=avalon.bindingHandlers={attr:function(e,t){var n=e.value.trim(),r=!0;n.indexOf(openTag)>-1&&n.indexOf(closeTag)>2&&(r=!1,rexpr.test(n)&&RegExp.rightContext===""&&RegExp.leftContext===""&&(r=!0,n=RegExp.$1)),e.handlerName="attr",parseExprProxy(n,t,e,r?null:scanExpr(e.value))},"class":function(e,t){var n=e.param,r=e.value,i;e.handlerName="class";if(!n||isFinite(n)){e.param="";var s=r.replace(rexprg,function(e){return Math.pow(10,e.length-1)}),o=s.indexOf(":");if(o===-1)var u=r;else{u=r.slice(0,o),i=r.slice(o+1),parseExpr(i,t,e);if(!e.evaluator)return log("debug: ms-class '"+(i||"").trim()+"' 不存在于VM中"),!1;e._evaluator=e.evaluator,e._args=e.args}var a=rexpr.test(u);a||(e.immobileClass=u),parseExprProxy("",t,e,a?scanExpr(u):null)}else e.immobileClass=e.oldStyle=e.param,parseExprProxy(r,t,e)},duplex:function(e,t){var n=e.element,r=n.tagName;if(typeof duplexBinding[r]=="function"){e.changed=getBindingCallback(n,"data-duplex-changed",t)||noop,parseExpr(e.value,t,e,"duplex");if(e.evaluator&&e.args){var i=n.form;i&&i.msValidate&&i.msValidate(n),e.msType=e.param||"",e.msType==="bool"?(e.msType="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):e.msType==="text"&&(e.msType="string",log("ms-duplex-text已经更名为ms-duplex-string")),e.msType==="radio"&&log("ms-duplex-radio将在2.0废掉，请尽量不要用"),/boolean|string|number/.test(e.msType)||(e.msType=""),e.bound=function(t,r){n.addEventListener?n.addEventListener(t,r,!1):n.attachEvent("on"+t,r);var i=e.rollback;e.rollback=function(){avalon.unbind(n,t,r),i&&i()}},duplexBinding[n.tagName](n,e.evaluator.apply(null,e.args),e)}}},repeat:function(e,t){var n=e.type;parseExpr(e.value,t,e),e.proxies=[];var r=!1;try{var i=e.$repeat=e.evaluator.apply(0,e.args||[]),s=avalon.type(i);s!=="object"&&s!=="array"&&(r=!0,avalon.log("warning:"+e.value+"对应类型不正确"))}catch(o){r=!0,avalon.log("warning:"+e.value+"编译出错")}var u=e.element;u.removeAttribute(e.name),e.sortedCallback=getBindingCallback(u,"data-with-sorted",t),e.renderedCallback=getBindingCallback(u,"data-"+n+"-rendered",t);var a=e.element=DOC.createComment("ms-repeat");n==="each"||n==="with"?(e.template=u.innerHTML.trim(),avalon.clearHTML(u).appendChild(a)):(e.template=u.outerHTML.trim(),e.group=1,u.parentNode.replaceChild(a,u)),e.rollback=function(){bindingExecutors.repeat.call(e,"clear");var t=e.element,n=t.parentNode,r=avalon.parseHTML(e.template),i=r.firstChild;n.replaceChild(r,t),i=e.element=e.type==="repeat"?i:n,e.group=null,i.setAttribute(e.name,e.value)};var f=e.value.split(".")||[];if(f.length>1){f.pop();var l=f[0];for(var c=0,h;h=t[c++];)if(h&&h.hasOwnProperty(l)){var p=h[l].$events;p[subscribers]=p[subscribers]||[],p[subscribers].push(e);break}}if(r)return;e.handler=bindingExecutors.repeat,e.$outer={};var d="$key",v="$val";Array.isArray(i)&&(d="$first",v="$last");for(var c=0,m;m=t[c++];)if(m.hasOwnProperty(d)&&m.hasOwnProperty(v)){e.$outer=m;break}var g=(i.$events||{})[subscribers];g&&avalon.Array.ensure(g,e)&&$$subscribers.push({data:e,list:g});if(!Array.isArray(i)&&n!=="each"){var y=withProxyPool[i.$id];if(!y){withProxyCount++,y=withProxyPool[i.$id]={};for(var b in i)i.hasOwnProperty(b)&&b!=="hasOwnProperty"&&function(e,t){y[e]=createWithProxy(e,t,{}),y[e].$watch("$val",function(t){i[e]=t})}(b,i[b])}e.handler("append",i,y)}else e.handler("add",0,i)},html:function(e,t){parseExprProxy(e.value,t,e)},on:function(e,t){var n=e.value,r=e.param.replace(/-\d+$/,"");typeof bindingHandlers.on[r+"Hook"]=="function"&&bindingHandlers.on[r+"Hook"](e);if(n.indexOf("(")>0&&n.indexOf(")")>-1){var i=(n.match(rdash)||["",""])[1].trim();if(i===""||i==="$event")n=n.replace(rdash,"")}parseExprProxy(n,t,e)},visible:function(e,t){var n=avalon(e.element),r=n.css("display");if(r==="none"){var i=n[0].style,s=/visibility/i.test(i.cssText),o=n.css("visibility");i.display="",i.visibility="hidden",r=n.css("display"),r==="none"&&(r=parseDisplay(n[0].nodeName)),i.visibility=s?o:""}e.display=r,parseExprProxy(e.value,t,e)},widget:function(e,t){var n=e.value.match(rword),r=e.element,i=n[0];if(n[1]==="$"||!n[1])n[1]=i+setTimeout("1");e.value=n.join(",");var s=avalon.ui[i];if(typeof s=="function"){t=r.vmodels||t;var o=n[2]||i;for(var u=0,a;a=t[u++];)if(a.hasOwnProperty(o)&&typeof a[o]=="object"){var f=a;break}if(f){var l=f[o];l=l.$model||l;var c=l[i+"Id"];typeof c=="string"&&(n[1]=c)}var h=avalon.getWidgetData(r,n[0]);e[i+"Id"]=n[1],e[i+"Options"]=avalon.mix({},s.defaults,l||{},h),r.removeAttribute("ms-widget");var p=s(r,e,t)||{};e.evaluator=noop,r.msData["ms-widget-id"]=p.$id||"",p.hasOwnProperty("$init")&&p.$init();if(p.hasOwnProperty("$remove")){function d(){if(!r.msRetain&&!root.contains(r))return p.$remove(),r.msData={},delete VMODELS[p.$id],!1}window.chrome?r.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(d)}):avalon.tick(d)}}else t.length&&(r.vmodels=t)}};"hover,active".replace(rword,function(e){bindingHandlers[e]=bindingHandlers["class"]}),"with,each".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.repeat}),bindingHandlers["if"]=bindingHandlers.data=bindingHandlers.text=bindingHandlers.html,"title,alt,src,value,css,include,href".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.attr});var duplexBinding=bindingHandlers.duplex;duplexBinding.INPUT=function(e,t,n){function a(e){o=!0,n.changed.call(this,e)}function f(){u=!0}function l(){u=!1}function c(){if(u)return;var r=e.oldValue=e.value,i=getTypedValue(n,r);s.data("duplex-observe")!==!1&&(t(i),a.call(e,i),s.data("duplex-focus")&&avalon.nextTick(function(){e.focus()}))}var r=e.type,i=n.bound,s=avalon(e),o=!1,u=!1;n.handler=function(){var n=t();n=n==null?"":n+"",n!==e.value&&(e.value=n)},r==="checkbox"&&n.param==="radio"&&(r="radio");if(r==="radio"){var h=!window.XMLHttpRequest;c=function(){if(s.data("duplex-observe")!==!1){var r=e.value,i=n.msType?getTypedValue(n,r):!e.oldValue;t(i),a.call(e,i)}},n.handler=function(){var r=t(),i=n.msType?r+""===e.value:!!r;e.oldValue=i,h?setTimeout(function(){e.defaultChecked=i,e.checked=i},100):e.checked=i},i(h?"mouseup":"click",c)}else if(r==="checkbox")c=function(){if(s.data("duplex-observe")!==!1){var r=e.checked?"ensure":"remove",i=t();Array.isArray(i)||(log("ms-duplex应用于checkbox上要对应一个数组"),i=[i]);var o=getTypedValue(n,e.value);avalon.Array[r](i,o),a.call(e,i)}},n.handler=function(){var r=[].concat(t());e.checked=r.indexOf(getTypedValue(n,e.value))>=0},i(W3C?"change":"click",c);else{var p=e.attributes["data-duplex-event"]||e.attributes["data-event"]||{};e.attributes["data-event"]&&log("data-event指令已经废弃，请改用data-duplex-event"),p=p.value;if(p==="change")i("change",c);else if(W3C&&DOC.documentMode!==9)i("input",c),i("compositionstart",f),i("compositionend",l);else{var d=["keyup","paste","cut","change"];function v(e){var t=e.keyCode;if(t===91||15<t&&t<19||37<=t&&t<=40)return;e.type==="cut"?avalon.nextTick(c):c()}d.forEach(function(t){e.attachEvent("on"+t,v)}),n.rollback=function(){d.forEach(function(t){e.detachEvent("on"+t,v)})}}}e.oldValue=e.value,launch(function(){if(avalon.contains(root,e))onTree.call(e);else if(!e.msRetain)return!1}),registerSubscriber(n);var m=setTimeout(function(){o||a.call(e,e.value),clearTimeout(m)},31)};var TimerID,ribbon=[],launch=noop;avalon.tick=function(e){ribbon.push(e)===1&&(TimerID=setInterval(ticker,60))};try{var inputProto=HTMLInputElement.prototype;Object.getOwnPropertyNames(inputProto);var oldSetter=Object.getOwnPropertyDescriptor(inputProto,"value").set;Object.defineProperty(inputProto,"value",{set:newSetter})}catch(e){launch=avalon.tick}duplexBinding.SELECT=function(e,t,n){function i(){if(r.data("duplex-observe")!==!1){var i=r.val();Array.isArray(i)?i=i.map(function(e){return getTypedValue(n,e)}):i=getTypedValue(n,i),i+""!==e.oldValue&&t(i),n.changed.call(e,i)}}var r=avalon(e);n.handler=function(){var n=t();n=n&&n.$model||n,Array.isArray(n)?e.multiple||log("ms-duplex在<select multiple=true>上要求对应一个数组"):e.multiple&&log("ms-duplex在<select multiple=false>不能对应一个数组"),n=Array.isArray(n)?n.map(String):n+"",n+""!==e.oldValue&&(r.val(n),e.oldValue=n+"")},n.bound("change",i);var s=NaN,o=setInterval(function(){var r=e.innerHTML;r===s?(clearInterval(o),registerSubscriber(n),n.changed.call(e,t())):s=r},20)},duplexBinding.TEXTAREA=duplexBinding.INPUT;var eventHooks=avalon.eventHooks;"onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){eventHooks[e]={type:t,deel:function(t,n){return function(r){var i=r.relatedTarget;if(!i||i!==t&&!(t.compareDocumentPosition(i)&16))return delete r.type,r.type=e,n.call(t,r)}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!eventHooks.animationend&&(eventHooks.animationend={type:t})}),"oninput"in DOC.createElement("input")||(eventHooks.input={type:"propertychange",deel:function(e,t){return function(n){if(n.propertyName==="value")return n.type="input",t.call(e,n)}}});if(DOC.onmousewheel===void 0){var fixWheelType=DOC.onwheel!==void 0?"wheel":"DOMMouseScroll",fixWheelDelta=fixWheelType==="wheel"?"deltaY":"detail";eventHooks.mousewheel={type:fixWheelType,deel:function(e,t){return function(n){n.wheelDeltaY=n.wheelDelta=n[fixWheelDelta]>0?-120:120,n.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(n,"type",{value:"mousewheel"}),t.call(e,n)}}}}var _splice=ap.splice,CollectionPrototype={_splice:_splice,_fire:function(e,t,n){notifySubscribers(this.$events[subscribers],e,t,n)},_add:function(e,t){var n=this.length;t=typeof t=="number"?t:n;var r=[];for(var i=0,s=e.length;i<s;i++)r[i]=convert(e[i]);_splice.apply(this,[t,0].concat(r)),this._fire("add",t,r);if(!this._stopFireLength)return this._.length=this.length},_del:function(e,t){var n=this._splice(e,t);return n.length&&(this._fire("del",e,t),this._stopFireLength||(this._.length=this.length)),n},push:function(){ap.push.apply(this.$model,arguments);var e=this._add(arguments);return this._fire("index",e>2?e-2:0),e},pushArray:function(e){return this.push.apply(this,e)},unshift:function(){return ap.unshift.apply(this.$model,arguments),this._add(arguments,0),this._fire("index",arguments.length),this.$model.length},shift:function(){var e=this.$model.shift();return this._del(0,1),this._fire("index",0),e},pop:function(){var e=this.$model.pop();return this._del(this.length-1,1),e},splice:function(e,t){e=_number(e,this.length);var n=_splice.apply(this.$model,arguments),r=[],i;return this._stopFireLength=!0,n.length&&(r=this._del(e,n.length),i=!0),arguments.length>2&&(this._add(aslice.call(arguments,2),e),i=!0),this._stopFireLength=!1,this._.length=this.length,i&&this._fire("index",0),r},contains:function(e){return this.indexOf(e)!==-1},size:function(){return this._.length},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>=0?this.splice(e,1):[]},clear:function(){return this.$model.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(e){if(Array.isArray(e))e.forEach(function(e){this.remove(e)},this);else if(typeof e=="function")for(var t=this.length-1;t>=0;t--){var n=this[t];e(n,t)&&this.splice(t,1)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e>=0){var n=avalon.type(t);t&&t.$model&&(t=t.$model);var r=this[e];if(n==="object")for(var i in t)r.hasOwnProperty(i)&&(r[i]=t[i]);else n==="array"?r.clear().push.apply(r,t):r!==t&&(this[e]=t,this.$model[e]=t,this._fire("set",e,t))}return this}};"sort,reverse".replace(rword,function(e){CollectionPrototype[e]=function(){var t=this.$model,n=t.slice(0),r=!1;ap[e].apply(t,arguments);for(var i=0,s=n.length;i<s;i++){var o=t[i],u=n[i];if(!isEqual(o,u)){r=!0;var a=n.indexOf(o,i),f=this._splice(a,1)[0],l=n.splice(a,1)[0];this._splice(i,0,f),n.splice(i,0,l),this._fire("move",a,i)}}return n=void 0,r&&this._fire("index",0),this}});var watchEachOne=oneObject("$index,$first,$last"),eachProxyPool=[],rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig,rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig},rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,n){return t=t||30,n=n===void 0?"...":n,e.length>t?e.slice(0,t-n.length)+n:String(e)},camelize:camelize,sanitize:function(e){return e.replace(rscripts,"").replace(ropen,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=rsanitize[n[1]];r&&(e=e.replace(r,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace(ron," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(rsurrogate,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+((t-55296)*1024+(n-56320)+65536)+";"}).replace(rnoalphanumeric,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(e,t){return t=t||"￥",t+avalon.filters.number(e)},number:function(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+e)?+e:0,s=isFinite(+t)?Math.abs(t):0,o=r||",",u=n||".",a="",f=function(e,t){var n=Math.pow(10,t);return""+Math.round(e*n)/n};return a=(s?f(i,s):""+Math.round(i)).split("."),a[0].length>3&&(a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o)),(a[1]||"").length<s&&(a[1]=a[1]||"",a[1]+=(new Array(s-a[1].length+1)).join("0")),a.join(u)}};new function(){function e(e){return parseInt(e,10)}function t(e,t,n){var r="";e<0&&(r="-",e=-e),e=""+e;while(e.length<t)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function n(e,n,r,i){return function(s){var o=s["get"+e]();if(r>0||o>-r)o+=r;return o===0&&r===-12&&(o=12),t(o,n,i)}}function r(e,t){return function(n,r){var i=n["get"+e](),s=(t?"SHORT"+e:e).toUpperCase();return r[s][i]}}function i(e){var n=-1*e.getTimezoneOffset(),r=n>=0?"+":"";return r+=t(Math[n>0?"floor":"ceil"](n/60),2)+t(Math.abs(n%60),2),r}function s(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function l(t){var n;if(n=t.match(f)){var r=new Date(0),i=0,s=0,o=n[8]?r.setUTCFullYear:r.setFullYear,u=n[8]?r.setUTCHours:r.setHours;n[9]&&(i=e(n[9]+n[10]),s=e(n[9]+n[11])),o.call(r,e(n[1]),e(n[2])-1,e(n[3]));var a=e(n[4]||0)-i,l=e(n[5]||0)-s,c=e(n[6]||0),h=Math.round(parseFloat("0."+(n[7]||0))*1e3);return u.call(r,a,l,c,h),r}return t}var o={yyyy:n("FullYear",4),yy:n("FullYear",2,0,!0),y:n("FullYear",1),MMMM:r("Month"),MMM:r("Month",!0),MM:n("Month",2,1),M:n("Month",1,1),dd:n("Date",2),d:n("Date",1),HH:n("Hours",2),H:n("Hours",1),hh:n("Hours",2,-12),h:n("Hours",1,-12),mm:n("Minutes",2),m:n("Minutes",1),ss:n("Seconds",2),s:n("Seconds",1),sss:n("Milliseconds",3),EEEE:r("Day"),EEE:r("Day",!0),a:s,Z:i},u=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,a=/^\d+$/,f=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,c=/^(\d+)-(\d+)-(\d{4})$/,h=/^(\d+)\s+(\d+),(\d{4})$/;filters.date=function(t,n){var r=filters.date.locate,i="",s=[],f,p;n=n||"mediumDate",n=r[n]||n;if(typeof t=="string"){if(a.test(t))t=e(t);else{var d=t.trim();if(d.match(c)||d.match(h))t=RegExp.$3+"/"+RegExp.$1+"/"+RegExp.$2;t=l(t)}t=new Date(t)}typeof t=="number"&&(t=new Date(t));if(avalon.type(t)!=="date")return;while(n)p=u.exec(n),p?(s=s.concat(p.slice(1)),n=s.pop()):(s.push(n),n=null);return s.forEach(function(e){f=o[e],i+=f?f(t,r):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i};var p={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d ah:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"ah:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};p.SHORTMONTH=p.MONTH,filters.date.locate=p};var innerRequire,modules=avalon.modules={"ready!":{exports:avalon},avalon:{exports:avalon,state:2}};new function(){function r(e){return(e||"").replace(/[?#].*/,"")}function o(e){var t;try{a.b.c()}catch(n){t=n.stack,!t&&window.opera&&(t=(String(n).match(/of linked script \S+/g)||[]).join(" "))}if(t)return t=t.split(/[@ ]/g).pop(),t=t[0]==="("?t.slice(1,-1):t.replace(/\s/,""),t.replace(/(:\d+)?:\d+$/i,"");var r=(e?DOC:head).getElementsByTagName("script");for(var i=r.length,s;s=r[--i];)if((e||s.className===subscribers)&&s.readyState==="interactive")return s.className=s.src}function u(e,t){for(var n in e)if(e[n]==="司徒正美"&&modules[n].state!==2&&(n===t||u(modules[n].deps,t)))return!0}function f(){e:for(var t=e.length,n;n=e[--t];){var r=modules[n],i=r.deps;for(var s in i)if(ohasOwn.call(i,s)&&modules[s].state!==2)continue e;r.state!==2&&(e.splice(t,1),d(r.id,r.args,r.factory),f())}}function l(e,t,n){var i=r(e.src);e.onload=e.onreadystatechange=e.onerror=null;if(!(t||n&&!modules[i].state))return!0;setTimeout(function(){head.removeChild(e),e=null}),log("debug: 加载 "+i+" 失败"+t+" "+!modules[i].state)}function h(e,t,i,s){if(e==="ready!"||modules[e]&&modules[e].state===2)return e;var o;e=e.replace(/^\w+!/,function(e){return o=e.slice(0,-1),""}),o=o||"js",o=plugins[o]||noop,typeof kernel.shim[e]=="object"&&(s=kernel.shim[e]),kernel.paths[e]&&(e=kernel.paths[e]);if(/^(\w+)(\d)?:.*/.test(e))i=e;else{t=t.substr(0,t.lastIndexOf("/"));var u=e.charAt(0);if(u!=="."&&u!=="/")i=n+e;else if(e.slice(0,2)==="./")i=t+e.slice(1);else if(e.slice(0,2)===".."){i=t+"/"+e;while(c.test(i))i=i.replace(c,"")}else u==="/"?i=e:avalon.error("不符合模块标识规则: "+e)}e=r(i);var a=o.ext;return a&&e.slice(0-a.length)!==a&&(i+=a),kernel.nocache&&(i+=(i.indexOf("?")===-1?"?":"&")+(new Date-0)),o(i,s)}function p(e,n,r){var i=DOC.createElement("script");i.className=subscribers,i[W3C?"onload":"onreadystatechange"]=function(){if(W3C||/loaded|complete/i.test(i.readyState)){var s=t.pop();s&&s.delay(n),r&&r(),l(i,!1,!W3C)&&log("debug: 已成功加载 "+e)}},i.onerror=function(){l(i,!0)},i.src=e,head.insertBefore(i,head.firstChild),log("debug: 正准备加载 "+e)}function d(e,t,n){for(var r=0,i=[],s;s=t[r++];)i.push(modules[s].exports);var o=Object(modules[e]),u=n.apply(window,i);return o.state=2,u!==void 0&&(modules[e].exports=u),u}var e=[],t=[],n;plugins.js=function(e,t){var n=r(e);return modules[n]||(modules[n]={id:n,exports:{}},t?innerRequire(t.deps||"",function(){p(e,n,function(){modules[n].state=2,t.exports&&(modules[n].exports=typeof t.exports=="function"?t.exports():window[t.exports]),innerRequire.checkDeps()})}):p(e,n)),n},plugins.css=function(e){var t=e.replace(/(#.+|\W)/g,"");if(!DOC.getElementById(t)){var n=DOC.createElement("link");n.rel="stylesheet",n.href=e,n.id=t,head.insertBefore(n,head.firstChild)}},plugins.css.ext=".css",plugins.js.ext=".js",plugins.text=function(e){var t=getXHR(),n=e.replace(/[?#].*/,"");return modules[n]={},t.onreadystatechange=function(){if(t.readyState===4){var r=t.status;r>399&&r<600?avalon.error(e+" 对应资源不存在或没有开启 CORS"):(modules[n].state=2,modules[n].exports=t.responseText,innerRequire.checkDeps())}},t.open("GET",e,!0),"withCredentials"in t&&(t.withCredentials=!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.send(),n};var i=o(!0);i||(i=avalon.slice(DOC.scripts).pop().src);var s=r(i);n=kernel.base=s.slice(0,s.lastIndexOf("/")+1);var c=/\/\w+\/\.\./;innerRequire=avalon.require=function(t,r,i){var s={},o=[],u=0,a=0,l=i||"callback"+setTimeout("1");i=i||n,String(t).replace(rword,function(e){var t=h(e,i);t&&(u++,modules[t]&&modules[t].state===2&&a++,s[t]||(o.push(t),s[t]="司徒正美"))}),modules[l]={id:l,factory:r,deps:s,args:o,state:1},u===a?d(l,o,r):e.unshift(l),f()},innerRequire.define=function(e,n,i){var s=aslice.call(arguments);if(typeof e=="string")var a=s.shift();typeof s[0]=="function"&&s.unshift([]);var f=modules[a]&&modules[a].state>=1?a:r(o());!modules[f]&&a&&(modules[f]={id:f,factory:i,state:1}),i=s[1],i.id=a,i.delay=function(e){s.push(e);var t=!0;try{t=u(modules[e].deps,e)}catch(n){}t&&avalon.error(e+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+e+"模块"),delete i.delay,innerRequire.apply(null,s)},f?i.delay(f,s):t.push(i)},innerRequire.define.amd=modules,innerRequire.config=kernel,innerRequire.checkDeps=f};var readyList=[];DOC.readyState==="complete"?setTimeout(fireReady):W3C?DOC.addEventListener("DOMContentLoaded",fireReady):(DOC.attachEvent("onreadystatechange",function(){DOC.readyState==="complete"&&fireReady()}),root.doScroll&&doScrollCheck()),avalon.bind(window,"load",fireReady),avalon.ready=function(e){innerRequire?innerRequire("ready!",e):fireReady===noop?e(avalon):readyList.push(e)},avalon.config({loader:!0}),avalon.ready(function(){})})(document);