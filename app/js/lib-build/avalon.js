/*==================================================
 Copyright (c) 2013-2014 司徒正美 and other contributors
 http://www.cnblogs.com/rubylouvre/
 https://github.com/RubyLouvre
 http://weibo.com/jslouvre/
 
 Released under the MIT license
 avalon 1.3.6 2014.10.30 support IE6+ and other browsers
 ==================================================*/

(function(DOC){function noop(){}function log(){window.console&&avalon.config.debug}function oneObject(e,t){typeof e=="string"&&(e=e.match(rword)||[]);var n={},r=t!==void 0?t:1;for(var i=0,s=e.length;i<s;i++)n[e[i]]=r;return n}function generateID(){return"avalon"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function isWindow(e){return rwindow.test(serialize.call(e))}function _number(e,t){return e=Math.floor(e)||0,e<0?Math.max(t+e,0):Math.min(e,t)}function isArrayLike(e){if(e&&typeof e=="object"&&!avalon.isWindow(e)){var t=e.length;if(+t===t&&!(t%1)&&t>=0)try{return{}.propertyIsEnumerable.call(e,"length")===!1?Array.isArray(e)||/^\s?function/.test(e.item||e.callee):!0}catch(n){return!0}}return!1}function isObservable(e,t,n){if(isFunction(t)||t&&t.nodeType)return!1;if(n.indexOf(e)!==-1)return!1;if($$skipArray.indexOf(e)!==-1)return!1;var r=n.$special;return e&&e.charAt(0)==="$"&&!r[e]?!1:!0}function modelFactory(e,t,n){if(Array.isArray(e)){var r=e.concat();e.length=0;var i=Collection(e);return i.pushArray(r),i}if(typeof e.nodeType=="number")return e;if(e.$id&&e.$model&&e.$events)return e;Array.isArray(e.$skipArray)||(e.$skipArray=[]),e.$skipArray.$special=t||{};var s={};n=n||{};var o={},u={},a=[];for(var f in e)(function(t,r){n[t]=r;if(!isObservable(t,r,e.$skipArray))return;var i,f=avalon.type(r);o[t]=[];if(f==="object"&&isFunction(r.get)&&Object.keys(r).length<=2){var l=r.set,c=r.get;i=function(e){var r=s.$events,i=n[t];if(arguments.length){if(stopRepeatAssign)return;if(isFunction(l)){var o=r[t];r[t]=[],l.call(s,e),r[t]=o}}else avalon.openComputedCollect&&collectSubscribers(r[t]);return e=n[t]=c.call(s),isEqual(i,e)||(withProxyCount&&updateWithProxy(s.$id,t,e),notifySubscribers(r[t]),safeFire(s,t,e,i)),e},a.push(function(){Registry[expose]={evaluator:i,element:head,type:"computed::"+t,handler:noop,args:[]},i(),collectSubscribers(o[t]),delete Registry[expose]})}else if(rcomplexType.test(f)){i=function(e){var r=i.child,u=n[t];if(!arguments.length)return collectSubscribers(o[t]),r;if(stopRepeatAssign)return;if(!isEqual(u,e)){r=i.child=updateChild(s,t,e,f),e=n[t]=r.$model;var a=rebindings[r.$id];a&&a(),safeFire(s,t,e,u)}};var h=i.child=modelFactory(r,0,n[t]);h.$events[subscribers]=o[t]}else i=function(e){var r=n[t];if(!arguments.length)return collectSubscribers(o[t]),r;isEqual(r,e)||(n[t]=e,withProxyCount&&updateWithProxy(s.$id,t,e),notifySubscribers(o[t]),safeFire(s,t,e,r))};u[t]=i})(f,e[f]);$$skipArray.forEach(function(t){delete e[t],delete n[t]}),s=defineProperties(s,descriptorFactory(u),e);for(var l in e)u[l]||(s[l]=e[l]);s.$id=generateID(),s.$model=n,s.$events=o;for(var f in EventManager){var c=EventManager[f];W3C||(c=c.bind(s)),s[f]=c}return s.hasOwnProperty=function(e){return e in s.$model},a.forEach(function(e){e()}),s}function safeFire(e,t,n,r){e.$events&&EventManager.$fire.call(e,t,n,r)}function updateWithProxy(e,t,n){var r=withProxyPool[e];r&&r[t]&&(r[t].$val=n)}function updateChild(e,t,n,r){var i=e[t];if(r==="array")return!Array.isArray(n)||i===n?i:(i.clear(),i.pushArray(n.concat()),i);var s=e.$events[t];withProxyPool[i.$id]&&(withProxyCount--,delete withProxyPool[i.$id]);var o=modelFactory(n);return o.$events[subscribers]=s,rebindings[o.$id]=function(e){while(e=s.shift())(function(e){e.type&&avalon.nextTick(function(){e.rollback&&e.rollback(),bindingHandlers[e.type](e,e.vmodels)})})(e);delete rebindings[o.$id]},o}function iterator(e,t,n){var r="for(var "+e+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+n;return Function("fn,scope",r)}function fixContains(e,t){try{while(t=t.parentNode)if(t===e)return!0;return!1}catch(n){return!1}}function outerHTML(){return(new XMLSerializer).serializeToString(this)}function kernel(e){for(var t in e){if(!ohasOwn.call(e,t))continue;var n=e[t];typeof kernel.plugins[t]=="function"?kernel.plugins[t](n):typeof kernel[t]=="object"?avalon.mix(kernel[t],n):kernel[t]=n}return this}function escapeRegExp(e){return(e+"").replace(rregexp,"\\$&")}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function ClassList(e){if(!("classList"in e)){e.classList={node:e};for(var t in ClassListMethods)e.classList[t.slice(1)]=ClassListMethods[t]}return e.classList}function parseData(e){try{e=e==="true"?!0:e==="false"?!1:e==="null"?null:+e+""===e?+e:rbrace.test(e)?avalon.parseJSON(e):e}catch(t){}return e}function getWindow(e){return e.window&&e.document?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}function showHidden(e,t){if(e.offsetWidth<=0){if(rdisplayswap.test(cssHooks["@:get"](e,"display"))){var n={node:e};for(var r in cssShow)n[r]=e.style[r],e.style[r]=cssShow[r];t.push(n)}var i=e.parentNode;i&&i.nodeType===1&&showHidden(i,t)}}function getValType(e){var t=e.tagName.toLowerCase();return t==="input"&&/checkbox|radio/.test(e.type)?"checked":t}function isVML(e){var t=e.nodeName;return t.toLowerCase()===t&&e.scopeName&&e.outerText===""}function fixVML(e){e.currentStyle.behavior!=="url(#default#VML)"&&(e.style.behavior="url(#default#VML)",e.style.display="inline-block",e.style.zoom=1)}function registerSubscriber(e){Registry[expose]=e,avalon.openComputedCollect=!0;var t=e.evaluator;if(t)try{var n=ronduplex.test(e.type)?e:t.apply(0,e.args);e.handler(n,e.element,e)}catch(r){log("warning:exception throwed in [registerSubscriber] "+r),delete e.evaluator;var i=e.element;if(i.nodeType===3){var s=i.parentNode;kernel.commentInterpolate?s.replaceChild(DOC.createComment(e.value),i):i.data=openTag+e.value+closeTag}}avalon.openComputedCollect=!1,delete Registry[expose]}function collectSubscribers(e){var t=Registry[expose];e&&t&&avalon.Array.ensure(e,t)&&t.element&&addSubscribers(t,e)}function addSubscribers(e,t){e.$uuid=e.$uuid||generateID(),t.$uuid=t.$uuid||generateID();var n={data:e,list:t,toString:function(){return e.$uuid+" "+t.$uuid}};$$subscribers[n]||($$subscribers[n]=1,$$subscribers.push(n))}function removeSubscribers(){for(var e=$startIndex,t=$startIndex+$maxIndex;e<t;e++){var n=$$subscribers[e];if(!n)break;var r=n.data,i=r.element,s=i===null?1:i.nodeType===1?typeof i.sourceIndex=="number"?i.sourceIndex===0:!root.contains(i):!avalon.contains(root,i);if(s){$$subscribers.splice(e,1),delete $$subscribers[n],avalon.Array.remove(n.list,r),r.type==="if"&&r.template&&r.template.parentNode===ifGroup&&ifGroup.removeChild(r.template);for(var o in r)r[o]=null;n.data=n.list=null,e--,t--}}n=$$subscribers[e],n?$startIndex=t:$startIndex=0}function notifySubscribers(e){var t=new Date;clearTimeout(removeID),t-beginTime>333?(removeSubscribers(),beginTime=new Date):removeID=setTimeout(removeSubscribers,333);if(e&&e.length){var n=aslice.call(arguments,1);for(var r=e.length,i;i=e[--r];){var s=i.element;if(i.$repeat)i.handler.apply(i,n);else if(i.element&&i.type!=="on"){var o=i.evaluator||noop;i.handler(o.apply(0,i.args||[]),s,i)}}}}function checkScan(e,t){var n=NaN,r=setInterval(function(){var i=e.innerHTML;i===n?(clearInterval(r),t()):n=i},interval)}function scanTag(e,t,n){var r=e.getAttribute("ms-skip");if(!e.getAttributeNode)return log("warning "+e.tagName+" no getAttributeNode method");var i=e.getAttributeNode("ms-important"),s=e.getAttributeNode("ms-controller");if(typeof r=="string")return;if(n=i||s){var o=VMODELS[n.value];if(!o)return;t=n===i?[o]:[o].concat(t);var u=n.name;e.removeAttribute(u),e.setAttribute("avalonctrl",n.value),o.$events.expr=e.tagName+'[avalonctrl="'+n.value+'"]',avalon(e).removeClass(u)}scanAttr(e,t)}function scanNodeList(e,t){var n=e.firstChild;while(n){var r=n.nextSibling;scanNode(n,n.nodeType,t),n=r}}function scanNodeArray(e,t){for(var n=0,r;r=e[n++];)scanNode(r,r.nodeType,t)}function scanNode(e,t,n){t===1?scanTag(e,n):t===3&&rexpr.test(e.data)?scanText(e,n):kernel.commentInterpolate&&t===8&&!rexpr.test(e.nodeValue)&&scanText(e,n)}function scanText(e,t){var n=[];if(e.nodeType===8){var r=[],i=trimFilter(e.nodeValue,r),s={expr:!0,value:i};r.length&&(s.filters=r);var o=[s]}else o=scanExpr(e.data);if(o.length){for(var u=0,s;s=o[u++];){var a=DOC.createTextNode(s.value);if(s.expr){var f=s.filters,l={type:"text",element:a,value:s.value,filters:f};f&&f.indexOf("html")!==-1&&(avalon.Array.remove(f,"html"),l.type="html",l.group=1,f.length||delete n.filters),n.push(l)}hyperspace.appendChild(a)}e.parentNode.replaceChild(hyperspace,e),n.length&&executeBindings(n,t)}}function bindingSorter(e,t){return e.priority-t.priority}function scanAttr(e,t){var n=getAttributes?getAttributes(e):avalon.slice(e.attributes),r=[],i={},s;for(var o=0,u;u=n[o++];)if(u.specified)if(s=u.name.match(rmsAttr)){var a=s[1],f=s[2]||"",l=u.value,c=u.name;i[c]=l;if(events[a])f=a,a="on";else if(a==="checked"||a==="selected"||a==="disabled"||a==="readonly")log("ms-"+a+"已经被废弃,请使用ms-attr-*代替"),a==="enabled"&&(a="disabled",l="!("+l+")"),f=a,a="attr",e.removeAttribute(c),c="ms-attr-"+f,e.setAttribute(c,l),s=[c],i[c]=l;if(typeof bindingHandlers[a]=="function"){var h={type:a,param:f,element:e,name:s[0],value:l,priority:a in priorityMap?priorityMap[a]:a.charCodeAt(0)*10+(Number(f)||0)};a==="if"&&f.indexOf("loop")>-1&&(h.priority+=100),t.length&&(r.push(h),a==="widget"&&(e.msData=e.msData||i))}}r.sort(bindingSorter),i["ms-checked"]&&i["ms-duplex"]&&log("warning!一个元素上不能同时定义ms-checked与ms-duplex");var p=r[0]||{};switch(p.type){case"if":case"repeat":case"widget":executeBindings([p],t);break;default:executeBindings(r,t),!stopScan[e.tagName]&&rbind.test(e.innerHTML.replace(rlt,"<").replace(rgt,">"))&&scanNodeList(e,t)}}function executeBindings(e,t){for(var n=0,r;r=e[n++];)r.vmodels=t,bindingHandlers[r.type](r,t),r.evaluator&&r.element&&r.element.nodeType===1&&r.element.removeAttribute(r.name);e.length=0}function trimFilter(e,t){return e.indexOf("|")>0&&(e=e.replace(r11a,"U2hvcnRDaXJjdWl0"),e=e.replace(rfilters,function(e,n,r){return t.push(n+(r||"")),""}),e=e.replace(r11b,"||")),e}function scanExpr(e){var t=[],n,r=0,i;do{i=e.indexOf(openTag,r);if(i===-1)break;n=e.slice(r,i),n&&t.push({value:n,expr:!1}),r=i+openTag.length,i=e.indexOf(closeTag,r);if(i===-1)break;n=e.slice(r,i);if(n){var s=[];n=trimFilter(n,s),t.push({value:n,expr:!0,filters:s.length?s:void 0})}r=i+closeTag.length}while(1);return n=e.slice(r),n&&t.push({value:n,expr:!1}),t}function addAssign(e,t,n,r){var i=[],s=" = "+n+".";for(var o=e.length,u;u=e[--o];)t.hasOwnProperty(u)&&(i.push(u+s+u),r.type==="duplex"&&(e.get=n+"."+u),e.splice(o,1));return i}function uniqSet(e){var t=[],n={};for(var r=0;r<e.length;r++){var i=e[r],s=i&&typeof i.$id=="string"?i.$id:i;n[s]||(n[s]=t.push(i))}return t}function createCache(e){function n(r,i){return t.push(r)>e&&delete n[t.shift()],n[r]=i}var t=[];return n}function parseExpr(e,t,n){var r=n.type,i=n.filters?n.filters.join(""):"",s=t.map(function(e){return e.$id.replace(rproxy,"$1")})+e+r+i,o=getVariables(e).concat(),u=[],a=[],f=[],l="";t=uniqSet(t);for(var c=0,h=t.length;c<h;c++)if(o.length){var p="vm"+expose+"_"+c;a.push(p),f.push(t[c]),u.push.apply(u,addAssign(o,t[c],p,n))}if(!u.length&&r==="duplex")return;i&&f.push(avalon.filters),n.args=f;var d=cacheExprs[s];if(d){n.evaluator=d;return}var l=u.join(", ");l&&(l="var "+l);if(i){e="\nvar ret"+expose+" = "+e;var v=[],m;v.push(e,"\r\n");for(var c=0,g;g=n.filters[c++];){var y=g.indexOf("(");y!==-1?(m=g.slice(y+1,g.lastIndexOf(")")).trim(),m=","+m,g=g.slice(0,y).trim()):m="",v.push(" if(filters",expose,".",g,"){\n	try{\nret",expose," = filters",expose,".",g,"(ret",expose,m,")\n	}catch(e){} \n}\n")}e=v.join(""),e+="\nreturn ret"+expose,a.push("filters"+expose)}else{if(r==="duplex"){var b="'use strict';\nreturn function(vvv){\n	"+l+";\n	if(!arguments.length){\n		return "+e+"\n	}\n	"+(rduplex.test(e)?e:o.get)+"= vvv;\n} ";try{d=Function.apply(noop,a.concat(b)),n.evaluator=cacheExprs(s,d)}catch(w){log("debug: parse error,"+w.message)}return}if(r==="on"){e.indexOf("(")===-1?e+=".call(this, $event)":e=e.replace("(",".call(this,"),a.push("$event"),e="\nreturn "+e+";";var E=e.lastIndexOf("\nreturn"),S=e.slice(0,E),x=e.slice(E);e=S+"\n"+x}else e="\nreturn "+e+";"}try{d=Function.apply(noop,a.concat("'use strict';\n"+l+e)),n.evaluator=cacheExprs(s,d)}catch(w){log("debug: parse error,"+w.message)}finally{o=v=a=null}}function parseExprProxy(e,t,n,r){Array.isArray(r)&&(e=r.map(function(e){return e.expr?"("+e.value+")":quote(e.value)}).join(" + ")),parseExpr(e,t,n),n.evaluator&&(n.handler=bindingExecutors[n.handlerName||n.type],n.evaluator.toString=function(){return n.type+" binding to eval("+e+")"},registerSubscriber(n))}function parseDisplay(e,t){var n="_"+e;if(!parseDisplay[n]){var r=DOC.createElement(e);root.appendChild(r),W3C?t=getComputedStyle(r,null).display:t=r.currentStyle.display,root.removeChild(r),parseDisplay[n]=t}return parseDisplay[n]}function fixNull(e){return e==null?"":e}function pipe(e,t,n){return t.param.replace(rword,function(r){var i=avalon.duplexHooks[r];i&&typeof i[n]=="function"&&(e=i[n](e,t))}),e}function W3CFire(e,t,n){var r=DOC.createEvent("Events");r.initEvent(t,!0,!0),n&&(r.detail=n),e.dispatchEvent(r)}function onTree(){!this.disabled&&this.oldValue!==this.value&&(W3C?W3CFire(this,"input"):this.fireEvent("onchange"))}function ticker(){for(var e=ribbon.length-1;e>=0;e--){var t=ribbon[e];t()===!1&&ribbon.splice(e,1)}ribbon.length||clearInterval(TimerID)}function newSetter(e){oldSetter.call(this,e),e!==this.oldValue&&W3CFire(this,"input")}function fixEvent(e){var t={};for(var n in e)t[n]=e[n];var r=t.target=e.srcElement;if(e.type.indexOf("key")===0)t.which=e.charCode!=null?e.charCode:e.keyCode;else if(/mouse|click/.test(e.type)){var i=r.ownerDocument||DOC,s=i.compatMode==="BackCompat"?i.body:i.documentElement;t.pageX=e.clientX+(s.scrollLeft>>0)-(s.clientLeft>>0),t.pageY=e.clientY+(s.scrollTop>>0)-(s.clientTop>>0),t.wheelDeltaY=t.wheelDelta,t.wheelDeltaX=0}return t.timeStamp=new Date-0,t.originalEvent=e,t.preventDefault=function(){e.returnValue=!1},t.stopPropagation=function(){e.cancelBubble=!0},t}function Collection(e){var t=[];t.$id=generateID(),t.$model=e,t.$events={},t.$events[subscribers]=[],t._=modelFactory({length:e.length}),t._.$watch("length",function(e,n){t.$fire("length",e,n)});for(var n in EventManager)t[n]=EventManager[n];return avalon.mix(t,CollectionPrototype),t}function convert(e,t){return rcomplexType.test(avalon.type(e))&&(e=e.$id?e:modelFactory(e,0,t)),e}function shimController(e,t,n,r){var i=avalon.parseHTML(e.template),s=avalon.slice(i.childNodes);t.appendChild(i),n.$outer=e.$outer;var o={nodes:s,vmodels:[n].concat(e.vmodels)};r.push(o)}function locateFragment(e,t){var n=e.element,r=e.endRepeat,i=[],s=n.nextSibling;if(s!==r)do{if(s===r)break;i.push(s)}while(s=s.nextSibling);return i[e.group*t]||r}function removeFragment(e,t,n){var r=t*(n||1),i=[e],s=1,o=hyperspace;while(s<r)e=e.nextSibling,e&&(i[s++]=e);for(var s=0;e=i[s++];)o.appendChild(e);return o}function calculateFragmentGroup(e){if(!isFinite(e.group)){var t=e.element.parentNode.childNodes,n=t.length-2,r="proxySize"in e?e.proxySize:e.proxies.length;e.group=n/r}}function createWithProxy(e,t,n){var r=modelFactory({$key:e,$outer:n,$val:t},{$val:1,$key:1});return r.$id=("$proxy$with"+Math.random()).replace(/0\./,""),r}function getEachProxy(e,t,n,r){var i=n.param||"el",s,o={$remove:function(){return n.$repeat.removeAt(s.$index)},$itemName:i,$index:e,$outer:n.$outer,$first:e===0,$last:e===r};o[i]=t;for(var u=0,a=eachProxyPool.length;u<a;u++){var s=eachProxyPool[u];if(s.hasOwnProperty(i)){for(var f in o)s[f]=o[f];return eachProxyPool.splice(u,1),s}}return rcomplexType.test(avalon.type(t))&&(o.$skipArray=[i]),s=modelFactory(o,watchEachOne),s.$watch(i,function(e){n.$repeat.set(s.$index,e)}),s.$id=("$proxy$"+n.type+Math.random()).replace(/0\./,""),s}function recycleEachProxies(e){for(var t=0,n;n=e[t++];)recycleEachProxy(n);e.length=0}function recycleEachProxy(e){for(var t in e.$events)Array.isArray(e.$events[t])&&(e.$events[t].length=0);eachProxyPool.unshift(e)>kernel.maxRepeatSize&&eachProxyPool.pop()}var expose=new Date-0,subscribers="$"+expose,window=this||(0,eval)("this"),otherRequire=window.require,otherDefine=window.define,stopRepeatAssign=!1,rword=/[^, ]+/g,rnative=/\[native code\]/,rcomplexType=/^(?:object|array)$/,rsvg=/^\[object SVG\w*Element\]$/,rwindow=/^\[object (?:Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,Registry={},W3C=window.dispatchEvent,root=DOC.documentElement,head=DOC.getElementsByTagName("head")[0],hyperspace=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(e){class2type["[object "+e+"]"]=e.toLowerCase()}),avalon=function(e){return new avalon.init(e)},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[serialize.call(e)]||"object":typeof e};var isFunction=typeof alert=="object"?function(e){try{return/^\s*\bfunction\b/.test(e+"")}catch(t){return!1}}:function(e){return serialize.call(e)=="[object Function]"};avalon.isFunction=isFunction,avalon.isWindow=function(e){return e?e==e.document&&e.document!=e:!1},isWindow(window)&&(avalon.isWindow=isWindow);var enu;for(enu in avalon({}))break;var enumerateBUG=enu!=="0";avalon.isPlainObject=function(e,t){if(!e||avalon.type(e)!=="object"||e.nodeType||avalon.isWindow(e))return!1;try{if(e.constructor&&!ohasOwn.call(e,"constructor")&&!ohasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(enumerateBUG)for(t in e)return ohasOwn.call(e,t);for(t in e);return t===void 0||ohasOwn.call(e,t)},rnative.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(e){return!!e&&typeof e=="object"&&Object.getPrototypeOf(e)===oproto}),avalon.mix=avalon.fn.mix=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u++),typeof o!="object"&&avalon.type(o)!=="function"&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t];try{r=e[t]}catch(l){continue}if(o===r)continue;f&&r&&(avalon.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,s=n&&Array.isArray(n)?n:[]):s=n&&avalon.isPlainObject(n)?n:{},o[t]=avalon.mix(f,s,r)):r!==void 0&&(o[t]=r)}return o},avalon.mix({rword:rword,subscribers:subscribers,version:1.36,ui:{},log:log,slice:W3C?function(e,t,n){return aslice.call(e,t,n)}:function(e,t,n){var r=[],i=e.length;n===void 0&&(n=i);if(typeof n=="number"&&isFinite(n)){t=_number(t,i),n=_number(n,i);for(var s=t;s<n;++s)r[s-t]=e[s]}return r},noop:noop,error:function(e,t){throw new(t||Error)(e)},oneObject:oneObject,range:function(e,t,n){n||(n=1),t==null&&(t=e||0,e=0);var r=-1,i=Math.max(0,Math.ceil((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s},eventHooks:{},bind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t];typeof s=="object"&&(t=s.type,s.deel&&(n=s.deel(e,n)));var o=W3C?n:function(t){n.call(e,fixEvent(t))};return W3C?e.addEventListener(t,o,!!r):e.attachEvent("on"+t,o),o},unbind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t],o=n||noop;typeof s=="object"&&(t=s.type),W3C?e.removeEventListener(t,o,!!r):e.detachEvent("on"+t,o)},css:function(e,t,n){e instanceof avalon&&(e=e[0]);var r=/[_-]/.test(t)?camelize(t):t;t=avalon.cssName(r)||r;if(n===void 0||typeof n=="boolean"){var i=cssHooks[r+":get"]||cssHooks["@:get"],s=i(e,t);return n===!0?parseFloat(s)||0:s}if(n==="")e.style[t]="";else{if(n==null||n!==n)return;isFinite(n)&&!avalon.cssNumber[r]&&(n+="px"),i=cssHooks[r+":set"]||cssHooks["@:set"],i(e,t,n)}},each:function(e,t){if(e){var n=0;if(isArrayLike(e))for(var r=e.length;n<r;n++)t(n,e[n]);else for(n in e)e.hasOwnProperty(n)&&t(n,e[n])}},getWidgetData:function(e,t){var n=avalon(e).data(),r={};for(var i in n)i.indexOf(t)===0&&(r[i.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=n[i]);return r},Array:{ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return~n?avalon.Array.removeAt(e,n):!1}}}),avalon.nextTick=window.setImmediate?setImmediate.bind(window):function(e){setTimeout(e,0)};var VMODELS=avalon.vmodels={};avalon.define=function(e,t){var n=e.$id||e;n||log("warning: vm必须指定$id"),VMODELS[n]&&log("warning: "+n+" 已经存在于avalon.vmodels中");if(typeof e=="object")var r=modelFactory(e);else{var i={$watch:noop};t(i),r=modelFactory(i),stopRepeatAssign=!0,t(r),stopRepeatAssign=!1}return r.$id=n,VMODELS[n]=r};var $$skipArray=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray").match(rword),isEqual=Object.is||function(e,t){return e===0&&t===0?1/e===1/t:e!==e?t!==t:e===t},descriptorFactory=W3C?function(e){var t={};for(var n in e)t[n]={get:e[n],set:e[n],enumerable:!0,configurable:!0};return t}:function(e){return e},withProxyPool={},withProxyCount=0,rebindings={},defineProperty=Object.defineProperty;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){"__defineGetter__"in avalon&&(defineProperty=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},defineProperties=function(e,t){for(var n in t)t.hasOwnProperty(n)&&defineProperty(e,n,t[n]);return e})}if(!defineProperties&&window.VBArray){window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function","Dim VBClassBodies",'Set VBClassBodies=CreateObject("Scripting.Dictionary")',"Function findOrDefineVBClass(name,body)","	Dim found",'	found=""',"	For Each key in VBClassBodies","		If body=VBClassBodies.Item(key) Then","			found=key","			Exit For","		End If","	next",'	If found="" Then','		parseVB("Class " + name + body)',"		VBClassBodies.Add name, body","		found=name","	End If","	findOrDefineVBClass=found","End Function"].join("\n"),"VBScript");function VBMediator(e,t,n){var r=e[t];if(typeof r=="function"){if(arguments.length!==3)return r();r(n)}}defineProperties=function(e,t,n){var r="VBClass"+setTimeout("1"),i=[];i.push("\r\n	Private [__data__], [__proxy__]","	Public Default Function [__const__](d, p)","		Set [__data__] = d: set [__proxy__] = p","		Set [__const__] = Me","	End Function");for(e in n)t.hasOwnProperty(e)||i.push("	Public ["+e+"]");$$skipArray.forEach(function(e){t.hasOwnProperty(e)||i.push("	Public ["+e+"]")}),i.push("	Public [hasOwnProperty]");for(e in t)i.push("	Public Property Let ["+e+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Set ["+e+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Get ["+e+"]","	On Error Resume Next","		Set["+e+'] = [__proxy__]([__data__],"'+e+'")',"	If Err.Number <> 0 Then","		["+e+'] = [__proxy__]([__data__],"'+e+'")',"	End If","	On Error Goto 0","	End Property");i.push("End Class");var s=i.join("\r\n"),o=window.findOrDefineVBClass(r,s);o===r&&window.parseVB(["Function "+r+"Factory(a, b)","	Dim o","	Set o = (New "+r+")(a, b)","	Set "+r+"Factory = o","End Function"].join("\r\n"));var u=window[o+"Factory"](t,VBMediator);return u}}if(!"司徒正美".trim){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}}var hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;Object.keys||(Object.keys=function(e){var t=[],n=hasProtoEnumBug&&typeof e=="function";if(typeof e=="string"||e&&e.callee)for(var r=0;r<e.length;++r)t.push(String(r));else for(var i in e)(!n||i!=="prototype")&&ohasOwn.call(e,i)&&t.push(String(i));if(hasDontEnumBug){var s=e.constructor,o=s&&s.prototype===e;for(var u=0;u<dontEnumsLength;u++){var a=dontEnums[u];(!o||a!=="constructor")&&ohasOwn.call(e,a)&&t.push(a)}}return t}),Array.isArray||(Array.isArray=function(e){return serialize.call(e)==="[object Array]"}),noop.bind||(Function.prototype.bind=function(e){if(arguments.length<2&&e===void 0)return this;var t=this,n=arguments;return function(){var r=[],i;for(i=1;i<n.length;i++)r.push(n[i]);for(i=0;i<arguments.length;i++)r.push(arguments[i]);return t.apply(e,r)}}),rnative.test([].map)||avalon.mix(ap,{indexOf:function(e,t){var n=this.length,r=~~t;r<0&&(r+=n);for(;r<n;r++)if(this[r]===e)return r;return-1},lastIndexOf:function(e,t){var n=this.length,r=t==null?n-1:t;r<0&&(r=Math.max(0,n+r));for(;r>=0;r--)if(this[r]===e)return r;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),root.contains||(Node.prototype.contains=function(e){return!!(this.compareDocumentPosition(e)&16)}),DOC.contains||(DOC.contains=function(e){return fixContains(DOC,e)});if(window.SVGElement){var svgns="http://www.w3.org/2000/svg",svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />';if(!rsvg.test(svg.firstChild)){function enumerateNode(e,t){if(e&&e.childNodes){var n=e.childNodes;for(var r=0,i;i=n[r++];)if(i.tagName){var s=DOC.createElementNS(svgns,i.tagName.toLowerCase());ap.forEach.call(i.attributes,function(e){s.setAttribute(e.name,e.value)}),enumerateNode(i,s),t.appendChild(s)}}}Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:outerHTML,set:function(e){var t=this.tagName.toLowerCase(),n=this.parentNode,r=avalon.parseHTML(e);if(t==="svg")n.insertBefore(r,this);else{var i=DOC.createDocumentFragment();enumerateNode(r,i),n.insertBefore(i,this)}n.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){if(avalon.clearHTM){avalon.clearHTML(this);var t=avalon.parseHTML(e);enumerateNode(t,this)}}}})}}!root.outerHTML&&window.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML);var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,innerRequire=noop,plugins={loader:function(e){window.define=e?innerRequire.define:otherDefine,window.require=e?innerRequire:otherRequire},interpolate:function(e){openTag=e[0],closeTag=e[1];if(openTag===closeTag)throw new SyntaxError("openTag!==closeTag");if(e+""=="<!--,-->")kernel.commentInterpolate=!0;else{var t=openTag+"test"+closeTag;cinerator.innerHTML=t;if(cinerator.innerHTML!==t&&cinerator.innerHTML.indexOf("&lt;")>=0)throw new SyntaxError("此定界符不合法");cinerator.innerHTML=""}var n=escapeRegExp(openTag),r=escapeRegExp(closeTag);rexpr=new RegExp(n+"(.*?)"+r),rexprg=new RegExp(n+"(.*?)"+r,"g"),rbind=new RegExp(n+".*?"+r+"|\\sms-")}};kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var ClassListMethods={_toString:function(){var e=this.node,t=e.className,n=typeof t=="string"?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," ").trim())},__set:function(e){var t=this.node;typeof t.className=="string"?t.className=e:t.setAttribute("class",e)}};"add,remove".replace(rword,function(e){avalon.fn[e+"Class"]=function(t){var n=this[0];return t&&typeof t=="string"&&n&&n.nodeType===1&&t.replace(/\S+/g,function(t){ClassList(n)[e](t)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return t.nodeType===1&&ClassList(t).contains(e)},toggleClass:function(e,t){var n,r=0,i=e.split(/\s+/),s=typeof t=="boolean";while(n=i[r++]){var o=s?t:!this.hasClass(n);this[o?"addClass":"removeClass"](n)}return this},attr:function(e,t){return arguments.length===2?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){e="data-"+hyphen(e||"");switch(arguments.length){case 2:return this.attr(e,t),this;case 1:var n=this.attr(e);return parseData(n);case 0:var r={};return ap.forEach.call(this[0].attributes,function(t){t&&(e=t.name,e.indexOf("data-")||(e=camelize(e.slice(5)),r[e]=parseData(t.value)))}),r}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var r=avalon.css(this,e,t);return r!==void 0?r:this},position:function(){var e,t,n=this[0],r={top:0,left:0};if(!n)return;return this.css("position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),e[0].tagName!=="HTML"&&(r=e.offset()),r.top+=avalon.css(e[0],"borderTopWidth",!0),r.left+=avalon.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-avalon.css(n,"marginTop",!0),left:t.left-r.left-avalon.css(n,"marginLeft",!0)}},offsetParent:function(){var e=this[0].offsetParent||root;while(e&&e.tagName!=="HTML"&&avalon.css(e,"position")==="static")e=e.offsetParent;return avalon(e||root)},bind:function(e,t,n){if(this[0])return avalon.bind(this[0],e,t,n)},unbind:function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},val:function(e){var t=this[0];if(t&&t.nodeType===1){var n=arguments.length===0,r=n?":get":":set",i=valHooks[getValType(t)+r];if(i)var s=i(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?s:this}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=window.JSON?JSON.parse:function(e){if(typeof e=="string"){e=e.trim();if(e&&rvalidchars.test(e.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return(new Function("return "+e))();avalon.error("Invalid JSON: "+e)}},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(n){var r=this[0]||{},i=getWindow(r),s=e==="scrollTop";if(!arguments.length)return i?t in i?i[t]:root[e]:r[e];i?i.scrollTo(s?avalon(i).scrollLeft():n,s?n:avalon(i).scrollTop()):r[e]=n}});var cssHooks=avalon.cssHooks={},prefixes=["","-webkit-","-o-","-moz-","-ms-"],cssMap={"float":"cssFloat",background:"backgroundColor"};avalon.cssNumber=oneObject("columnCount,order,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,n){if(cssMap[e])return cssMap[e];t=t||root.style;for(var r=0,i=prefixes.length;r<i;r++){n=camelize(prefixes[r]+e);if(n in t)return cssMap[e]=n}return null},cssHooks["@:set"]=function(e,t,n){try{e.style[t]=n}catch(r){}};if(window.getComputedStyle)cssHooks["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e,null);return r&&(n=t==="filter"?r.getPropertyValue(t):r[t],n===""&&(n=e.style[t])),n},cssHooks["opacity:get"]=function(e){var t=cssHooks["@:get"](e,"opacity");return t===""?"1":t};else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rposition=/^(top|right|bottom|left)$/,ralpha=/alpha\([^)]*\)/i,ie8=!!window.XDomainRequest,salpha="DXImageTransform.Microsoft.Alpha",border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(e,t){var n=e.currentStyle,r=n[t];if(rnumnonpx.test(r)&&!rposition.test(r)){var i=e.style,s=i.left,o=e.runtimeStyle.left;e.runtimeStyle.left=n.left,i.left=t==="fontSize"?"1em":r||0,r=i.pixelLeft+"px",i.left=s,e.runtimeStyle.left=o}return r==="medium"&&(t=t.replace("Width","Style"),n[t]==="none"&&(r="0px")),r===""?"auto":border[r]||r},cssHooks["opacity:set"]=function(e,t,n){var r=e.style,i=isFinite(n)&&n<=1?"alpha(opacity="+n*100+")":"",s=r.filter||"";r.zoom=1,r.filter=(ralpha.test(s)?s.replace(ralpha,i):s+" "+i).trim(),r.filter||r.removeAttribute("filter")},cssHooks["opacity:get"]=function(e){var t=e.filters.alpha||e.filters[salpha],n=t&&t.enabled?t.opacity:100;return n/100+""}}"top,left".replace(rword,function(e){cssHooks[e+":get"]=function(t){var n=cssHooks["@:get"](t,e);return/px$/.test(n)?n:avalon(t).position()[e]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(e){var t=e.toLowerCase(),n="client"+e,r="scroll"+e,i="offset"+e;cssHooks[t+":get"]=function(t,n,r){var s=-4;typeof r=="number"&&(s=r),n=e==="Width"?["Left","Right"]:["Top","Bottom"];var o=t[i];return s===2?o+avalon.css(t,"margin"+n[0],!0)+avalon.css(t,"margin"+n[1],!0):(s<0&&(o=o-avalon.css(t,"border"+n[0]+"Width",!0)-avalon.css(t,"border"+n[1]+"Width",!0)),s===-4&&(o=o-avalon.css(t,"padding"+n[0],!0)-avalon.css(t,"padding"+n[1],!0)),o)},cssHooks[t+"&get"]=function(e){var n=[];showHidden(e,n);var r=cssHooks[t+":get"](e);for(var i=0,s;s=n[i++];){e=s.node;for(var o in s)typeof s[o]=="string"&&(e.style[o]=s[o])}return r},avalon.fn[t]=function(s){var o=this[0];if(arguments.length===0){if(o.setTimeout)return o["inner"+e]||o.document.documentElement[n];if(o.nodeType===9){var u=o.documentElement;return Math.max(o.body[r],u[r],o.body[i],u[i],u[n])}return cssHooks[t+"&get"](o)}return this.css(t,s)},avalon.fn["inner"+e]=function(){return cssHooks[t+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return cssHooks[t+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0],t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,r=n.body,i=n.documentElement,s=n.defaultView||n.parentWindow;if(!avalon.contains(i,e))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var o=i.clientTop||r.clientTop,u=i.clientLeft||r.clientLeft,a=Math.max(s.pageYOffset||0,i.scrollTop,r.scrollTop),f=Math.max(s.pageXOffset||0,i.scrollLeft,r.scrollLeft);return{top:t.top+a-o,left:t.left+f-u}};var roption=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,valHooks={"option:get":window.VBArray?function(e){return roption.test(e.outerHTML)?e.value:e.text.trim()}:function(e){return e.value},"select:get":function(e,t){var n,r=e.options,i=e.selectedIndex,s=valHooks["option:get"],o=e.type==="select-one"||i<0,u=o?null:[],a=o?i+1:r.length,f=i<0?a:o?i:0;for(;f<a;f++){n=r[f];if((n.selected||f===i)&&!n.disabled){t=s(n);if(o)return t;u.push(t)}}return u},"select:set":function(e,t,n){t=[].concat(t);var r=valHooks["option:get"];for(var i=0,s;s=e.options[i++];)if(s.selected=t.indexOf(r(s))>=0)n=!0;n||(e.selectedIndex=-1)}},rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/ig,scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,tagHooks={area:[1,"<map>"],param:[1,"<object>"],col:[2,"<table><tbody></tbody><colgroup>","</table>"],legend:[1,"<fieldset>"],option:[1,"<select multiple='multiple'>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>"],td:[3,"<table><tbody><tr>"],text:[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"],_default:W3C?[0,""]:[1,"X<div>"]};tagHooks.optgroup=tagHooks.option,tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead,tagHooks.th=tagHooks.td,"g,circle,ellipse,line,path,polygon,polyline,text".replace(rword,function(e){tagHooks[e]=tagHooks.text});var script=DOC.createElement("script");avalon.parseHTML=function(e){typeof e!="string"&&(e+=""),e=e.replace(rxhtml,"<$1></$2>").trim();var t=(rtagName.exec(e)||["",""])[1].toLowerCase(),n=tagHooks[t]||tagHooks._default,r=hyperspace.cloneNode(!1),i=cinerator,s,o;W3C||(e=e.replace(rcreate,"<br class=msNoScope>$1")),i.innerHTML=n[1]+e+(n[2]||"");var u=i.getElementsByTagName("script");if(u.length)for(var a=0,f;f=u[a++];){var l=f.parentNode,c=f.nextSibling,h=f.text;l.removeChild(f),!window.VBArray&&scriptTypes[f.type]&&(o=script.cloneNode(!1),ap.forEach.call(f.attributes,function(e){o.setAttribute(e.name,e.value)}),f=o),f.text=h,l.insertBefore(f,c)}for(a=n[0];a--;i=i.lastChild);if(!W3C){for(u=i.getElementsByTagName("br"),a=0;f=u[a++];)f.className&&f.className==="msNoScope"&&f.parentNode.removeChild(f);for(u=i.all,a=0;f=u[a++];)isVML(f)&&fixVML(f)}while(s=i.firstChild)r.appendChild(s);return r},avalon.innerHTML=function(e,t){if(!W3C&&!rcreate.test(t)&&!rnest.test(t))try{e.innerHTML=t;return}catch(n){}var r=this.parseHTML(t);this.clearHTML(e).appendChild(r)},avalon.clearHTML=function(e){e.textContent="";while(e.firstChild)e.removeChild(e.firstChild);return e};var EventManager={$watch:function(e,t){if(typeof t=="function"){var n=this.$events[e];n?n.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var n=arguments.length;if(n===0)this.$watch.backup=this.$events,this.$events={};else if(n===1)this.$events[e]=[];else{var r=this.$events[e]||[],i=r.length;while(~--i<0)if(r[i]===t)return r.splice(i,1)}return this},$fire:function(e){var t;/^(\w+)!(\S+)$/.test(e)&&(t=RegExp.$1,e=RegExp.$2);var n=this.$events,r=aslice.call(arguments,1),i=t==="up"||t==="down"||t==="all";if(!i){var s=n[e]||[],o=n.$all||[];for(var u=0,a;a=s[u++];)isFunction(a)&&a.apply(this,r);for(var u=0,a;a=o[u++];)isFunction(a)&&a.apply(this,arguments)}else{var f=n.expr&&findNode(n.expr);if(!f)return;var l=[e].concat(r);for(var u in avalon.vmodels){var c=avalon.vmodels[u];if(c&&c.$events&&c.$events.expr&&c!==this){var h=findNode(c.$events.expr);if(!h)continue;var p=t==="all"?1:t==="down"?f.contains(h):h.contains(f);p&&(h._avalon=c)}}var d=DOC.getElementsByTagName("*"),v=[];Array.prototype.forEach.call(d,function(e){e._avalon&&(v.push(e._avalon),e._avalon="",e.removeAttribute("_avalon"))}),t==="up"&&v.reverse(),v.forEach(function(e){e.$fire.apply(e,l)})}}},ravalon=/(\w+)\[(avalonctrl)="(\S+)"\]/,findNode=DOC.querySelector?function(e){return DOC.querySelector(e)}:function(e){var t=e.match(ravalon),n=DOC.getElementsByTagName(t[1]);for(var r=0,i;i=n[r++];)if(i.getAttribute(t[2])===t[3])return i},ronduplex=/^(duplex|on)$/,$$subscribers=[],$startIndex=0,$maxIndex=200,beginTime=new Date,removeID;avalon.scan=function(e,t){e=e||root;var n=t?[].concat(t):[];scanTag(e,n)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),interval=W3C?30:50,rmsAttr=/ms-(\w+)-?(.*)/,priorityMap={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit");if(!"1"[0])var cacheAttrs=createCache(512),rattrs=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,rquote=/^['"]/,rtag=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,ramp=/&amp;/g,getAttributes=function(e){var t=e.outerHTML;if(t.slice(0,2)==="</"||!t.trim())return[];var n=t.match(rtag)[0],r=[],i,s,o;if(cacheAttrs[n])return cacheAttrs[n];while(s=rattrs.exec(n)){o=s[2],o&&(o=(rquote.test(o)?o.slice(1,-1):o).replace(ramp,"&"));var u=s[1].toLowerCase();i=u.match(rmsAttr);var a={name:u,specified:!0,value:o||""};r.push(a)}return cacheAttrs(n,r)};var rfilters=/\|\s*(\w+)\s*(\([^)]*\))?/g,r11a=/\|\|/g,r11b=/U2hvcnRDaXJjdWl0/g,rlt=/&lt;/g,rgt=/&gt;/g,keywords="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,cacheVars=createCache(512),getVariables=function(e){var t=","+e.trim();if(cacheVars[t])return cacheVars[t];var n=e.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/);return cacheVars(t,uniqSet(n))},cacheExprs=createCache(128),rduplex=/\w\[.*\]|\w\.\w/,rproxy=/(\$proxy\$[a-z]+)\d+$/,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},quote=window.JSON&&JSON.stringify||function(e){return'"'+e.replace(/[\\\"\x00-\x1f]/g,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'};avalon.parseExprProxy=parseExprProxy;var propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly="accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan,dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign";anomaly.replace(rword,function(e){propMap[e.toLowerCase()]=e});var ifGroup=head.insertBefore(document.createElement("avalon"),head.firstChild);ifGroup.innerHTML="X<style id='avalonStyle'>.avalonHide{ display: none!important }</style>";var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},getBindingCallback=function(e,t,n){var r=e.getAttribute(t);if(r)for(var i=0,s;s=n[i++];)if(s.hasOwnProperty(r)&&typeof s[r]=="function")return s[r]},cacheTmpls=avalon.templateCache={};avalon.contains=fixContains;var bools="autofocus,autoplay,async,allowTransparency,checked,controls,declare,disabled,defer,defaultChecked,defaultSelectedcontentEditable,isMap,loop,multiple,noHref,noResize,noShade,open,readOnly,selected",boolMap={};bools.replace(rword,function(e){boolMap[e.toLowerCase()]=e});var bindingExecutors=avalon.bindingExecutors={attr:function(e,t,n){var r=n.type,i=n.param;if(r==="css")avalon(t).css(i,e);else if(r==="attr"){if(boolMap[i]){var s=boolMap[i];if(typeof t[s]=="boolean")return t[s]=!!e}var o=e===!1||e===null||e===void 0;if(!W3C&&propMap[i]){i=propMap[i];var u=!0}if(o)return t.removeAttribute(i);if(window.VBArray&&!u)if(isVML(t))u=!0;else if(!rsvg.test(t)){var a=t.attributes||{},f=a[i];u=f?f.expando===!1:f===null}u?t[i]=e:t.setAttribute(i,e)}else if(r==="include"&&e){var l=n.vmodels,c=n.includeRendered,h=n.includeLoaded,p=n.includeReplaced,d=p?t.parentNode:t;function v(e){h&&(e=h.apply(d,[e].concat(l)));for(;;){var t=n.startInclude.nextSibling;if(!t||t===n.endInclude)break;d.removeChild(t)}var r=avalon.parseHTML(e);d.insertBefore(r,n.endInclude),scanNodeList(r,l),c&&checkScan(d,function(){c.call(d)})}if(n.param==="src")if(cacheTmpls[e])avalon.nextTick(function(){v(cacheTmpls[e])});else{var m=getXHR();m.onreadystatechange=function(){if(m.readyState===4){var t=m.status;(t>=200&&t<300||t===304||t===1223)&&v(cacheTmpls[e]=m.responseText)}},m.open("GET",e,!0),"withCredentials"in m&&(m.withCredentials=!0),m.setRequestHeader("X-Requested-With","XMLHttpRequest"),m.send(null)}else{var g=e&&e.nodeType===1?e:DOC.getElementById(e);if(g){if(g.tagName==="NOSCRIPT"&&!g.innerHTML&&!g.fixIE78){var m=getXHR();m.open("GET",location,!1),m.send(null);var y=DOC.getElementsByTagName("noscript"),b=(m.responseText||"").match(rnoscripts)||[],w=b.length;for(var E=0;E<w;E++){var S=y[E];S&&(S.style.display="none",S.fixIE78=(b[E].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){v(g.fixIE78||g.value||g.innerText||g.innerHTML)})}}}else{!root.hasAttribute&&typeof e=="string"&&(r==="src"||r==="href")&&(e=e.replace(/&amp;/g,"&")),t[r]=e;if(window.chrome&&t.tagName==="EMBED"){var x=t.parentNode,T=document.createComment("ms-src");x.replaceChild(T,t),x.replaceChild(t,T)}}},"class":function(e,t,n){var r=avalon(t),i=n.type;if(i==="class"&&n.oldStyle)r.toggleClass(n.oldStyle,!!e);else{n.toggleClass=n._evaluator?!!n._evaluator.apply(t,n._args):!0,n.newClass=n.immobileClass||e,n.oldClass&&n.newClass!==n.oldClass&&r.removeClass(n.oldClass),n.oldClass=n.newClass;switch(i){case"class":r.toggleClass(n.newClass,n.toggleClass);break;case"hover":case"active":if(!n.hasBindEvent){var s="mouseenter",o="mouseleave";i==="active"&&(t.tabIndex=t.tabIndex||-1,s="mousedown",o="mouseup",r.bind("mouseleave",function(){n.toggleClass&&r.removeClass(n.newClass)})),r.bind(s,function(){n.toggleClass&&r.addClass(n.newClass)}),r.bind(o,function(){n.toggleClass&&r.removeClass(n.newClass)}),n.hasBindEvent=!0}}}},data:function(e,t,n){var r="data-"+n.param;e&&typeof e=="object"?t[r]=e:t.setAttribute(r,String(e))},repeat:function(e,t,n){if(e){var r=this,i=r.element.parentNode,s=r.proxies,o=hyperspace.cloneNode(!1);if(e==="del"||e==="move")var u=locateFragment(r,t);var a=r.group;switch(e){case"add":var f=n,l=r.$repeat.length-1,c=[];for(var h=0,p=f.length;h<p;h++){var d=h+t,v=getEachProxy(d,f[h],r,l);s.splice(d,0,v),shimController(r,o,v,c)}u=locateFragment(r,t),i.insertBefore(o,u);for(var h=0,m;m=c[h++];)scanNodeArray(m.nodes,m.vmodels),m.nodes=m.vmodels=null;calculateFragmentGroup(r);break;case"del":var g=s.splice(t,n),o=removeFragment(u,a,n);avalon.clearHTML(o),recycleEachProxies(g);break;case"index":var l=s.length-1;for(;n=s[t];t++)n.$index=t,n.$first=t===0,n.$last=t===l;break;case"clear":for(;;){var y=r.element.nextSibling;if(!y||y===r.endRepeat)break;i.removeChild(y)}recycleEachProxies(s);break;case"move":var b=s.splice(t,1)[0];b&&(s.splice(n,0,b),o=removeFragment(u,a),u=locateFragment(r,n),i.insertBefore(o,u));break;case"set":var v=s[t];v&&(v[v.$itemName]=n);break;case"append":var w=n,E=[],c=[];for(var S in t)t.hasOwnProperty(S)&&S!=="hasOwnProperty"&&E.push(S);if(r.sortedCallback){var x=r.sortedCallback.call(i,E);x&&Array.isArray(x)&&x.length&&(E=x)}for(var h=0,S;S=E[h++];)S!=="hasOwnProperty"&&shimController(r,o,w[S],c);r.proxySize=E.length,i.insertBefore(o,r.element.nextSibling);for(var h=0,m;m=c[h++];)scanNodeArray(m.nodes,m.vmodels),m.nodes=m.vmodels=null;calculateFragmentGroup(r)}var T=r.renderedCallback||noop,N=arguments;checkScan(i,function(){T.apply(i,N),i.oldValue&&i.tagName==="SELECT"&&e==="index"&&avalon(i).val(i.oldValue.split(","))})}},html:function(e,t,n){e=e==null?"":e;var r="group"in n?t.parentNode:t;if("group"in n){var i,s;if(e.nodeType===11)i=e;else if(e.nodeType===1||e.item){s=e.nodeType===1?e.childNodes:e.item?e:[],i=hyperspace.cloneNode(!0);while(s[0])i.appendChild(s[0])}else i=avalon.parseHTML(e);s=avalon.slice(i.childNodes);if(s.length===0){var o=DOC.createComment("ms-html");i.appendChild(o),s=[o]}r.insertBefore(i,t);var u=n.group;while(t){var a=t.nextSibling;r.removeChild(t),u--;if(u===0||a===null)break;t=a}n.element=s[0],n.group=s.length}else avalon.innerHTML(r,e);avalon.nextTick(function(){scanNodeList(r,n.vmodels)})},"if":function(e,t,n){if(e)t.nodeType===8&&(t.parentNode.replaceChild(n.template,t),t=n.element=n.template),t.getAttribute(n.name)&&(t.removeAttribute(n.name),scanAttr(t,n.vmodels));else if(t.nodeType===1){var r=n.element=DOC.createComment("ms-if");t.parentNode.replaceChild(r,t),n.template=t,ifGroup.appendChild(t)}},on:function(e,t,n){n.type="on",e=function(e){var t=n.evaluator||noop;return t.apply(this,n.args.concat(e))};var r=n.param.replace(/-\d+$/,"");if(r==="scan")e.call(t,{type:r});else if(typeof n.specialBind=="function")n.specialBind(t,e);else var i=avalon.bind(t,r,e);n.rollback=function(){typeof n.specialUnbind=="function"?n.specialUnbind():avalon.unbind(t,r,i)}},text:function(e,t){e=e==null?"":e;if(t.nodeType===3)try{t.data=e}catch(n){}else"textContent"in t?t.textContent=e:t.innerText=e},visible:function(e,t,n){t.style.display=e?n.display:"none"},widget:noop},rdash=/\(([^)]*)\)/;avalon.parseDisplay=parseDisplay;var bindingHandlers=avalon.bindingHandlers={attr:function(e,t){var n=e.value.trim(),r=!0;n.indexOf(openTag)>-1&&n.indexOf(closeTag)>2&&(r=!1,rexpr.test(n)&&RegExp.rightContext===""&&RegExp.leftContext===""&&(r=!0,n=RegExp.$1));if(e.type==="include"){var i=e.element;e.includeRendered=getBindingCallback(i,"data-include-rendered",t),e.includeLoaded=getBindingCallback(i,"data-include-loaded",t);var s=e.includeReplaced=!!avalon(i).data("includeReplace");e.startInclude=DOC.createComment("ms-include"),e.endInclude=DOC.createComment("ms-include-end"),s?(e.element=e.startInclude,i.parentNode.insertBefore(e.startInclude,i),i.parentNode.insertBefore(e.endInclude,i.nextSibling)):(i.insertBefore(e.startInclude,i.firstChild),i.appendChild(e.endInclude))}e.handlerName="attr",parseExprProxy(n,t,e,r?null:scanExpr(e.value))},"class":function(e,t){var n=e.param,r=e.value,i;e.handlerName="class";if(!n||isFinite(n)){e.param="";var s=r.replace(rexprg,function(e){return Math.pow(10,e.length-1)}),o=s.indexOf(":");if(o===-1)var u=r;else{u=r.slice(0,o),i=r.slice(o+1),parseExpr(i,t,e);if(!e.evaluator)return log("debug: ms-class '"+(i||"").trim()+"' 不存在于VM中"),!1;e._evaluator=e.evaluator,e._args=e.args}var a=rexpr.test(u);a||(e.immobileClass=u),parseExprProxy("",t,e,a?scanExpr(u):null)}else e.immobileClass=e.oldStyle=e.param,parseExprProxy(r,t,e)},duplex:function(e,t){var n=e.element,r=n.tagName;if(typeof duplexBinding[r]=="function"){e.changed=getBindingCallback(n,"data-duplex-changed",t)||noop,parseExpr(e.value,t,e,"duplex");if(e.evaluator&&e.args){var i=[],s=oneObject("string,number,boolean,checked"),o;e.param.replace(rword,function(t){if(n.type==="radio"&&e.param===""||n.type==="checkbox"&&t==="radio")log(n.type+"控件如果想通过checked属性同步VM,请改用ms-duplex-checked，以后ms-duplex默认是使用value属性同步VM"),t="checked",e.isChecked=!0;t==="bool"?(t="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):t==="text"&&(t="string",log("ms-duplex-text已经更名为ms-duplex-string")),s[t]&&(o=!0),avalon.Array.ensure(i,t)}),o||i.push("string"),e.param=i.join("-"),e.bound=function(t,r){n.addEventListener?n.addEventListener(t,r,!1):n.attachEvent("on"+t,r);var i=e.rollback;e.rollback=function(){avalon.unbind(n,t,r),i&&i()}},pipe(null,e,"init"),duplexBinding[n.tagName](n,e.evaluator.apply(null,e.args),e)}}},repeat:function(e,t){var n=e.type;parseExpr(e.value,t,e),e.proxies=[];var r=!1;try{var i=e.$repeat=e.evaluator.apply(0,e.args||[]),s=avalon.type(i);s!=="object"&&s!=="array"&&(r=!0,avalon.log("warning:"+e.value+"对应类型不正确"))}catch(o){r=!0,avalon.log("warning:"+e.value+"编译出错")}var u=e.element;u.removeAttribute(e.name),e.sortedCallback=getBindingCallback(u,"data-with-sorted",t),e.renderedCallback=getBindingCallback(u,"data-"+n+"-rendered",t);var a=e.element=DOC.createComment("ms-repeat"),f=e.endRepeat=DOC.createComment("ms-repeat-end");hyperspace.appendChild(a),hyperspace.appendChild(f),n==="each"||n==="with"?(e.template=u.innerHTML.trim(),avalon.clearHTML(u).appendChild(hyperspace)):(e.template=u.outerHTML.trim(),u.parentNode.replaceChild(hyperspace,u),e.group=1),e.rollback=function(){bindingExecutors.repeat.call(e,"clear");var t=e.element,n=t.parentNode,r=avalon.parseHTML(e.template),i=r.firstChild;n.replaceChild(r,t),n.removeChild(e.endRepeat),i=e.element=e.type==="repeat"?i:n,e.group=i.setAttribute(e.name,e.value)};var l=e.value.split(".")||[];if(l.length>1){l.pop();var c=l[0];for(var h=0,p;p=t[h++];)if(p&&p.hasOwnProperty(c)){var d=p[c].$events;d[subscribers]=d[subscribers]||[],d[subscribers].push(e);break}}if(r)return;e.handler=bindingExecutors.repeat,e.$outer={};var v="$key",m="$val";Array.isArray(i)&&(v="$first",m="$last");for(var h=0,g;g=t[h++];)if(g.hasOwnProperty(v)&&g.hasOwnProperty(m)){e.$outer=g;break}var y=(i.$events||{})[subscribers];y&&avalon.Array.ensure(y,e)&&addSubscribers(e,y);if(!Array.isArray(i)&&n!=="each"){var b=withProxyPool[i.$id];if(!b){withProxyCount++,b=withProxyPool[i.$id]={};for(var w in i)i.hasOwnProperty(w)&&w!=="hasOwnProperty"&&function(e,t){b[e]=createWithProxy(e,t,{}),b[e].$watch("$val",function(t){i[e]=t})}(w,i[w])}e.handler("append",i,b)}else e.handler("add",0,i)},html:function(e,t){parseExprProxy(e.value,t,e)},on:function(e,t){var n=e.value,r=e.param.replace(/-\d+$/,"");typeof bindingHandlers.on[r+"Hook"]=="function"&&bindingHandlers.on[r+"Hook"](e);if(n.indexOf("(")>0&&n.indexOf(")")>-1){var i=(n.match(rdash)||["",""])[1].trim();if(i===""||i==="$event")n=n.replace(rdash,"")}parseExprProxy(n,t,e)},visible:function(e,t){var n=avalon(e.element),r=n.css("display");if(r==="none"){var i=n[0].style,s=/visibility/i.test(i.cssText),o=n.css("visibility");i.display="",i.visibility="hidden",r=n.css("display"),r==="none"&&(r=parseDisplay(n[0].nodeName)),i.visibility=s?o:""}e.display=r,parseExprProxy(e.value,t,e)},widget:function(e,t){var n=e.value.match(rword),r=e.element,i=n[0];if(n[1]==="$"||!n[1])n[1]=i+setTimeout("1");e.value=n.join(",");var s=avalon.ui[i];if(typeof s=="function"){t=r.vmodels||t;var o=n[2]||i;for(var u=0,a;a=t[u++];)if(a.hasOwnProperty(o)&&typeof a[o]=="object"){var f=a;break}if(f){var l=f[o];l=l.$model||l;var c=l[i+"Id"];typeof c=="string"&&(n[1]=c)}var h=avalon.getWidgetData(r,n[0]);e[i+"Id"]=n[1],e[i+"Options"]=avalon.mix({},s.defaults,l||{},h),r.removeAttribute("ms-widget");var p=s(r,e,t)||{};e.evaluator=noop,r.msData["ms-widget-id"]=p.$id||"",p.hasOwnProperty("$init")&&p.$init();if(p.hasOwnProperty("$remove")){function d(){if(!r.msRetain&&!root.contains(r))return p.$remove(),r.msData={},delete VMODELS[p.$id],!1}window.chrome?r.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(d)}):avalon.tick(d)}}else t.length&&(r.vmodels=t)}};"hover,active".replace(rword,function(e){bindingHandlers[e]=bindingHandlers["class"]}),"with,each".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.repeat}),bindingHandlers["if"]=bindingHandlers.data=bindingHandlers.text=bindingHandlers.html,"title,alt,src,value,css,include,href".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.attr});var duplexBinding=bindingHandlers.duplex;avalon.duplexHooks={checked:{get:function(e,t){return!t.element.oldValue}},string:{get:function(e){return e},set:fixNull},"boolean":{get:function(e){return e==="true"},set:fixNull},number:{get:function(e){return isFinite(e)||e===""?parseFloat(e)||0:e},set:fixNull}},duplexBinding.INPUT=function(e,t,n){function f(e){o=!0,n.changed.call(this,e)}function l(){u=!0}function c(){u=!1}function h(r){if(u)return;var i=e.oldValue=e.value,o=pipe(i,n,"get");s.data("duplex-observe")!==!1&&(t(o),f.call(e,o),s.data("duplex-focus")&&avalon.nextTick(function(){e.focus()}))}var r=e.type,i=n.bound,s=avalon(e),o=!1,u=!1,a=n.hook;n.handler=function(){var r=t();r=pipe(r,n,"set"),r!==e.value&&(e.value=r)};if(n.isChecked||e.type==="radio"){var p=!window.XMLHttpRequest;h=function(){if(s.data("duplex-observe")!==!1){var r=e.value,i=pipe(r,n,"get");t(i),f.call(e,i)}},n.handler=function(){var r=t(),i=n.isChecked?!!r:r+""===e.value;e.oldValue=i,p?setTimeout(function(){e.defaultChecked=i,e.checked=i},100):e.checked=i},i(p?"mouseup":"click",h)}else if(r==="checkbox")h=function(){if(s.data("duplex-observe")!==!1){var r=e.checked?"ensure":"remove",i=t();Array.isArray(i)||(log("ms-duplex应用于checkbox上要对应一个数组"),i=[i]),avalon.Array[r](i,pipe(e.value,n,"get")),f.call(e,i)}},n.handler=function(){var r=[].concat(t());e.checked=r.indexOf(pipe(e.value,n,"get"))>=0},i(W3C?"change":"click",h);else{var d=e.attributes["data-duplex-event"]||e.attributes["data-event"]||{};e.attributes["data-event"]&&log("data-event指令已经废弃，请改用data-duplex-event"),d=d.value;if(d==="change")i("change",h);else if(W3C){i("input",h),i("compositionstart",l),i("compositionend",c);if(DOC.documentMode===9){function v(e){setTimeout(function(){h(e)})}i("paste",v),i("cut",v)}}else i("propertychange",function(e){e.properyName==="value"&&h(e)})}e.oldValue=e.value,launch(function(){if(avalon.contains(root,e))onTree.call(e);else if(!e.msRetain)return!1}),registerSubscriber(n);var m=setTimeout(function(){o||f.call(e,e.value),clearTimeout(m)},31)};var TimerID,ribbon=[],launch=noop;avalon.tick=function(e){ribbon.push(e)===1&&(TimerID=setInterval(ticker,60))};try{var inputProto=HTMLInputElement.prototype;Object.getOwnPropertyNames(inputProto);var oldSetter=Object.getOwnPropertyDescriptor(inputProto,"value").set;Object.defineProperty(inputProto,"value",{set:newSetter})}catch(e){launch=avalon.tick}duplexBinding.SELECT=function(e,t,n){function s(){if(r.data("duplex-observe")!==!1){var i=r.val();Array.isArray(i)?i=i.map(function(e){return pipe(e,n,"get")}):i=pipe(i,n,"get"),i+""!==e.oldValue&&t(i),n.changed.call(e,i)}}var r=avalon(e),i=n.hook;n.handler=function(){var n=t();n=n&&n.$model||n,Array.isArray(n)?e.multiple||log("ms-duplex在<select multiple=true>上要求对应一个数组"):e.multiple&&log("ms-duplex在<select multiple=false>不能对应一个数组"),n=Array.isArray(n)?n.map(String):n+"",n+""!==e.oldValue&&(r.val(n),e.oldValue=n+"")},n.bound("change",s);var o=NaN,u=setInterval(function(){var r=e.innerHTML;r===o?(clearInterval(u),registerSubscriber(n),n.changed.call(e,t())):o=r},20)},duplexBinding.TEXTAREA=duplexBinding.INPUT;var eventHooks=avalon.eventHooks;"onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){eventHooks[e]={type:t,deel:function(t,n){return function(r){var i=r.relatedTarget;if(!i||i!==t&&!(t.compareDocumentPosition(i)&16))return delete r.type,r.type=e,n.call(t,r)}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!eventHooks.animationend&&(eventHooks.animationend={type:t})}),"oninput"in DOC.createElement("input")||(eventHooks.input={type:"propertychange",deel:function(e,t){return function(n){if(n.propertyName==="value")return n.type="input",t.call(e,n)}}});if(DOC.onmousewheel===void 0){var fixWheelType=DOC.onwheel!==void 0?"wheel":"DOMMouseScroll",fixWheelDelta=fixWheelType==="wheel"?"deltaY":"detail";eventHooks.mousewheel={type:fixWheelType,deel:function(e,t){return function(n){n.wheelDeltaY=n.wheelDelta=n[fixWheelDelta]>0?-120:120,n.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(n,"type",{value:"mousewheel"}),t.call(e,n)}}}}var _splice=ap.splice,CollectionPrototype={_splice:_splice,_fire:function(e,t,n){notifySubscribers(this.$events[subscribers],e,t,n)},_add:function(e,t){var n=this.length;t=typeof t=="number"?t:n;var r=[];for(var i=0,s=e.length;i<s;i++)r[i]=convert(e[i],this.$model[t+i]);_splice.apply(this,[t,0].concat(r)),this._fire("add",t,r);if(!this._stopFireLength)return this._.length=this.length},_del:function(e,t){var n=this._splice(e,t);return n.length&&(this._fire("del",e,t),this._stopFireLength||(this._.length=this.length)),n},push:function(){ap.push.apply(this.$model,arguments);var e=this._add(arguments);return this._fire("index",e>2?e-2:0),e},pushArray:function(e){return this.push.apply(this,e)},unshift:function(){return ap.unshift.apply(this.$model,arguments),this._add(arguments,0),this._fire("index",arguments.length),this.$model.length},shift:function(){var e=this.$model.shift();return this._del(0,1),this._fire("index",0),e},pop:function(){var e=this.$model.pop();return this._del(this.length-1,1),e},splice:function(e,t){e=_number(e,this.length);var n=_splice.apply(this.$model,arguments),r=[],i;return this._stopFireLength=!0,n.length&&(r=this._del(e,n.length),i=!0),arguments.length>2&&(this._add(aslice.call(arguments,2),e),i=!0),this._stopFireLength=!1,this._.length=this.length,i&&this._fire("index",0),r},contains:function(e){return this.indexOf(e)!==-1},size:function(){return this._.length},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>=0?this.splice(e,1):[]},clear:function(){return this.$model.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(e){if(Array.isArray(e))e.forEach(function(e){this.remove(e)},this);else if(typeof e=="function")for(var t=this.length-1;t>=0;t--){var n=this[t];e(n,t)&&this.splice(t,1)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e>=0){var n=avalon.type(t);t&&t.$model&&(t=t.$model);var r=this[e];if(n==="object")for(var i in t)r.hasOwnProperty(i)&&(r[i]=t[i]);else n==="array"?r.clear().push.apply(r,t):r!==t&&(this[e]=t,this.$model[e]=t,this._fire("set",e,t))}return this}};"sort,reverse".replace(rword,function(e){CollectionPrototype[e]=function(){var t=this.$model,n=t.slice(0),r=!1;ap[e].apply(t,arguments);for(var i=0,s=n.length;i<s;i++){var o=t[i],u=n[i];if(!isEqual(o,u)){r=!0;var a=n.indexOf(o,i),f=this._splice(a,1)[0],l=n.splice(a,1)[0];this._splice(i,0,f),n.splice(i,0,l),this._fire("move",a,i)}}return n=void 0,r&&this._fire("index",0),this}});var watchEachOne=oneObject("$index,$first,$last"),eachProxyPool=[],rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig,rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig},rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,n){return t=t||30,n=n===void 0?"...":n,e.length>t?e.slice(0,t-n.length)+n:String(e)},camelize:camelize,sanitize:function(e){return e.replace(rscripts,"").replace(ropen,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=rsanitize[n[1]];r&&(e=e.replace(r,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace(ron," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(rsurrogate,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+((t-55296)*1024+(n-56320)+65536)+";"}).replace(rnoalphanumeric,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(e,t){return t=t||"￥",t+avalon.filters.number(e)},number:function(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+e)?+e:0,s=isFinite(+t)?Math.abs(t):0,o=r||",",u=n||".",a="",f=function(e,t){var n=Math.pow(10,t);return""+Math.round(e*n)/n};return a=(s?f(i,s):""+Math.round(i)).split("."),a[0].length>3&&(a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o)),(a[1]||"").length<s&&(a[1]=a[1]||"",a[1]+=(new Array(s-a[1].length+1)).join("0")),a.join(u)}};new function(){function e(e){return parseInt(e,10)}function t(e,t,n){var r="";e<0&&(r="-",e=-e),e=""+e;while(e.length<t)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function n(e,n,r,i){return function(s){var o=s["get"+e]();if(r>0||o>-r)o+=r;return o===0&&r===-12&&(o=12),t(o,n,i)}}function r(e,t){return function(n,r){var i=n["get"+e](),s=(t?"SHORT"+e:e).toUpperCase();return r[s][i]}}function i(e){var n=-1*e.getTimezoneOffset(),r=n>=0?"+":"";return r+=t(Math[n>0?"floor":"ceil"](n/60),2)+t(Math.abs(n%60),2),r}function s(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function l(t){var n;if(n=t.match(f)){var r=new Date(0),i=0,s=0,o=n[8]?r.setUTCFullYear:r.setFullYear,u=n[8]?r.setUTCHours:r.setHours;n[9]&&(i=e(n[9]+n[10]),s=e(n[9]+n[11])),o.call(r,e(n[1]),e(n[2])-1,e(n[3]));var a=e(n[4]||0)-i,l=e(n[5]||0)-s,c=e(n[6]||0),h=Math.round(parseFloat("0."+(n[7]||0))*1e3);return u.call(r,a,l,c,h),r}return t}var o={yyyy:n("FullYear",4),yy:n("FullYear",2,0,!0),y:n("FullYear",1),MMMM:r("Month"),MMM:r("Month",!0),MM:n("Month",2,1),M:n("Month",1,1),dd:n("Date",2),d:n("Date",1),HH:n("Hours",2),H:n("Hours",1),hh:n("Hours",2,-12),h:n("Hours",1,-12),mm:n("Minutes",2),m:n("Minutes",1),ss:n("Seconds",2),s:n("Seconds",1),sss:n("Milliseconds",3),EEEE:r("Day"),EEE:r("Day",!0),a:s,Z:i},u=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,a=/^\d+$/,f=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,c=/^(\d+)\D(\d+)\D(\d+)/;filters.date=function(t,n){var r=filters.date.locate,i="",s=[],f,h;n=n||"mediumDate",n=r[n]||n;if(typeof t=="string"){if(a.test(t))t=e(t);else{var p=t.trim();t=p.replace(c,function(e,t,n,r){var i=r.length===4?[r,t,n]:[t,n,r];return i.join("/")}),t=l(t)}t=new Date(t)}typeof t=="number"&&(t=new Date(t));if(avalon.type(t)!=="date")return;while(n)h=u.exec(n),h?(s=s.concat(h.slice(1)),n=s.pop()):(s.push(n),n=null);return s.forEach(function(e){f=o[e],i+=f?f(t,r):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i};var h={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d ah:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"ah:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};h.SHORTMONTH=h.MONTH,filters.date.locate=h}})(document);